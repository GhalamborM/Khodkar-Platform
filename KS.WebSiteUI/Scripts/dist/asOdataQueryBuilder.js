$.asOdataQueryBuilder=function(){"use strict";return function(n){if(typeof n=="string")return n==="Predicate"?breeze.Predicate:n==="EntityQuery"?breeze.EntityQuery:this;var t=$.extend({url:"/odata/cms/"},n),i=new breeze.DataService({serviceName:t.url,hasServerMetadata:!1});return new breeze.EntityManager({dataService:i})}}(),function(n){"use strict";if(typeof bootstrap=="function")bootstrap("promise",n);else if(typeof exports=="object"&&typeof module=="object")module.exports=n();else if(typeof define=="function"&&define.amd)define(n);else if(typeof ses!="undefined")if(ses.ok())ses.makeQ=n;else return;else if(typeof window!="undefined"||typeof self!="undefined"){var t=typeof window!="undefined"?window:self,i=t.Q;t.Q=n();t.Q.noConflict=function(){return t.Q=i,this}}else throw new Error("This environment was not anticipated by Q. Please file a bug.");}(function(){"use strict";function s(n){return function(){return kt.apply(n,arguments)}}function ti(n){return n===Object(n)}function ii(n){return ni(n)==="[object StopIteration]"||n instanceof d}function ft(n,t){var r,i,u;if(y&&t.stack&&typeof n=="object"&&n!==null&&n.stack&&n.stack.indexOf(g)===-1){for(r=[],i=t;!!i;i=i.source)i.stack&&r.unshift(i.stack);r.unshift(n.stack);u=r.join("\n"+g+"\n");n.stack=ri(u)}}function ri(n){for(var t,r=n.split("\n"),u=[],i=0;i<r.length;++i)t=r[i],fi(t)||ui(t)||!t||u.push(t);return u.join("\n")}function ui(n){return n.indexOf("(module.js:")!==-1||n.indexOf("(node.js:")!==-1}function et(n){var r=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n),t,i;return r?[r[1],Number(r[2])]:(t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n),t)?[t[1],Number(t[2])]:(i=/.*@(.+):(\d+)$/.exec(n),i?[i[1],Number(i[2])]:void 0)}function fi(n){var t=et(n),r,i;return t?(r=t[0],i=t[1],r===rt&&i>=bt&&i<=pt):!1}function ot(){if(y)try{throw new Error;}catch(i){var n=i.stack.split("\n"),r=n[0].indexOf("@")>0?n[1]:n[2],t=et(r);return t?(rt=t[0],t[1]):void 0}}function ei(n,t,i){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn(t+" is deprecated, use "+i+" instead.",new Error("").stack),n.apply(n,arguments)}}function n(n){return n instanceof t?n:ct(n)?ai(n):it(n)}function r(){function a(t){f=t;e.source=t;l(h,function(i,r){n.nextTick(function(){t.promiseDispatch.apply(t,r)})},void 0);h=void 0;c=void 0}var h=[],c=[],f,s=k(r.prototype),e=k(t.prototype);if(e.promiseDispatch=function(t,r,u){var e=i(arguments);h?(h.push(e),r==="when"&&u[1]&&c.push(u[1])):n.nextTick(function(){f.promiseDispatch.apply(f,e)})},e.valueOf=function(){if(h)return e;var n=ht(f);return o(n)&&(f=n),n},e.inspect=function(){return f?f.inspect():{state:"pending"}},n.longStackSupport&&y)try{throw new Error;}catch(v){e.stack=v.stack.substring(v.stack.indexOf("\n")+1)}return s.promise=e,s.resolve=function(t){f||a(n(t))},s.fulfill=function(n){f||a(it(n))},s.reject=function(n){f||a(u(n))},s.notify=function(t){f||l(c,function(i,r){n.nextTick(function(){r(t)})},void 0)},s}function e(n){if(typeof n!="function")throw new TypeError("resolver must be a function.");var t=r();try{n(t.resolve,t.reject,t.notify)}catch(i){t.reject(i)}return t.promise}function st(t){return e(function(i,r){for(var u=0,f=t.length;u<f;u++)n(t[u]).then(i,r)})}function t(n,i,r){var f,e;return i===void 0&&(i=function(n){return u(new Error("Promise does not support operation: "+n))}),r===void 0&&(r=function(){return{state:"unknown"}}),f=k(t.prototype),f.promiseDispatch=function(t,r,e){var o;try{o=n[r]?n[r].apply(f,e):i.call(f,r,e)}catch(s){o=u(s)}t&&t(o)},f.inspect=r,r&&(e=r(),e.state==="rejected"&&(f.exception=e.reason),f.valueOf=function(){var n=r();return n.state==="pending"||n.state==="rejected"?f:n.value}),f}function f(t,i,r,u){return n(t).then(i,r,u)}function ht(n){if(o(n)){var t=n.inspect();if(t.state==="fulfilled")return t.value}return n}function o(n){return n instanceof t}function ct(n){return ti(n)&&typeof n.then=="function"}function oi(n){return o(n)&&n.inspect().state==="pending"}function si(n){return!o(n)||n.inspect().state==="fulfilled"}function hi(n){return o(n)&&n.inspect().state==="rejected"}function tt(){h.length=0;a.length=0;v||(v=!0)}function ci(t,i){v&&(typeof process=="object"&&typeof process.emit=="function"&&n.nextTick.runAfter(function(){w(a,t)!==-1&&(process.emit("unhandledRejection",i,t),nt.push(t))}),a.push(t),i&&typeof i.stack!="undefined"?h.push(i.stack):h.push("(no stack) "+i))}function li(t){if(v){var i=w(a,t);i!==-1&&(typeof process=="object"&&typeof process.emit=="function"&&n.nextTick.runAfter(function(){var n=w(nt,t);n!==-1&&(process.emit("rejectionHandled",h[i],t),nt.splice(n,1))}),a.splice(i,1),h.splice(i,1))}}function u(n){var i=t({when:function(t){return t&&li(this),t?t(n):this}},function(){return this},function(){return{state:"rejected",reason:n}});return ci(i,n),i}function it(n){return t({when:function(){return n},get:function(t){return n[t]},set:function(t,i){n[t]=i},"delete":function(t){delete n[t]},post:function(t,i){return t===null||t===void 0?n.apply(void 0,i):n[t].apply(n,i)},apply:function(t,i){return n.apply(t,i)},keys:function(){return gt(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function ai(t){var i=r();return n.nextTick(function(){try{t.then(i.resolve,i.reject,i.notify)}catch(n){i.reject(n)}}),i.promise}function vi(i){return t({isDef:function(){}},function(n,t){return at(i,n,t)},function(){return n(i).inspect()})}function lt(t,i,r){return n(t).spread(i,r)}function yi(t){return function(){function i(t,i){var s;if(typeof StopIteration=="undefined"){try{s=e[t](i)}catch(h){return u(h)}return s.done?n(s.value):f(s.value,r,o)}try{s=e[t](i)}catch(h){return ii(h)?n(h.value):u(h)}return f(s,r,o)}var e=t.apply(this,arguments),r=i.bind(i,"next"),o=i.bind(i,"throw");return r()}}function pi(t){n.done(n.async(t)())}function wi(n){throw new d(n);}function bi(n){return function(){return lt([this,c(arguments)],function(t,i){return n.apply(t,i)})}}function at(t,i,r){return n(t).dispatch(i,r)}function c(n){return f(n,function(n){var i=0,t=r();return l(n,function(r,u,e){var s;o(u)&&(s=u.inspect()).state==="fulfilled"?n[e]=s.value:(++i,f(u,function(r){n[e]=r;--i==0&&t.resolve(n)},t.reject,function(n){t.notify({index:e,value:n})}))},void 0),i===0&&t.resolve(n),t.promise})}function vt(t){if(t.length===0)return n.resolve();var i=n.defer(),r=0;return l(t,function(n,u,e){function s(n){i.resolve(n)}function h(){r--;r===0&&i.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))}function c(n){i.notify({index:e,value:n})}var o=t[e];r++;f(o,s,h,c)},undefined),i.promise}function yt(t){return f(t,function(t){return t=b(t,n),f(c(b(t,function(n){return f(n,ut,ut)})),function(){return t})})}function ki(t){return n(t).allSettled()}function di(t,i){return n(t).then(void 0,void 0,i)}function gi(t,i){return n(t).nodeify(i)}var y=!1,d,g,pt;try{throw new Error;}catch(wt){y=!!wt.stack}var bt=ot(),rt,ut=function(){},p=function(){function t(){for(var t,i;n.next;)n=n.next,t=n.task,n.task=void 0,i=n.domain,i&&(n.domain=void 0,i.enter()),h(t,i);while(e.length)t=e.pop(),h(t);r=!1}function h(n,i){try{n()}catch(r){if(f){i&&i.exit();setTimeout(t,0);i&&i.enter();throw r;}else setTimeout(function(){throw r;},0)}i&&i.exit()}var n={task:void 0,next:null},s=n,r=!1,i=void 0,f=!1,e=[],u,o;return p=function(n){s=s.next={task:n,domain:f&&process.domain,next:null};r||(r=!0,i())},typeof process=="object"&&process.toString()==="[object process]"&&process.nextTick?(f=!0,i=function(){process.nextTick(t)}):typeof setImmediate=="function"?i=typeof window!="undefined"?setImmediate.bind(window,t):function(){setImmediate(t)}:typeof MessageChannel!="undefined"?(u=new MessageChannel,u.port1.onmessage=function(){i=o;u.port1.onmessage=t;t()},o=function(){u.port2.postMessage(0)},i=function(){setTimeout(t,0);o()}):i=function(){setTimeout(t,0)},p.runAfter=function(n){e.push(n);r||(r=!0,i())},p}(),kt=Function.call;var i=s(Array.prototype.slice),l=s(Array.prototype.reduce||function(n,t){var i=0,r=this.length;if(arguments.length===1)do{if(i in this){t=this[i++];break}if(++i>=r)throw new TypeError;}while(1);for(;i<r;i++)i in this&&(t=n(t,this[i],i));return t}),w=s(Array.prototype.indexOf||function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1}),b=s(Array.prototype.map||function(n,t){var i=this,r=[];return l(i,function(u,f,e){r.push(n.call(t,f,e,i))},void 0),r}),k=Object.create||function(n){function t(){}return t.prototype=n,new t},dt=s(Object.prototype.hasOwnProperty),gt=Object.keys||function(n){var t=[];for(var i in n)dt(n,i)&&t.push(i);return t},ni=s(Object.prototype.toString);d=typeof ReturnValue!="undefined"?ReturnValue:function(n){this.value=n};g="From previous event:";n.resolve=n;n.nextTick=p;n.longStackSupport=!1;typeof process=="object"&&process&&process.env&&process.env.Q_DEBUG&&(n.longStackSupport=!0);n.defer=r;r.prototype.makeNodeResolver=function(){var n=this;return function(t,r){t?n.reject(t):arguments.length>2?n.resolve(i(arguments,1)):n.resolve(r)}};n.Promise=e;n.promise=e;e.race=st;e.all=c;e.reject=u;e.resolve=n;n.passByCopy=function(n){return n};t.prototype.passByCopy=function(){return this};n.join=function(t,i){return n(t).join(i)};t.prototype.join=function(t){return n([this,t]).spread(function(n,t){if(n===t)return n;throw new Error("Can't join: not the same: "+n+" "+t);})};n.race=st;t.prototype.race=function(){return this.then(n.race)};n.makePromise=t;t.prototype.toString=function(){return"[object Promise]"};t.prototype.then=function(t,i,f){function h(n){try{return typeof t=="function"?t(n):n}catch(i){return u(i)}}function c(n){if(typeof i=="function"){ft(n,s);try{return i(n)}catch(t){return u(t)}}return u(n)}function l(n){return typeof f=="function"?f(n):n}var s=this,e=r(),o=!1;return n.nextTick(function(){s.promiseDispatch(function(n){o||(o=!0,e.resolve(h(n)))},"when",[function(n){o||(o=!0,e.resolve(c(n)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(t){var i,r=!1;try{i=l(t)}catch(u){if(r=!0,n.onerror)n.onerror(u);else throw u;}r||e.notify(i)}]),e.promise};n.tap=function(t,i){return n(t).tap(i)};t.prototype.tap=function(t){return t=n(t),this.then(function(n){return t.fcall(n).thenResolve(n)})};n.when=f;t.prototype.thenResolve=function(n){return this.then(function(){return n})};n.thenResolve=function(t,i){return n(t).thenResolve(i)};t.prototype.thenReject=function(n){return this.then(function(){throw n;})};n.thenReject=function(t,i){return n(t).thenReject(i)};n.nearer=ht;n.isPromise=o;n.isPromiseAlike=ct;n.isPending=oi;t.prototype.isPending=function(){return this.inspect().state==="pending"};n.isFulfilled=si;t.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};n.isRejected=hi;t.prototype.isRejected=function(){return this.inspect().state==="rejected"};var h=[],a=[],nt=[],v=!0;return n.resetUnhandledRejections=tt,n.getUnhandledReasons=function(){return h.slice()},n.stopUnhandledRejectionTracking=function(){tt();v=!1},tt(),n.reject=u,n.fulfill=it,n.master=vi,n.spread=lt,t.prototype.spread=function(n,t){return this.all().then(function(t){return n.apply(void 0,t)},t)},n.async=yi,n.spawn=pi,n["return"]=wi,n.promised=bi,n.dispatch=at,t.prototype.dispatch=function(t,i){var f=this,u=r();return n.nextTick(function(){f.promiseDispatch(u.resolve,t,i)}),u.promise},n.get=function(t,i){return n(t).dispatch("get",[i])},t.prototype.get=function(n){return this.dispatch("get",[n])},n.set=function(t,i,r){return n(t).dispatch("set",[i,r])},t.prototype.set=function(n,t){return this.dispatch("set",[n,t])},n.del=n["delete"]=function(t,i){return n(t).dispatch("delete",[i])},t.prototype.del=t.prototype["delete"]=function(n){return this.dispatch("delete",[n])},n.mapply=n.post=function(t,i,r){return n(t).dispatch("post",[i,r])},t.prototype.mapply=t.prototype.post=function(n,t){return this.dispatch("post",[n,t])},n.send=n.mcall=n.invoke=function(t,r){return n(t).dispatch("post",[r,i(arguments,2)])},t.prototype.send=t.prototype.mcall=t.prototype.invoke=function(n){return this.dispatch("post",[n,i(arguments,1)])},n.fapply=function(t,i){return n(t).dispatch("apply",[void 0,i])},t.prototype.fapply=function(n){return this.dispatch("apply",[void 0,n])},n["try"]=n.fcall=function(t){return n(t).dispatch("apply",[void 0,i(arguments,1)])},t.prototype.fcall=function(){return this.dispatch("apply",[void 0,i(arguments)])},n.fbind=function(t){var r=n(t),u=i(arguments,1);return function(){return r.dispatch("apply",[this,u.concat(i(arguments))])}},t.prototype.fbind=function(){var n=this,t=i(arguments);return function(){return n.dispatch("apply",[this,t.concat(i(arguments))])}},n.keys=function(t){return n(t).dispatch("keys",[])},t.prototype.keys=function(){return this.dispatch("keys",[])},n.all=c,t.prototype.all=function(){return c(this)},n.any=vt,t.prototype.any=function(){return vt(this)},n.allResolved=ei(yt,"allResolved","allSettled"),t.prototype.allResolved=function(){return yt(this)},n.allSettled=ki,t.prototype.allSettled=function(){return this.then(function(t){return c(b(t,function(t){function i(){return t.inspect()}return t=n(t),t.then(i,i)}))})},n.fail=n["catch"]=function(t,i){return n(t).then(void 0,i)},t.prototype.fail=t.prototype["catch"]=function(n){return this.then(void 0,n)},n.progress=di,t.prototype.progress=function(n){return this.then(void 0,void 0,n)},n.fin=n["finally"]=function(t,i){return n(t)["finally"](i)},t.prototype.fin=t.prototype["finally"]=function(t){return t=n(t),this.then(function(n){return t.fcall().then(function(){return n})},function(n){return t.fcall().then(function(){throw n;})})},n.done=function(t,i,r,u){return n(t).done(i,r,u)},t.prototype.done=function(t,i,r){var u=function(t){n.nextTick(function(){if(ft(t,f),n.onerror)n.onerror(t);else throw t;})},f=t||i||r?this.then(t,i,r):this;typeof process=="object"&&process&&process.domain&&(u=process.domain.bind(u));f.then(void 0,u)},n.timeout=function(t,i,r){return n(t).timeout(i,r)},t.prototype.timeout=function(n,t){var i=r(),u=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+n+" ms"),t.code="ETIMEDOUT");i.reject(t)},n);return this.then(function(n){clearTimeout(u);i.resolve(n)},function(n){clearTimeout(u);i.reject(n)},i.notify),i.promise},n.delay=function(t,i){return i===void 0&&(i=t,t=void 0),n(t).delay(i)},t.prototype.delay=function(n){return this.then(function(t){var i=r();return setTimeout(function(){i.resolve(t)},n),i.promise})},n.nfapply=function(t,i){return n(t).nfapply(i)},t.prototype.nfapply=function(n){var t=r(),u=i(n);return u.push(t.makeNodeResolver()),this.fapply(u).fail(t.reject),t.promise},n.nfcall=function(t){var r=i(arguments,1);return n(t).nfapply(r)},t.prototype.nfcall=function(){var t=i(arguments),n=r();return t.push(n.makeNodeResolver()),this.fapply(t).fail(n.reject),n.promise},n.nfbind=n.denodeify=function(t){var u=i(arguments,1);return function(){var e=u.concat(i(arguments)),f=r();return e.push(f.makeNodeResolver()),n(t).fapply(e).fail(f.reject),f.promise}},t.prototype.nfbind=t.prototype.denodeify=function(){var t=i(arguments);return t.unshift(this),n.denodeify.apply(void 0,t)},n.nbind=function(t,u){var f=i(arguments,2);return function(){function s(){return t.apply(u,arguments)}var o=f.concat(i(arguments)),e=r();return o.push(e.makeNodeResolver()),n(s).fapply(o).fail(e.reject),e.promise}},t.prototype.nbind=function(){var t=i(arguments,0);return t.unshift(this),n.nbind.apply(void 0,t)},n.nmapply=n.npost=function(t,i,r){return n(t).npost(i,r)},t.prototype.nmapply=t.prototype.npost=function(n,t){var f=i(t||[]),u=r();return f.push(u.makeNodeResolver()),this.dispatch("post",[n,f]).fail(u.reject),u.promise},n.nsend=n.nmcall=n.ninvoke=function(t,u){var e=i(arguments,2),f=r();return e.push(f.makeNodeResolver()),n(t).dispatch("post",[u,e]).fail(f.reject),f.promise},t.prototype.nsend=t.prototype.nmcall=t.prototype.ninvoke=function(n){var u=i(arguments,1),t=r();return u.push(t.makeNodeResolver()),this.dispatch("post",[n,u]).fail(t.reject),t.promise},n.nodeify=gi,t.prototype.nodeify=function(t){if(t)this.then(function(i){n.nextTick(function(){t(null,i)})},function(i){n.nextTick(function(){t(i)})});else return this},n.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global");},pt=ot(),n});!function(n,t){var i=function(){return t(n)};"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):breeze=i()}(this,function(n){"use strict";function rt(n,t){for(var i in n)et(n,i)&&t(i,n[i])}function fi(n,t){var u=[],i,r;for(i in n)et(n,i)&&(r=t?t(i,n[i]):n[i],void 0!==r&&u.push(r));return u}function pr(n,t){var i,r;for(i in n)if(et(n,i)&&(r=n[i],t(i,r)))return{key:i,value:r};return null}function vu(n,t){var i=er(n,t);return null==i||!(!i.writable&&!i.set)}function er(n,t){if(!su)return null;if(n.hasOwnProperty(t))return Object.getOwnPropertyDescriptor(n,t);var i=Object.getPrototypeOf(n);return null==i?null:er(i,t)}function ki(n,t){return function(i){return i[n]===t}}function ei(n){return function(t){return t[n]}}function wr(n){var t=[];for(var i in n)et(n,i)&&t.push(n[i]);return t}function o(n,t,i){if(!t)return n;if(i)i.forEach(function(i){n[i]=t[i]});else for(var r in t)et(t,r)&&(n[r]=t[r]);return n}function di(n,t){for(var i in t)void 0===n[i]&&(n[i]=t[i]);return n}function oi(n,t){return t.defaultInstance=di(new t(n),t.defaultInstance),n}function ct(n,t,i){var u,f,r;i=i||{};for(u in t)f=u.split(","),r=t[u],f.some(function(t){if(!(t in n))return!1;var u=n[t];return"function"!=typeof u&&(u==r||!(!Array.isArray(u)||0!==u.length)||("function"==typeof r?u=r(u):"object"==typeof u&&u&&u.parentEnum&&(u=u.name),void 0===u||(i[f[0]]=u,!0)))});return i}function br(n,t){if("entityAspect"!==n&&"complexAspect"!==n&&"entityType"!==n&&"complexType"!==n&&"constructor"!==n&&"_"!==n.charAt(0)&&"$"!==n.charAt(0))return t}function bt(n,t){var r,u,f,i;if(n!==Object(n))return n;if(!n._$visited){if(t=t||br,n.toJSON){if(r=n.toJSON(),r!==Object(r))return r;if(r!==n)return bt(r,t);n=r}if(n._$visited=!0,n instanceof Array)u=n.map(function(n){return bt(n,t)});else if("function"==typeof n)u=void 0;else{u={};for(f in n)"_$visited"!==f&&(i=n[f],t&&(i=t(f,i),void 0===i)||(i=bt(i,t),void 0!==i&&(u[f]=i)))}return delete n._$visited,u}}function kr(n,t){var i={},r=n.length;return t.forEach(function(t){for(var f,e,u=0;u<r;u++)if(f=n[u],f&&(e=f[t],void 0!==e)){i[t]=e;break}}),i}function w(n){return null==n?[]:Array.isArray(n)?n:[n]}function si(n,t,i){if(i=null==i||i,null==n)return n;var r;return Array.isArray(n)?(r=[],n.forEach(function(n,u){var f=t(n,u);(null!=f||i)&&(r[u]=f)})):r=t(n),r}function d(n,t){for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return n[i];return null}function or(n,t){for(var i=0,r=n.length;i<r;i++)if(t(n[i]))return i;return-1}function kt(n,t){var i=n.indexOf(t);i===-1&&n.push(t)}function sr(n,t,i){for(var u=li(t)?t:void 0,e=n.length-1,f=!1,r=e;r>=0;r--)if((u?u(n[r]):n[r]===t)&&(n.splice(r,1),f=!0,!i))return!0;return f}function gi(n,t,i){for(var u=[],f=Math.min(n.length,t.length),r=0;r<f;++r)u.push(i(n[r],t[r]));return u}function hi(n,t,i){if(!n||!t||n.length!==t.length)return!1;for(var r=0;r<n.length;r++)if(Array.isArray(n[r])){if(!hi(n[r],t[r]))return!1}else if(i){if(!i(n[r],t[r]))return!1}else if(n[r]!==t[r])return!1;return!0}function nr(n,t){var i=n[t];return i||(i=[],n[t]=i),i}function yu(n,t){for(var r,u=n.split(";"),i=0,f=u.length;i<f;i++)if(r=dr(u[i]),r)return r;if(t)throw new Error("Unable to initialize "+n+".  "+t);}function dr(t){var r=n.window,u,i;if(r){if(u=r[t],u)return u;if(i=r.require,i){if(i.defined)return i.defined(t)?i(t):void 0;try{return i(t)}catch(f){return}}}}function vt(n,t,i,r){var u=n[t];if(i===u)return r();n[t]=i;try{return r()}finally{void 0===u?delete n[t]:n[t]=u}}function gr(n,t,i){var r;try{return r=n(),i()}catch(u){throw"object"==typeof r&&(r.error=u),u;}finally{t(r)}}function nu(n){return function(){for(var r=b(arguments),i="",u=r.length,t=null;u--;)t=r[u],i+=t===Object(t)?JSON.stringify(t):t,n.memoize||(n.memoize={});return i in n.memoize?n.memoize[i]:n.memoize[i]=n.apply(this,r)}}function ci(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=16*Math.random()|0,i="x"==n?t:3&t|8;return i.toString(16)})}function tu(n){var r,t;if("string"!=typeof n)throw new Error("Invalid ISO8601 duration '"+n+"'");if(r=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(n),!r)throw new Error("Invalid ISO8601 duration '"+n+"'");for(var f=[2,3,4,6,7,8],e=[31104e3,2592e3,86400,3600,60,1],u=0,i=0;i<6;i++)t=r[f[i]],t=t?+t.replace(/[A-Za-z]+/g,""):0,u+=t*e[i];return u}function iu(){}function pu(n){return n}function ru(n){return null===n?"null":void 0===n?"undefined":Object.prototype.toString.call(n).slice(8,-1).toLowerCase()}function lt(n){return"date"===ru(n)&&!isNaN(n.getTime())}function wu(n){return"string"==typeof n&&/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/.test(n)}function li(n){return"function"===ru(n)}function ai(n){return"string"==typeof n}function bu(n){return"object"==typeof n}function tr(n){return"string"==typeof n&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(n)}function ir(n){return"string"==typeof n&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(n)}function ut(n){if(null===n||void 0===n)return!0;for(var t in n)if(et(n,t))return!1;return!0}function ku(n){return!isNaN(parseFloat(n))&&isFinite(n)}function dt(n,t){return!!n&&(""==t||null==t||0===n.indexOf(t,0))}function hr(n,t){return!!n&&(""==t||null==t||n.indexOf(t,n.length-t.length)!==-1)}function g(n){var t=arguments,i=RegExp("%([1-"+(arguments.length-1)+"])","g");return n.replace(i,function(n,i){return t[i]})}function du(n){return n=n.replace(ff,"$1 "),n=n.charAt(0).toUpperCase()+n.slice(1)}function uu(n){var t=Function.call;return function(){return t.apply(n,arguments)}}function gu(n,t,i){var f,r,h,u,o,s,e;if(void 0===t&&(t=null),f=i(),r=n.dataType,r&&r.parse&&(t=Array.isArray(t)&&!n.isScalar?t.map(function(n){return r.parse(n,typeof n)}):r.parse(t,typeof t)),!(t===f||r&&r.normalize&&t&&f&&r.normalize(t)===r.normalize(f))){if(u=this.entityAspect,u)h=n.name;else{if(o=this.complexAspect,!o)return void i(t);u=o.getEntityAspect();h=o.getPropertyPath(n.name)}if(s=u._inProcess=u._inProcess||[],!(s.indexOf(n)>=0)){s.push(n);try{e={parent:this,property:n,newValue:t,oldValue:f,propertyName:h,entityAspect:u};n.isComplexProperty?tf(e,i):n.isDataProperty?nf(e,i):rf(e,i);uf(e)}finally{s.pop()}}}}function nf(n,t){var i=n.parent,u=n.property,v=n.entityAspect,a=n.oldValue,o=n.newValue,r=v.entityManager,l=i.entityType,y,p,k,d,c,s,f,e,b,g;if(!u.isScalar)throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.");if(v.entityState.isUnchangedOrModified()&&(y=u.name,p=i.entityAspect||i.complexAspect,void 0===p.originalValues[y]&&(p.originalValues[y]=void 0!==a?a:u.defaultValue)),u.isPartOfKey&&r&&!r.isLoading){var nt=l.keyProperties,tt=nt.map(function(n){return n===u?o:i.getProperty(n.name)}),w=new h(l,tt);if(r.findEntityByKey(w))throw new Error("An entity with this key is already in the cache: "+w.toString());k=i.entityAspect.getKey();d=r._findEntityGroup(l);d._replaceKey(k,w)}c=u.relatedNavigationProperty;c&&r?null!=o?(s=new h(c.entityType,[o]),f=r.findEntityByKey(s),f?i.setProperty(c.name,f):(r._unattachedChildrenMap.addChild(s,c,i),i.setProperty(c.name,null))):i.setProperty(c.name,null):u.inverseNavigationProperty&&r&&!r._inKeyFixup&&(e=u.inverseNavigationProperty,null!=a&&(s=new h(e.parentType,[a]),f=r.findEntityByKey(s))&&(e.isScalar?f.setProperty(e.name,null):(b=f.getProperty(e.name),b.splice(b.indexOf(i),1))),null!=o&&(s=new h(e.parentType,[o]),f=r.findEntityByKey(s),f?e.isScalar?f.setProperty(e.name,i):f.getProperty(e.name).push(i):r._unattachedChildrenMap.addChild(s,e,i)));(t(o),fu(n),u.isPartOfKey)&&(g=l.keyProperties.indexOf(u),l.navigationProperties.forEach(function(n){var u=n.getInverse(),f=u?u.foreignKeyNames:n.invForeignKeyNames,t,r;0!==f.length&&(t=i.getProperty(n.name),t&&(r=f[g],n.isScalar?t.setProperty(r,o):t.forEach(function(n){n.setProperty(r,o)})))}),r&&l.inverseForeignKeyProperties.forEach(function(n){null==n.relatedNavigationProperty.inverse&&r._updateFkVal(n,a,o)}),v.getKey(!0))}function tf(n,t){var i=n.property,r=n.oldValue,u=n.newValue,f=i.dataType,e;if(!i.isScalar)throw new Error(g("You cannot set the non-scalar complex property: '%1' on the type: '%2'.Instead get the property and use array functions like 'push' or 'splice' to change its contents.",i.name,i.parentType.name));if(!u)throw new Error(g("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",i.name,i.dataType.name));r||(e=f.getCtor(),r=new e,t(r));f.dataProperties.forEach(function(n){var t=n.name,i=u.getProperty(t);r.setProperty(t,i)})}function rf(n,t){var h=n.parent,e=n.property,c=n.entityAspect,u=n.oldValue,i=n.newValue,r,o,s,l,a,p,v,w,y,b;if(!e.isScalar)throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");if(r=c.entityManager,o=e.getInverse(),null!=i)if(s=i.entityAspect,r){if(s.entityState.isDetached())r.isLoading||r.attachEntity(i,f.Added);else if(s.entityManager!==r)throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.");}else s&&s.entityManager&&(r=s.entityManager,r.isLoading||r.attachEntity(c.entity,f.Added));if(o?o.isScalar?(null!=u&&u.setProperty(o.name,null),null!=i&&i.setProperty(o.name,h)):(null!=u&&(l=u.getProperty(o.name),a=l.indexOf(h),a!==-1&&l.splice(a,1)),null!=i&&(p=i.getProperty(o.name),p.push(h))):e.invForeignKeyNames&&r&&!r._inKeyFixup&&(v=e.invForeignKeyNames,null!=i?(w=h.entityAspect.getKey().values,v.forEach(function(n,t){i.setProperty(n,w[t])})):null!=u&&v.forEach(function(n){var t=u.entityType.getProperty(n);t.isPartOfKey||u.setProperty(n,null)})),t(i),fu(n),e.relatedDataProperties){if(y=c.entityState,null==i&&(y.isDetached()||u.entityAspect.entityState.isDetached()))return;if(y.isDeleted())return;b=e.entityType.keyProperties;b.forEach(function(n,t){var r=e.relatedDataProperties[t],u;(i||!r.isPartOfKey)&&(u=i?i.getProperty(n.name):r.defaultValue,h.setProperty(r.name,u))})}}function uf(n){var t=n.entityAspect,i=t.entityManager,u=t.entity,r={entity:u,parent:n.parent,property:n.property,propertyName:n.propertyName,oldValue:n.oldValue,newValue:n.newValue};i?i.isLoading||i.isRejectingChanges||(t.propertyChanged.publish(r),i.entityChanged.publish({entityAction:nt.PropertyChange,entity:u,args:r})):t.propertyChanged.publish(r)}function fu(n){var t=n.entityAspect,i=t.entityManager,r;null==i||i.isLoading||(r=n.property,t.entityState.isUnchanged()&&!r.isUnmapped&&t.setModified(),i.validationOptions.validateOnPropertyChange&&t._validateProperty(n.newValue,{entity:t.entity,property:r,propertyName:n.propertyName,oldValue:n.oldValue}))}function eu(n){var i,r,t;if(!n)return null;if(t=n.split(":#"),t.length>1)return vi(t[0],t[1]);if(dt(n,ri.ANONTYPE_PREFIX))return i=vi(n),i.isAnonymous=!0,i;if(r=n.split(",")[0],t=r.split("."),t.length>1){var u=t[t.length-1],f=t.slice(0,t.length-1),e=f.join(".");return vi(u,e)}return vi(n)}function vi(n,t){return{shortTypeName:n,namespace:t,typeName:gt(n,t)}}function ou(n){return n.indexOf(":#")>=0}function gt(n,t){return t&&t.length>0?n+":#"+t:n}function cr(n,t,i){var r,u,f;if(t)if(Array.isArray(t))t.forEach(n._addPropertyCore.bind(n));else{if("object"!=typeof t)throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");for(r in t)et(t,r)&&(u=t[r],u.name=r,f=new i(u),n._addPropertyCore(f))}}function rr(n,t){var r=Array.isArray(t)?t:t.split("."),i;return 1===r.length?n.getProperty(t):(i=n,r.some(function(n){return i=i.getProperty(n),null==i}),i)}var i={version:"1.6.0",metadataVersion:"1.0.5"},et=uu(Object.prototype.hasOwnProperty),b=uu(Array.prototype.slice),su=function(){try{return!(!Object.getPrototypeOf||!Object.defineProperty({},"x",{}))}catch(n){return!1}}(),ff=/([A-Z](?=[A-Z][a-z])|[^A-Z](?=[A-Z])|[a-zA-Z](?=[^a-zA-Z]))/g,u,ot,k,v,yt,ti,nt,ii,lr,h,f,r,l,yi,e,ar,pi,wi,ft,lu,vr,yr,wt,au;Object.create||(Object.create=function(n){var t=function(){};return t.prototype=n,new t});u={};u.__isES5Supported=su;u.objectForEach=rt;u.extend=o;u.propEq=ki;u.pluck=ei;u.arrayEquals=hi;u.arrayFirst=d;u.arrayIndexOf=or;u.arrayRemoveItem=sr;u.arrayZip=gi;u.requireLib=yu;u.using=vt;u.memoize=nu;u.getUuid=ci;u.durationToSeconds=tu;u.isDate=lt;u.isGuid=tr;u.isDuration=ir;u.isFunction=li;u.isEmpty=ut;u.isNumeric=ku;u.stringStartsWith=dt;u.stringEndsWith=hr;u.formatString=g;u.titleCase=du;u.getPropertyDescriptor=er;u.toJSONSafe=bt;u.toJSONSafeReplacer=br;u.parent=i;i.core=u;var ur=function(){function f(n,t){return null!=t&&"string"==typeof t&&t.length>0}function e(n,t){return null!=t&&typeof t===n.typeName}function s(n,t){return null!=t&&t instanceof n.type}function h(n,t){return null!=t&&void 0!==t[n.propertyName]}function c(n,t){return null!=t&&n.enumType.contains(t)}function l(n,t){return n.allowNull?void 0!==t:null!=t}function a(n,t){if(null==t)return!0;var i=n.prevContext;return!i||i.fn(i,t)}function v(n,t){var r=n.prevContext,u=r?" or it "+i(r,t):"";return"is optional"+u}function y(n,t){if(!Array.isArray(t)||n.mustNotBeEmpty&&0===t.length)return!1;var i=n.prevContext;return!i||t.every(function(n){return i.fn(i,n)})}function p(n,t){var u=n.mustNotBeEmpty?"a nonEmpty array":"an array",r=n.prevContext,f=r?" where each element "+i(r,t):"";return" must be "+u+f}function i(n,t){var i=n.msg;return"function"==typeof i&&(i=i(n,t)),i}function t(n,t){if(n._context){for(var i=n._context;null!=i.prevContext;)i=i.prevContext;if(null===i.prevContext)return i.prevContext=t,n;if(null!=t.prevContext)throw new Error("Illegal construction - use 'or' to combine checks");t.prevContext=n._context}return w(n,t)}function w(n,t){return n._contexts[n._contexts.length-1]=t,n._context=t,n}function b(n){var t=n._contexts;if(null==t[t.length-1]&&t.pop(),0!==t.length)return t.some(function(t){return t.fn(t,n.v)})}function r(n,t){throw new Error(g("Error configuring an instance of '%1'. %2",n&&n._$typeName||"object",t));}var u=function(n,t){this.v=n;this.name=t;this._contexts=[null]},n=u.prototype;return n.isObject=function(){return this.isTypeOf("object")},n.isBoolean=function(){return this.isTypeOf("boolean")},n.isString=function(){return this.isTypeOf("string")},n.isNonEmptyString=function(){return t(this,{fn:f,msg:"must be a nonEmpty string"})},n.isNumber=function(){return this.isTypeOf("number")},n.isFunction=function(){return this.isTypeOf("function")},n.isTypeOf=function(n){return t(this,{fn:e,typeName:n,msg:"must be a '"+n+"'"})},n.isInstanceOf=function(n,i){return i=i||n.prototype._$typeName,t(this,{fn:s,type:n,typeName:i,msg:"must be an instance of '"+i+"'"})},n.hasProperty=function(n){return t(this,{fn:h,propertyName:n,msg:"must have a '"+n+"' property"})},n.isEnumOf=function(n){return t(this,{fn:c,enumType:n,msg:"must be an instance of the '"+n.name+"' enumeration"})},n.isRequired=function(n){return t(this,{fn:l,allowNull:n,msg:"is required"})},n.isOptional=function(){var n={fn:a,prevContext:null,msg:v};return t(this,n)},n.isNonEmptyArray=function(){return this.isArray(!0)},n.isArray=function(n){var i={fn:y,mustNotBeEmpty:n,prevContext:null,msg:p};return t(this,i)},n.or=function(){return this._contexts.push(null),this._context=null,this},n.check=function(n){var t=b(this);if(void 0!==t){if(!t)throw new Error(this.getMessage());return void 0!==this.v?this.v:n}},n._addContext=function(n){return t(this,n)},n.getMessage=function(){var n=this,t=this._contexts.map(function(t){return i(t,n.v)}).join(", or it ");return g(this.MESSAGE_PREFIX,this.name)+" "+t},n.withDefault=function(n){return this.defaultValue=n,this},n.whereParam=function(n){return this.parent.whereParam(n)},n.applyAll=function(n,t){var f=n._$typeName,e=f&&this.parent.config._$typeName===f,i=o({},this.parent.config),u;if(this.parent.params.forEach(function(u){e||delete i[u.name];try{u.check()}catch(f){r(n,f.message)}t||u._applyOne(n)}),!e)for(u in i)void 0!==i[u]&&r(n,g("Unknown property: '%1'.",u))},n._applyOne=function(n){void 0!==this.v?n[this.name]=this.v:void 0!==this.defaultValue&&(n[this.name]=this.defaultValue)},n.MESSAGE_PREFIX="The '%1' parameter ",u}(),t=function(n,t){return new ur(n,t)},ef=function(){var n=function(n){if("object"!=typeof n)throw new Error("Configuration parameter should be an object, instead it is a: "+typeof n);this.config=n;this.params=[]},t=n.prototype;return t.whereParam=function(n){var t=new ur(this.config[n],n);return t.parent=this,this.params.push(t),t},n}(),c=function(n){return new ef(n)};u.Param=ur;u.assertParam=t;u.assertConfig=c;ot=function(){function n(){}var i=function(t,i){this.name=t;var r=new n(i);r.parentEnum=this;this._symbolPrototype=r;i&&Object.keys(i).forEach(function(n){r[n]=i[n]})},t=i.prototype;return i.isSymbol=function(t){return t instanceof n},t.fromName=function(n){return this[n]},t.addSymbol=function(n){var t=Object.create(this._symbolPrototype);return n&&Object.keys(n).forEach(function(i){t[i]=n[i]}),setTimeout(function(){t.getName()},0),t},t.resolveSymbols=function(){this.getSymbols().forEach(function(n){return n.getName()})},t.getSymbols=function(){return this.getNames().map(function(n){return this[n]},this)},t.getNames=function(){var t=[];for(var n in this)this.hasOwnProperty(n)&&("name"===n||"_"===n.substr(0,1)||li(this[n])||t.push(n));return t},t.contains=function(t){return t instanceof n&&this[t.getName()]===t},n.prototype.getName=function(){if(!this.name){var n=this;this.name=d(this.parentEnum.getNames(),function(t){return n.parentEnum[t]===n})}return this.name},n.prototype.toString=function(){return this.getName()},n.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},i}();u.Enum=ot;k=function(){function r(n,t,i){var r=n._subscribers;return!r||void r.forEach(function(r){try{r.callback(t)}catch(u){u.context="unable to publish on topic: "+n.name;i?i(u):n._defaultErrorCallback?n._defaultErrorCallback(u):f(u)}})}function f(){}var e={},u=1,n=function(n,i,r){t(n,"eventName").isNonEmptyString().check();t(i,"publisher").isObject().check();this.name=n;e[n]=!0;this.publisher=i;r&&(this._defaultErrorCallback=r)},i=n.prototype;return i.publish=function(t,i,u){return!!n._isEnabled(this.name,this.publisher)&&(i===!0?setTimeout(r,0,this,t,u):r(this,t,u),!0)},i.publishAsync=function(n,t){this.publish(n,!0,t)},i.subscribe=function(n){this._subscribers||(this._subscribers=[]);var t=u;return this._subscribers.push({unsubKey:t,callback:n}),++u,t},i.unsubscribe=function(n){if(!this._subscribers)return!1;var t=this._subscribers,i=or(t,function(t){return t.unsubKey===n});return i!==-1&&(t.splice(i,1),0===t.length&&(this._subscribers=null),!0)},i.clear=function(){this._subscribers=null},n.bubbleEvent=function(n,t){n._getEventParent=t},n.enable=function(n,i,r){t(n,"eventName").isNonEmptyString().check();t(i,"obj").isObject().check();t(r,"isEnabled").isBoolean().isOptional().or().isFunction().check();i._$eventMap||(i._$eventMap={});i._$eventMap[n]=r},n.isEnabled=function(i,r){if(t(i,"eventName").isNonEmptyString().check(),t(r,"obj").isObject().check(),void 0===r._getEventParent)throw new Error("This object does not support event enabling/disabling");return n._isEnabled(i,r)},n._isEnabled=function(t,i){var r=null,f=i._$eventMap,u;return(f&&(r=f[t]),null!=r)?"function"==typeof r?r(i):!!r:(u=i._getEventParent&&i._getEventParent(),!u||n._isEnabled(t,u))},n}();u.Event=k;v=function(){function u(t,i,r){var u=i.defaultInstance;return u||(u=new i.ctor,i.defaultInstance=u,u._$impl=i),u.initialize(),r&&(t.defaultInstance=u),n.interfaceInitialized.publish({interfaceName:t.name,instance:u,isDefault:!0}),u.checkForRecomposition&&n.interfaceInitialized.subscribe(function(n){u.checkForRecomposition(n)}),u}function r(t){var r=t.toLowerCase(),i=pr(n.interfaceRegistry||{},function(n){return n.toLowerCase()===r});if(!i)throw new Error("Unknown interface name: "+t);return i.value}var n={},i;return n.functionRegistry={},n.typeRegistry={},n.objectRegistry={},n.interfaceInitialized=new k("interfaceInitialized",n),i=function(n){this.name=n;this.defaultInstance=null;this._implMap={}},i.prototype.registerCtor=function(n,t){this._implMap[n.toLowerCase()]={ctor:t,defaultInstance:null}},i.prototype.getImpl=function(n){return this._implMap[n.toLowerCase()]},i.prototype.getFirstImpl=function(){var n=pr(this._implMap,function(){return!0});return n?n.value:null},n.interfaceRegistry={ajax:new i("ajax"),modelLibrary:new i("modelLibrary"),dataService:new i("dataService"),uriBuilder:new i("uriBuilder")},n.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},n.setProperties=function(t){c(t).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(t);t.remoteAccessImplementation&&n.initializeAdapterInstance("dataService",t.remoteAccessImplementation);t.trackingImplementation&&n.initializeAdapterInstance("modelLibrary",t.trackingImplementation);t.ajaxImplementation&&n.initializeAdapterInstance("ajax",t.ajaxImplementation)},n.registerAdapter=function(n,i){var f,u,e;if(t(n,"interfaceName").isNonEmptyString().check(),t(i,"adapterCtor").isFunction().check(),f=new i,u=f.name,!u)throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");e=r(n);e.registerCtor(u,i)},n.getAdapter=function(n,t){var i=r(n),u;return t?(u=i.getImpl(t),u?u.ctor:null):i.defaultInstance?i.defaultInstance._$impl.ctor:null},n.initializeAdapterInstances=function(t){return c(t).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().whereParam("uriBuilder").isOptional().applyAll(this,!1),fi(t,n.initializeAdapterInstance)},n.initializeAdapterInstance=function(n,i,f){f=void 0===f||f;t(n,"interfaceName").isNonEmptyString().check();t(i,"adapterName").isNonEmptyString().check();t(f,"isDefault").isBoolean().check();var e=r(n),o=e.getImpl(i);if(!o)throw new Error("Unregistered adapter.  Interface: "+n+" AdapterName: "+i);return u(e,o,f)},n.getAdapterInstance=function(n,t){var i,f=r(n),e=null==t||""==t;if(e){if(f.defaultInstance)return f.defaultInstance;i=f.getFirstImpl()}else i=f.getImpl(t);return i?i.defaultInstance?i.defaultInstance:u(f,i,e):null},n.registerFunction=function(i,r){t(i,"fn").isFunction().check();t(r,"fnName").isString().check();i.prototype._$fnName=r;n.functionRegistry[r]=i},n.getRegisteredFunction=function(t){return n.functionRegistry[t]},n._storeObject=function(t,i,r){var u=("string"==typeof i?i:i.prototype._$typeName)+"."+r;n.objectRegistry[u]=t},n._fetchObject=function(t,i){if(i){var r=("string"==typeof t?t:t.prototype._$typeName)+"."+i,u=n.objectRegistry[r];if(!u)throw new Error("Unable to locate a registered object by the name: "+r);return u}},n.registerType=function(i,r){t(i,"ctor").isFunction().check();t(r,"typeName").isString().check();i.prototype._$typeName=r;n.typeRegistry[r]=i},n.stringifyPad="",n}();yt=v.interfaceRegistry.modelLibrary;u.config=v;i.config=v;var ni=function(){function u(n){var t=n.getEntityAspect();t.entityState.isUnchanged()&&t.setModified();t.entityState.isModified()&&!n._origValues&&(n._origValues=n.slice(0))}function t(n,t){n._processAdds(t);r(n,"arrayChanged",{array:n,added:t})}function i(n,t){n._processRemoves(t);r(n,"arrayChanged",{array:n,removed:t})}function r(n,t,i){var r=n._getPendingPubs();r?n._pendingArgs?f(n._pendingArgs,i):(n._pendingArgs=i,r.push(function(){n[t].publish(n._pendingArgs);n._pendingArgs=null})):n[t].publish(i)}function f(n,t){var i,u,r;for(i in t)if("array"!==i&&n.hasOwnProperty(i))if(u=t[i],r=n[i],r){if(!Array.isArray(r))throw new Error("Cannot combine non array args");Array.prototype.push.apply(r,u)}else n[i]=u}function e(n,t,i){n.parent=t;n.parentProperty=i}var n={};return n.push=function(){var n,i;return this._inProgress?-1:(n=this._getGoodAdds(b(arguments)),!n.length)?this.length:(this._beforeChange(),i=Array.prototype.push.apply(this,n),t(this,n),i)},n._push=function(){var n,i;return this._inProgress?-1:(n=b(arguments),this._beforeChange(),i=Array.prototype.push.apply(this,n),t(this,n),i)},n.unshift=function(){var n=this._getGoodAdds(b(arguments)),i;return n.length?(this._beforeChange(),i=Array.prototype.unshift.apply(this,n),t(this,b(n)),i):this.length},n.pop=function(){this._beforeChange();var n=Array.prototype.pop.apply(this);return i(this,[n]),n},n.shift=function(){this._beforeChange();var n=Array.prototype.shift.apply(this);return i(this,[n]),n},n.splice=function(){var n=this._getGoodAdds(b(arguments,2)),u=b(arguments,0,2).concat(n),r;return this._beforeChange(),r=Array.prototype.splice.apply(this,u),i(this,r),n.length&&t(this,n),r},n.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()},n._getEventParent=function(){return this.getEntityAspect()},n._getPendingPubs=function(){var n=this.getEntityAspect().entityManager;return n&&n._pendingPubs},n._beforeChange=function(){},{mixin:n,publish:r,updateEntityState:u,initializeParent:e}}(),s=function(){function u(n,t,i,r,u){for(r=+n[t=n.length-1],u=0;t--;)i=+n[t],r+=++u%2?2*i%10+(i>4):i;return!(r%10)}function t(t,i,r,u){r&&(n.messageTemplates[t]=r);var f="string"==typeof i?new RegExp(i):i,e=function(n){return null==n||""===n||"string"==typeof n&&f.test(n)};return new n(t,e,u)}function f(n,t,i){return t?n.replace(/%([^%]+)%/g,function(n,r){var u;return u=i?t.hasOwnProperty(r)?t[r]:"":t[r],null!=u?li(u)?u(t):u:""}):n}function r(t,i,r,u){u=u||{};void 0!==i&&(u.min=i);void 0!==r&&(u.max=r);var f=u.messageTemplate||n.messageTemplates[t];return f||(n.messageTemplates[t]=g("'%displayName%' must be an integer between the values of %1 and %2",i,r)),function(){var f=function(n,t){return null==n||("string"==typeof n&&t&&t.allowString&&(n=parseInt(n,0)),"number"==typeof n&&!isNaN(n)&&Math.floor(n)===n&&!(null!=i&&n<i)&&!(null!=r&&n>r))};return new n(t,f,u)}}var e=-32768,s=32767,h=-2147483648,c=2147483647,l=0,a=255,y={displayName:function(n){return n.property?n.property.resolveProperty("displayName")||n.propertyName||n.property.name:"Value"}},n=function(t,i,r){this._baseContext=r||{};this._baseContext.name=t;r=o(Object.create(y),this._baseContext);r.messageTemplate=r.messageTemplate||n.messageTemplates[t];this.name=t;this.valFn=i;this.context=r},i=n.prototype;return i._$typeName="Validator",i.validate=function(n,t){var i;i=t?o(Object.create(this.context),t):this.context;this.currentContext=i;try{return this.valFn(n,i)?null:(i.value=n,new at(this,i,this.getMessage()))}catch(r){return new at(this,i,"Exception occured while executing this validator: "+this.name)}},i.getMessage=function(){try{var n=this.currentContext,t=n.message;return t?"function"==typeof t?t(n):t:n.messageTemplate?f(n.messageTemplate,n):"invalid value: "+(this.name||"{unnamed validator}")}catch(i){return"Unable to format error message"+i.toString()}},i.toJSON=function(){return this._baseContext},n.fromJSON=function(t){if(Array.isArray(t))return t.map(function(t){return n.fromJSON(t)});var r="Validator."+t.name,i=v.getRegisteredFunction(r);if(!i)throw new Error("Unable to locate a validator named:"+t.name);return i(t)},n.register=function(n){v.registerFunction(function(){return n},"Validator."+n.name)},n.registerFactory=function(n,t){v.registerFunction(n,"Validator."+t)},n.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"},n.required=function(t){var i=function(n,t){return"string"==typeof n?!(!t||!t.allowEmptyStrings)||n.length>0:null!=n};return new n("required",i,t)},n.maxLength=function(t){var i=function(n,t){return null==n||"string"==typeof n&&n.length<=t.maxLength};return new n("maxLength",i,t)},n.stringLength=function(t){var i=function(n,t){return null==n||"string"==typeof n&&!(null!=t.minLength&&n.length<t.minLength)&&!(null!=t.maxLength&&n.length>t.maxLength)};return new n("stringLength",i,t)},n.string=function(){var t=function(n){return null==n||"string"==typeof n};return new n("string",t)},n.guid=function(){var t=function(n){return null==n||tr(n)};return new n("guid",t)},n.duration=function(){var t=function(n){return null==n||ir(n)};return new n("duration",t)},n.number=n.double=n.single=function(t){var i=function(n,t){return null==n||("string"==typeof n&&t&&t.allowString&&(n=parseFloat(n,10)),"number"==typeof n&&!isNaN(n))};return new n("number",i,t)},n.integer=n.int64=function(t){var i=function(n,t){return null==n||("string"==typeof n&&t&&t.allowString&&(n=parseInt(n,10)),"number"==typeof n&&!isNaN(n)&&Math.floor(n)===n)};return new n("integer",i,t)},n.int32=function(n){return r("int32",h,c,n)()},n.int16=function(n){return r("int16",e,s,n)()},n.byte=function(n){return r("byte",l,a,n)()},n.bool=function(){var t=function(n){return null==n||n===!0||n===!1};return new n("bool",t)},n.none=function(){var t=function(){return!0};return new n("none",t)},n.date=function(){var t=function(n){if(null==n)return!0;if("string"!=typeof n)return lt(n);try{return!isNaN(Date.parse(n))}catch(t){return!1}};return new n("date",t)},n.creditCard=function(t){function i(n){return null==n||""===n||"string"==typeof n&&(n=n.replace(/(\-|\s)/g,""),!(!n||/\D/.test(n))&&u(n))}return new n("creditCard",i,t)},n.regularExpression=function(t){function i(n,t){if(null==n||""===n)return!0;if("string"!=typeof n)return!1;try{var i=new RegExp(t.expression)}catch(r){throw new Error("Missing or invalid expression parameter to regExp validator");}return i.test(n)}return new n("regularExpression",i,t)},n.emailAddress=function(n){return t("emailAddress",/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,null,n)},n.phone=function(n){return t("phone",/^((\+|(0(\d+)?[-\/.\s]?))[1-9]\d{0,2}[-\/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-\/.\s]?)?(\d+[-\/.\s]?)+\d+$/,null,n)},n.url=function(n){return t("url",/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/,null,n)},n.makeRegExpValidator=t,rt(n,function(n,t){"function"==typeof t&&"fromJSON"!==n&&"register"!==n&&"registerFactory"!==n&&"makeRegExpValidator"!==n&&v.registerFunction(t,"Validator."+n)}),n}(),at=function(){var n=function i(n,r,u,f){t(n,"validator").isOptional().isInstanceOf(s).check();t(u,"errorMessage").isNonEmptyString().check();t(f,"key").isOptional().isNonEmptyString().check();this.validator=n;r=r||{};this.context=r;this.errorMessage=u;this.property=r.property;this.propertyName=r.propertyName||r.property&&r.property.name;this.key=f?f:i.getKey(n||u,this.propertyName);this.isServerError=!1};return n.getKey=function(n,t){return(n.name||n)+(t?":"+t:"")},n}();i.Validator=s;i.ValidationError=at;ti=function(){function i(n,t){return t&&c(t).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(n),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="ValidationOptions",t.using=function(n){if(!n)return this;var t=new ti(this);return i(t,n),t},t.setAsDefault=function(){return oi(this,n)},n.defaultInstance=new n({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),n}();i.ValidationOptions=ti;i.makeComplexArray=function(){function i(n,t){return t.filter(function(t){return t.parent!==n.parent})}function r(n,t){t.forEach(function(t){if(null!=t.parent)throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner");f(t,n)})}function u(n,i){i.forEach(function(i){t(i,n)})}function t(n,t){var i=n.complexAspect;return i.parent!==t.parent?null:(i.parent=null,i.parentProperty=null,i)}function f(n,t){var i=n.complexAspect;return i.parent===t.parent?null:(i.parent=t.parent,i.parentProperty=t.parentProperty,i)}function e(t,i,r){return ni.initializeParent(t,i,r),t.arrayChanged=new k("arrayChanged",t),o(t,ni.mixin),o(t,n)}var n={};return n._getGoodAdds=function(n){return i(this,n)},n._beforeChange=function(){ni.updateEntityState(this)},n._processAdds=function(n){r(this,n)},n._processRemoves=function(n){u(this,n)},n._rejectChanges=function(){if(this._origValues){var n=this;this.forEach(function(i){t(i,n)});this.length=0;this._origValues.forEach(function(t){n.push(t)})}},n._acceptChanges=function(){this._origValues=null},e}();nt=function(){var t={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},n=new ot("EntityAction",t);return n.Attach=n.addSymbol({isAttach:!0}),n.AttachOnQuery=n.addSymbol({isAttach:!0}),n.AttachOnImport=n.addSymbol({isAttach:!0}),n.Detach=n.addSymbol({isDetach:!0}),n.MergeOnQuery=n.addSymbol({isModification:!0}),n.MergeOnImport=n.addSymbol({isModification:!0}),n.MergeOnSave=n.addSymbol({isModification:!0}),n.PropertyChange=n.addSymbol({isModification:!0}),n.EntityStateChange=n.addSymbol(),n.AcceptChanges=n.addSymbol(),n.RejectChanges=n.addSymbol({isModification:!0}),n.Clear=n.addSymbol({isDetach:!0}),n.resolveSymbols(),n}();i.EntityAction=nt;ii=function(){function o(n){var r=n.entityAspect||n.complexAspect,u=n.entityType||n.complexType,t=r.originalValues;for(var i in t)n.setProperty(i,t[i]);u.complexProperties.forEach(function(t){var i=n.getProperty(t.name);t.isScalar?o(i):(i._rejectChanges(),i.forEach(o))})}function i(n){var r=n.entityAspect||n.complexAspect,t;r.originalValues={};t=n.entityType||n.complexType;t.complexProperties.forEach(function(t){var r=n.getProperty(t.name);t.isScalar?i(r):(r._acceptChanges(),r.forEach(i))})}function r(n,t){var i=!0,e=n.entityType||n.complexType,o=n.entityAspect||n.complexAspect,f=n.entityAspect||n.complexAspect.getEntityAspect(),u={entity:f.entity};return void 0!==t&&(u.index=t),e.getProperties().forEach(function(t){var e=n.getProperty(t.name),s=t.getAllValidators();s.length>0&&(u.property=t,u.propertyName=o.getPropertyPath(t.name),i=f._validateProperty(e,u)&&i);t.isComplexProperty&&(i=t.isScalar?r(e)&&i:e.reduce(function(n,t,i){return r(t,i)&&n},i))}),e.getAllValidators().forEach(function(t){i=v(f,t,n)&&i}),i}function c(n,t){var i=t.isDeleted();i?l(n):vt(n.entityAspect.entityManager,"isLoading",!0,function(){l(n)})}function l(n){n.entityType.navigationProperties.forEach(function(t){var i=t.getInverse(),r=n.getProperty(t.name),u;t.isScalar?r&&(i&&(i.isScalar?r.setProperty(i.name,null):(u=r.getProperty(i.name),u.length&&sr(u,n))),n.setProperty(t.name,null)):(i&&r.slice(0).forEach(function(n){i.isScalar&&n.setProperty(i.name,null)}),r.length=0)})}function v(n,t,i,r){var u=t.validate(i,r),f;return u?(n._addValidationError(u),!1):(f=at.getKey(t,r?r.propertyName:null),n._removeValidationError(f),!0)}var y=function u(n){var t,i,r,e;if(null===n){if(t=u._nullInstance,t)return t;u._nullInstance=this}else{if(void 0===n)throw new Error("The EntityAspect ctor requires an entity as its only argument.");if(n.entityAspect)return n.entityAspect}if(!(this instanceof u))return new u(n);if(this.entity=n,this.entityGroup=null,this.entityManager=null,this.entityState=f.Detached,this.isBeingSaved=!1,this.originalValues={},this.hasValidationErrors=!1,this._validationErrors={},this.validationErrorsChanged=new k("validationErrorsChanged",this),this.propertyChanged=new k("propertyChanged",this),null!=n){if(n.entityAspect=this,i=n.entityType||n._$entityType,!i){r=n.prototype._$typeName;throw r?new Error("Metadata for this entityType has not yet been resolved: "+r):new Error("This entity is not registered as a valid EntityType");}e=i.getEntityCtor();yt.getDefaultInstance().startTracking(n,e.prototype)}},n=y.prototype;return k.bubbleEvent(n,function(){return this.entityManager}),n.getKey=function(n){if(n=t(n,"forceRefresh").isBoolean().isOptional().check(!1),n||!this._entityKey){var i=this.entity.entityType,r=i.keyProperties,u=r.map(function(n){return this.entity.getProperty(n.name)},this);this._entityKey=new h(i,u)}return this._entityKey},n.acceptChanges=function(){this._checkOperation("acceptChanges");var n=this.entityManager;this.entityState.isDeleted()?n.detachEntity(this.entity):this.setUnchanged();n.entityChanged.publish({entityAction:nt.AcceptChanges,entity:this.entity})},n.rejectChanges=function(){this._checkOperation("rejectChanges");var n=this.entity,t=this.entityManager;vt(t,"isRejectingChanges",!0,function(){o(n)});this.entityState.isAdded()?(t.detachEntity(n),t._notifyStateChange(n,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(n),this.setUnchanged(),this.propertyChanged.publish({entity:n,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:nt.RejectChanges,entity:n}))},n.getPropertyPath=function(n){return n},n.setAdded=function(){return this.setEntityState(f.Added)},n.setUnchanged=function(){return this.setEntityState(f.Unchanged)},n.setModified=function(){return this.setEntityState(f.Modified)},n.setDeleted=function(){return this.setEntityState(f.Deleted)},n.setDetached=function(){return this.setEntityState(f.Detached)},n.setEntityState=function(n){var u;if(this.entityState===n)return!1;if(this._checkOperation("setEntityState"),this.entityState.isDetached())throw new Error("You cannot set the 'entityState' of an entity when it is detached - except by first attaching it to an EntityManager");var t=this.entity,e=this.entityManager,r=!0;if(n===f.Unchanged)i(t),delete this.hasTempKey,r=!1;else if(n===f.Added)i(t);else if(n===f.Deleted){if(this.entityState.isAdded())return this.setEntityState(f.Detached),!0;this.entityState=f.Deleted;c(t,f.Deleted)}else if(n!==f.Modified&&n===f.Detached){if(u=this.entityGroup,!u)return!1;u.detachEntity(t);this.entityState=n;c(t,f.Detached);this._detach();e.entityChanged.publish({entityAction:nt.Detach,entity:t});r=!1}return this.entityState=n,e._notifyStateChange(t,r),!0},n.loadNavigationProperty=function(n,t,i){var r=this.entity,u=r.entityType._checkNavProperty(n),f=it.fromEntityNavigation(r,u),o=r.entityAspect.entityManager.executeQuery(f),s=this;return o.then(function(n){return s._markAsLoaded(u.name),t&&t(n),e.resolve(n)},function(n){return i&&i(n),e.reject(n)})},n.markNavigationPropertyAsLoaded=function(n){var t=this.entity.entityType._checkNavProperty(n);this._markAsLoaded(t.name)},n.isNavigationPropertyLoaded=function(n){var t=this.entity.entityType._checkNavProperty(n);return!(!t.isScalar||null==this.entity.getProperty(t.name))||this._loadedNps&&this._loadedNps.indexOf(t.name)>=0},n._markAsLoaded=function(n){this._loadedNps=this._loadedNps||[];kt(this._loadedNps,n)},n.validateEntity=function(){var n=!0;return this._processValidationOpAndPublish(function(t){n=r(t.entity)}),n},n.validateProperty=function(n,t){var i=this.getPropertyValue(n);return i&&i.complexAspect?r(i):(t=t||{},t.entity=this.entity,"string"==typeof n?(t.property=this.entity.entityType.getProperty(n,!0),t.propertyName=n):(t.property=n,t.propertyName=n.name),this._validateProperty(i,t))},n.getValidationErrors=function(n){var i,r;return t(n,"property").isOptional().isEntityProperty().or().isString().check(),i=wr(this._validationErrors),n&&(r="string"==typeof n?n:n.name,i=i.filter(function(n){return n.property&&(n.property.name===r||r.indexOf(".")!=-1&&n.propertyName==r)})),i},n.addValidationError=function(n){t(n,"validationError").isInstanceOf(at).check();this._processValidationOpAndPublish(function(t){t._addValidationError(n)})},n.removeValidationError=function(n){t(n,"validationErrorOrKey").isString().or().isInstanceOf(at).or().isInstanceOf(s).check();var i="string"==typeof n?n:n.key;this._processValidationOpAndPublish(function(n){n._removeValidationError(i)})},n.clearValidationErrors=function(){this._processValidationOpAndPublish(function(n){rt(n._validationErrors,function(t,i){i&&(delete n._validationErrors[t],n._pendingValidationResult.removed.push(i))});n.hasValidationErrors=!ut(n._validationErrors)})},n.getParentKey=function(n){var t=n.foreignKeyNames,i,r;return 0===t.length?null:(i=this,r=t.map(function(n){return i.entity.getProperty(n)}),new h(n.entityType,r))},n.getPropertyValue=function(n){var i,r,u;if(t(n,"property").isString().or().isEntityProperty().check(),"string"==typeof n)for(r=n.trim().split("."),u=r.shift(),i=this.entity,i=i.getProperty(u);r.length>0;)u=r.shift(),i=i.getProperty(u);else{if(!(n.parentType instanceof a))throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' parameter instead ");i=this.entity.getProperty(n.name)}return i},n._checkOperation=function(n){if(this.isBeingSaved)throw new Error("Cannot perform a '"+n+"' on an entity that is in the process of being saved");return this},n._detach=function(){this.entityGroup=null;this.entityManager=null;this.entityState=f.Detached;this.originalValues={};this._validationErrors={};this.hasValidationErrors=!1;this.validationErrorsChanged.clear();this.propertyChanged.clear()},n._validateProperty=function(n,t){var i=!0;return this._processValidationOpAndPublish(function(r){t.property.getAllValidators().forEach(function(u){i=v(r,u,n,t)&&i})}),i},n._processValidationOpAndPublish=function(n){if(this._pendingValidationResult)n(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]};n(this);(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&(this.validationErrorsChanged.publish(this._pendingValidationResult),this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult))}finally{this._pendingValidationResult=void 0}},n._addValidationError=function(n){this._validationErrors[n.key]=n;this.hasValidationErrors=!0;this._pendingValidationResult.added.push(n)},n._removeValidationError=function(n){var t=this._validationErrors[n];t&&(delete this._validationErrors[n],this.hasValidationErrors=!ut(this._validationErrors),this._pendingValidationResult.removed.push(t))},y}();lr=function(){var n=function t(n,i,r){var u,f,e;if(!n)throw new Error("The  ComplexAspect ctor requires an entity as its only argument.");if(n.complexAspect)return n.complexAspect;if(!(this instanceof t))return new t(n,i,r);if(this.complexObject=n,n.complexAspect=this,this.originalValues={},null!=i&&(this.parent=i,this.parentProperty=r),u=n.complexType,!u){f=n.prototype._$typeName;throw f?new Error("Metadata for this complexType has not yet been resolved: "+f):new Error("This entity is not registered as a valid ComplexType");}e=u.getCtor();yt.getDefaultInstance().startTracking(n,e.prototype)},i=n.prototype;return i.getEntityAspect=function(){var n=this.parent,t;if(!n)return new ii(null);for(t=n.entityAspect;n&&!t;)n=n.complexAspect&&n.complexAspect.parent,t=n&&n.entityAspect;return t||new ii(null)},i.getPropertyPath=function(n){var t=this.parent,i;return t?(i=t.complexAspect||t.entityAspect,i.getPropertyPath(this.parentProperty.name+"."+n)):null},n}();i.EntityAspect=ii;i.ComplexAspect=lr;h=function(){function u(n){return n.join(f)}var f=":::",n=function(n,i){t(n,"entityType").isInstanceOf(a).check();var f=n.getSelfAndSubtypes();f.length>1&&(this._subtypes=f.filter(function(n){return n.isAbstract===!1}));Array.isArray(i)||(i=b(arguments,1));this.entityType=n;n.keyProperties.forEach(function(n,t){n.dataType===r.Guid&&(i[t]=i[t]&&i[t].toLowerCase())});this.values=i;this._keyInGroup=u(i)},i;return n._$typeName="EntityKey",i=n.prototype,i.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},n.fromJSON=function(n,t){var i=t._getEntityType(n.entityType,!0);return new h(i,n.values)},i.equals=function(n){return n instanceof h&&this.entityType===n.entityType&&hi(this.values,n.values)},i.toString=function(n){return(n||this.entityType).name+"-"+this._keyInGroup},n.equals=function(n,t){return n instanceof h&&n.equals(t)},i._isEmpty=function(){return 0===this.values.join("").length},n.createKeyString=u,n}();i.EntityKey=h;f=function(){var t={isUnchanged:function(){return this===n.Unchanged},isAdded:function(){return this===n.Added},isModified:function(){return this===n.Modified},isDeleted:function(){return this===n.Deleted},isDetached:function(){return this===n.Detached},isUnchangedOrModified:function(){return this===n.Unchanged||this===n.Modified},isAddedModifiedOrDeleted:function(){return this===n.Added||this===n.Modified||this===n.Deleted}},n=new ot("EntityState",t);return n.Unchanged=n.addSymbol(),n.Added=n.addSymbol(),n.Modified=n.addSymbol(),n.Deleted=n.addSymbol(),n.Detached=n.addSymbol(),n.resolveSymbols(),n}();i.EntityState=f;i.makePrimitiveArray=function(){function t(t,i,r){return ni.initializeParent(t,i,r),t.arrayChanged=new k("arrayChanged",t),o(t,ni.mixin),o(t,n)}var n={};return n._getGoodAdds=function(n){return n},n._beforeChange=function(){var n=this.getEntityAspect();n.entityState.isUnchanged()&&n.setModified();n.entityState.isModified()&&!this._origValues&&(this._origValues=this.slice(0))},n._processAdds=function(){},n._processRemoves=function(){},n._rejectChanges=function(){this._origValues&&(this.length=0,Array.prototype.push.apply(this,this._origValues))},n._acceptChanges=function(){this._origValues=null},t}();i.makeRelationArray=function(){function t(n,t){var i=u(n,t),e,r;return i.length?(e=n.parentEntity,r=e.entityAspect.entityManager,r&&!r.isLoading&&i.forEach(function(t){if(t.entityAspect.entityState.isDetached()){n._inProgress=!0;try{r.attachEntity(t,f.Added)}finally{n._inProgress=!1}}}),i):i}function i(n,t){var i=n.parentEntity,u=n.navigationProperty,r=n._addsInProcess,f=u.getInverse(),e=r.length;try{t.forEach(function(n){if(r.push(n),f)n.setProperty(f.name,i);else{var t=i.entityType.keyProperties;u.invForeignKeyNames.forEach(function(r,u){n.setProperty(r,i.getProperty(t[u].name))})}})}finally{r.splice(e,t.length)}}function r(n,t){var i=n.navigationProperty.getInverse();i&&t.forEach(function(n){n.setProperty(i.name,null)})}function u(n,t){var u,f=n.parentEntity,i=n.navigationProperty,e=i.getInverse(),r,o;return e?u=t.filter(function(t){if(n._addsInProcess.indexOf(t)>=0)return!1;var i=t.getProperty(e.name);return i!==f}):(r=i.invForeignKeyNames,i.baseProperty&&!r.length&&(r=i.baseProperty.invForeignKeyNames),o=f.entityType.keyProperties,u=t.filter(function(t){return!(n._addsInProcess.indexOf(t)>=0)&&r.some(function(n,i){var r=o[i].name,u=f.getProperty(r),e=t.getProperty(n);return u!==e})})),u}function e(t,i,r){return t.parentEntity=i,t.navigationProperty=r,t.arrayChanged=new k("arrayChanged",t),t._addsInProcess=[],o(t,ni.mixin),o(t,n)}var n={};return n.load=function(n,t){var i=this.parentEntity,r=it.fromEntityNavigation(this.parentEntity,this.navigationProperty),u=i.entityAspect.entityManager;return u.executeQuery(r,n,t)},n._getEventParent=function(){return this.parentEntity.entityAspect},n._getPendingPubs=function(){var n=this.parentEntity.entityAspect.entityManager;return n&&n._pendingPubs},n._getGoodAdds=function(n){return t(this,n)},n._processAdds=function(n){i(this,n)},n._processRemoves=function(n){r(this,n)},e}();r=function(){function r(n,t){throw n=g(n,t),new Error(n);}function p(t){switch(t){case n.String:return s.string;case n.Int64:return s.int64;case n.Int32:return s.int32;case n.Int16:return s.int16;case n.Decimal:return s.number;case n.Double:return s.number;case n.Single:return s.number;case n.DateTime:return s.date;case n.DateTimeOffset:return s.date;case n.Boolean:return s.bool;case n.Guid:return s.guid;case n.Byte:return s.byte;case n.Binary:return s.none;case n.Time:return s.duration;case n.Undefined:return s.none}}var i,h=function(){i={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1}},y;h();var w=function(){return i.stringPrefix+t().toString()},t=function(){var n=i.nextNumber;return i.nextNumber+=i.nextNumberIncrement,n},b=function(){return ci()},c=function(){return new Date},l=function(){for(var t=new Date,n=new Date;t.getTime()===n.getTime();)n=new Date;return n},k=function(n){return null==n?n:n.toString()},d=function(n,t){return"string"===t?n.trim().toLowerCase():n},u=function(n,t){var i,r;return"string"===t?(i=n.trim(),""===i)?null:(r=parseInt(i,10),isNaN(r)?n:r):"number"===t?Math.round(n):n},e=function(n,t){var i,r;return"string"===t?(i=n.trim(),""===i)?null:(r=parseFloat(i),isNaN(r)?n:r):n},a=function(n,t){var i,r;return"string"===t?(r=n.trim(),""===r?null:(i=new Date(Date.parse(r)),lt(i)?i:n)):"number"===t?(i=new Date(n),lt(i)?i:n):n},nt=function(n,t){if("string"===t){var i=n.trim().toLowerCase();return"false"!==i&&""!==i&&("true"===i||n)}return n},tt=function(n){return null==n?null:"'"+n.replace(/'/g,"''")+"'"},o=function(n){return null==n?null:"string"==typeof n?parseInt(n,10):n},f=function(n){return function(t){return null==t?null:("string"==typeof t&&(t=parseFloat(t)),t+n)}},it=function(n){if(null==n)return null;try{return"datetime'"+n.toISOString()+"'"}catch(t){r("'%1' is not a valid dateTime",n)}},rt=function(n){if(null==n)return null;try{return"datetimeoffset'"+n.toISOString()+"'"}catch(t){r("'%1' is not a valid dateTime",n)}},ut=function(n){return null==n?null:(ir(n)||r("'%1' is not a valid ISO 8601 duration",n),"time'"+n+"'")},ft=function(n){return null==n?null:(tr(n)||r("'%1' is not a valid guid",n),"guid'"+n+"'")},et=function(n){return null==n?null:"string"==typeof n?"true"===n.trim().toLowerCase():!!n},st=function(n){return null==n?n:"binary'"+n+"'"},ht=function(n){return n},v=function(t){return lt(t)||(t=n.parseDateFromServer(t)),t},ct=function(n){return n&&void 0!==n.$value&&(n=n.$value),n},n=new ot("DataType",{});return n.String=n.addSymbol({defaultValue:"",parse:k,fmtOData:tt,getNext:w}),n.Int64=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:u,fmtOData:f("L"),getNext:t}),n.Int32=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:u,fmtOData:o,getNext:t}),n.Int16=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:u,fmtOData:o,getNext:t}),n.Byte=n.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:u,fmtOData:o}),n.Decimal=n.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,isFloat:!0,parse:e,fmtOData:f("m"),getNext:t}),n.Double=n.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:e,fmtOData:f("d"),getNext:t}),n.Single=n.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:e,fmtOData:f("f"),getNext:t}),n.DateTime=n.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:a,parseRawValue:v,normalize:function(n){return n&&n.getTime&&n.getTime()},fmtOData:it,getNext:c,getConcurrencyValue:l}),n.DateTimeOffset=n.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:a,parseRawValue:v,normalize:function(n){return n&&n.getTime&&n.getTime()},fmtOData:rt,getNext:c,getConcurrencyValue:l}),n.Time=n.addSymbol({defaultValue:"PT0S",fmtOData:ut,parseRawValue:n.parseTimeFromServer}),n.Boolean=n.addSymbol({defaultValue:!1,parse:nt,fmtOData:et}),n.Guid=n.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",parse:d,fmtOData:ft,getNext:b,parseRawValue:function(n){return n.toLowerCase()},getConcurrencyValue:ci}),n.Binary=n.addSymbol({defaultValue:null,fmtOData:st,parseRawValue:ct}),n.Undefined=n.addSymbol({defaultValue:void 0,fmtOData:ht}),n.resolveSymbols(),n.getComparableFn=function(t){return t&&t.normalize?t.normalize:t===n.Time?function(n){return n&&tu(n)}:function(n){return n}},n.fromEdmDataType=function(t){var u=null,i=t.split("."),r;return i.length>1&&(r=i[1],u="image"===r?n.Byte:2===i.length?n.fromName(r)||n.Undefined:n.String),u},n.fromValue=function(t){if(lt(t))return n.DateTime;switch(typeof t){case"string":return tr(t)?n.Guid:ir(t)&&t.length>3?n.Time:wu(t)?n.DateTime:n.String;case"boolean":return n.Boolean;case"number":return n.Double}return n.Undefined},y=/.\d{3}$/,n.parseTimeFromServer=function(n){if("string"==typeof n)return n;if(n&&"Edm.Time"===n.__edmType){var t=Math.floor(n.ms/1e3);return"PT"+t+"S"}return n},n.parseDateAsUTC=function(n){if("string"==typeof n){var t=y.test(n);n=t?n+"Z":n}return new Date(Date.parse(n))},n.parseDateFromServer=n.parseDateAsUTC,n.parseRawValue=function(n,t){if(void 0!==n)return n?(t&&t.parseRawValue&&(n=t.parseRawValue(n)),n):n},n.constants=i,n._resetConstants=h,n.getSymbols().forEach(function(n){n.validatorCtor=p(n)}),n}();i.DataType=r;l=function(){function i(n,t){return t&&(c(t).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("uriBuilderName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(yi).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(n),n.serviceName=n.serviceName&&l._normalizeServiceName(n.serviceName),n.adapterInstance=n.adapterName&&v.getAdapterInstance("dataService",n.adapterName),n.uriBuilder=n.uriBuilderName&&v.getAdapterInstance("uriBuilder",n.uriBuilderName)),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="DataService",t.using=function(n){if(!n)return this;var t=new l(this);return i(t,n)},n.resolve=function(n){n.push({hasServerMetadata:!0,useJsonp:!1});var t=new l(kr(n,["serviceName","adapterName","uriBuilderName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!t.serviceName)throw new Error("Unable to resolve a 'serviceName' for this dataService");return t.adapterInstance=t.adapterInstance||v.getAdapterInstance("dataService",t.adapterName),t.jsonResultsAdapter=t.jsonResultsAdapter||t.adapterInstance.jsonResultsAdapter,t.uriBuilder=t.uriBuilder||v.getAdapterInstance("uriBuilder",t.uriBuilderName),t},n._normalizeServiceName=function(n){return n=n.trim(),"/"!==n.substr(-1)?n+"/":n},t.toJSON=function(){return ct(this,{serviceName:null,adapterName:null,uriBuilderName:null,hasServerMetadata:null,jsonResultsAdapter:function(n){return n&&n.name},useJsonp:null})},n.fromJSON=function(n){return n.jsonResultsAdapter=v._fetchObject(yi,n.jsonResultsAdapter),new l(n)},t.qualifyUrl=function(n){var t=this.serviceName;return u.stringEndsWith(t,"/")&&(t=t.substr(0,t.length-1)),n="/"+n,u.stringEndsWith(t,n)||(t+=n),t},n}();yi=function(){function i(n){return n.results}function r(n){return n.entities||n.Entities||[]}function u(n){return n.keyMappings||n.KeyMappings||[]}function f(n){return n.deletedKeys||n.DeletedKeys||[]}var n=function(n){if(1!==arguments.length)throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");c(n).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(i).whereParam("extractSaveResults").isFunction().isOptional().withDefault(r).whereParam("extractKeyMappings").isFunction().isOptional().withDefault(u).whereParam("extractDeletedKeys").isFunction().isOptional().withDefault(f).whereParam("visitNode").isFunction().applyAll(this);v._storeObject(this,t._$typeName,this.name)},t=n.prototype;return t._$typeName="JsonResultsAdapter",n}();i.DataService=l;i.JsonResultsAdapter=yi;e=u.requireLib("Q;q");e||(e=function(){throw new Error("Q is undefined. Are you missing Q.js? See https://github.com/kriskowal/q");},e.defer=e.resolve=e.reject=e);i.config.setQ=function(n){i.Q=e=n};i.Q=e;var ri=function(){function y(n){var i=[],t,r;for(t in n)r=n[t],t===r.name&&i.push(n[t]);return i}function w(n,t,i){var o=gt(t.shortName,t.namespace),r=n._getEntityType(o,!0),f,e;return r?i?b(r,t):r:(f={shortName:t.shortName,namespace:t.namespace,isAbstract:t.isAbstract,autoGeneratedKeyType:ht.fromName(t.autoGeneratedKeyType),defaultResourceName:t.defaultResourceName,custom:t.custom},(r=t.isComplexType?new pt(f):new a(f),t.baseTypeName)?(r.baseTypeName=t.baseTypeName,e=n._getEntityType(t.baseTypeName,!0),e?u(n,t,r,e):nr(n._deferredTypes,t.baseTypeName).push({json:t,stype:r})):u(n,t,r),r)}function b(n,t){return t.custom&&(n.custom=t.custom),h(n,t.dataProperties),h(n,t.navigationProperties),n}function h(n,t){t&&t.forEach(function(t){var i=t.name,r;if(!i){if(!t.nameOnServer)throw new Error("Unable to complete 'importMetadata' - cannot locate a 'name' or 'nameOnServer' for one of the imported property nodes");i=n.metadataStore.namingConvention.serverPropertyNameToClient(t.nameOnServer,{})}t.custom&&(r=n.getProperty(i,!0),r.custom=t.custom)})}function u(n,t,i){var e,r,f;t.validators&&(i.validators=t.validators.map(s.fromJSON));t.dataProperties.forEach(function(n){i._addPropertyCore(p.fromJSON(n))});e=!t.isComplexType;e&&t.navigationProperties&&t.navigationProperties.forEach(function(n){i._addPropertyCore(st.fromJSON(n))});n.addEntityType(i);r=n._deferredTypes;f=r[i.name];f&&(f.forEach(function(t){u(n,t.json,t.stype)}),delete r[i.name])}function f(n,t,i){if(ou(t))return t;var r=n._shortNameMap[t];if(!r&&i)throw new Error("Unable to locate 'entityTypeName' of: "+t);return r}var nt=0,r=function(n){n=n||{};c(n).whereParam("namingConvention").isOptional().isInstanceOf(wi).withDefault(wi.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(pi).withDefault(pi.defaultInstance).whereParam("serializerFn").isOptional().isFunction().applyAll(this);this.dataServices=[];this._resourceEntityTypeMap={};this._structuralTypeMap={};this._shortNameMap={};this._ctorRegistry={};this._incompleteTypeMap={};this._incompleteComplexTypeMap={};this._id=nt++;this.metadataFetched=new k("metadataFetched",this)},n=r.prototype;return n._$typeName="MetadataStore",k.bubbleEvent(n,null),r.ANONTYPE_PREFIX="_IB_",r.normalizeTypeName=nu(function(n){return n&&eu(n).typeName}),n.setProperties=function(n){c(n).whereParam("name").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().applyAll(this)},n.addDataService=function(n,i){t(n,"dataService").isInstanceOf(l).check();t(i,"shouldOverwrite").isBoolean().isOptional().check();var r=this._getDataServiceIndex(n.serviceName);if(r>=0){if(!i)throw new Error("A dataService with this name '"+n.serviceName+"' already exists in this MetadataStore");this.dataServices[r]=n}else this.dataServices.push(n)},n._getDataServiceIndex=function(n){return or(this.dataServices,function(t){return t.serviceName===n})},n.addEntityType=function(n){var i,t;if((n instanceof a||n instanceof pt||(n=n.isComplexType?new pt(n):new a(n)),!n.isComplexType)&&(n.baseTypeName&&!n.baseEntityType&&(i=this._getEntityType(n.baseTypeName,!0),n._updateFromBase(i)),0===n.keyProperties.length&&!n.isAbstract))throw new Error("Unable to add "+n.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.");if(n.metadataStore=this,!n.isAnonymous){if(this._structuralTypeMap[n.name])throw new Error("Type "+n.name+" already exists in this MetadataStore.");this._structuralTypeMap[n.name]=n;this._shortNameMap[n.shortName]=n.name}(n.getProperties().forEach(function(t){n._updateNames(t);t.isUnmapped||n._mappedPropertiesCount++}),n._updateCps(),n.isComplexType)||(n._updateNps(),t=n.defaultResourceName||n.baseEntityType&&n.baseEntityType.defaultResourceName,t&&!this.getEntityTypeNameForResourceName(t)&&this.setEntityTypeForResourceName(t,n.name),n.defaultResourceName=t,n.getEntityCtor())},n.exportMetadata=function(){return JSON.stringify({metadataVersion:i.metadataVersion,name:this.name,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:fi(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,v.stringifyPad)},n.importMetadata=function(n,r){var u,h,f,e,s;if(t(r,"allowMerge").isOptional().isBoolean().check(),this._deferredTypes={},u="string"==typeof n?JSON.parse(n):n,u.schema)return of.parse(this,u.schema,u.altMetadata);if(u.metadataVersion&&u.metadataVersion!==i.metadataVersion){h=g("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",u.metadataVersion,i.metadataVersion);throw new Error(h);}if(f=u.namingConvention,e=u.localQueryComparisonOptions,this.isEmpty())this.namingConvention=v._fetchObject(wi,f)||this.namingConvention,this.localQueryComparisonOptions=v._fetchObject(pi,e)||this.localQueryComparisonOptions;else{if(f&&this.namingConvention.name!==f)throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(e&&this.localQueryComparisonOptions.name!==e)throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore");}return s=this,u.dataServices&&u.dataServices.forEach(function(n){n=l.fromJSON(n);s.addDataService(n,!0)}),this._structuralTypeMap,u.structuralTypes&&u.structuralTypes.forEach(function(n){w(s,n,r)}),o(this._resourceEntityTypeMap,u.resourceEntityTypeMap),o(this._incompleteTypeMap,u.incompleteTypeMap),this},r.importMetadata=function(n){var t=new ri;return t.importMetadata(n),t},n.hasMetadataFor=function(n){return!!this.getDataService(n)},n.getDataService=function(n){return t(n,"serviceName").isString().check(),n=l._normalizeServiceName(n),d(this.dataServices,function(t){return t.serviceName===n})},n.fetchMetadata=function(n,i,r){try{if(t(n,"dataService").isString().or().isInstanceOf(l).check(),t(i,"callback").isFunction().isOptional().check(),t(r,"errorCallback").isFunction().isOptional().check(),"string"==typeof n&&(n=this.getDataService(n)||new l({serviceName:n})),n=l.resolve([n]),this.hasMetadataFor(n.serviceName))throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+n.serviceName);var u=this;return n.adapterInstance.fetchMetadata(this,n).then(function(t){return u.metadataFetched.publish({metadataStore:u,dataService:n,rawMetadata:t}),i&&i(t),e.resolve(t)},function(n){return r&&r(n),e.reject(n)})}catch(f){return e.reject(f)}},n.trackUnmappedType=function(n,i){t(n,"entityCtor").isFunction().check();t(i,"interceptor").isFunction().isOptional().check();var r=new a(this);r._setCtor(n,i)},n.registerEntityTypeCtor=function(n,i,r,u){var o,e,s;t(n,"structuralTypeName").isString().check();t(i,"aCtor").isFunction().isOptional().check();t(r,"initFn").isOptional().isFunction().or().isString().check();t(u,"noTrackingFn").isOptional().isFunction().check();o=f(this,n,!1);e=o||n;(i&&(i._$typeName&&i._$typeName!=e&&console.warn("Registering a constructor for "+e+" that is already used for "+i._$typeName+"."),i._$typeName=e),this._ctorRegistry[e]={ctor:i,initFn:r,noTrackingFn:u},o)&&(s=this._structuralTypeMap[o],s&&s.getCtor(!0))},n.isEmpty=function(){return ut(this._structuralTypeMap)},n.getEntityType=function(n,i){return t(n,"structuralTypeName").isString().check(),t(i,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(n,i)},n._getEntityType=function(n,t){var e=f(this,n,!1),i=this._structuralTypeMap[e],r,u;if(!i){if(t)return null;r=g("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",n);throw new Error(r);}if(i.length){u=i.join(",");throw new Error("There are multiple types with this 'shortName': "+u);}return i},n.getEntityTypes=function(){return y(this._structuralTypeMap)},n.getIncompleteNavigationProperties=function(){return fi(this._incompleteTypeMap,function(n,t){return t})},n.getEntityTypeNameForResourceName=function(n){return t(n,"resourceName").isString().check(),this._resourceEntityTypeMap[n]},n.setEntityTypeForResourceName=function(n,i){var u,r;t(n,"resourceName").isString().check();t(i,"entityTypeOrName").isInstanceOf(a).or().isString().check();u=i instanceof a?i.name:f(this,i,!0);this._resourceEntityTypeMap[n]=u;r=this._getEntityType(u,!0);r&&!r.defaultResourceName&&(r.defaultResourceName=n)},n._checkEntityType=function(n){var t,i;if(!n.entityType){if(t=n.prototype._$typeName,!t)throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");i=this._getEntityType(t);i&&(n.entityType=i)}},r}(),of=function(){function e(t,i,r){var u,f;if(t._entityTypeResourceMap={},i=w(i),i.forEach(function(r){if(r.cSpaceOSpaceMapping){var f=JSON.parse(r.cSpaceOSpaceMapping),u={};f.forEach(function(n){u[n[0]]=n[1]});r.cSpaceOSpaceMapping=u}r.entityContainer&&w(r.entityContainer).forEach(function(i){w(i.entitySet).forEach(function(i){var u=n(i.entityType,r).typeName;t.setEntityTypeForResourceName(i.name,u);t._entityTypeResourceMap[u]=i.name})});r.complexType&&w(r.complexType).forEach(function(n){h(n,r,t)});r.entityType&&w(r.entityType).forEach(function(n){o(n,r,i,t)})}),u=t.getIncompleteNavigationProperties(),u.length>0){f=u.map(function(n){return Array.isArray(n)?n.map(function(n){return n.parentType.name+":"+n.name}).join(", "):n.parentType.name+":"+n.name}).join(", ");throw new Error("Incomplete navigation properties: "+f);}return r&&t.importMetadata(r,!0),t}function o(r,u,f,e){var c=r.name,v=i(c,u),o=new a({shortName:c,namespace:v,isAbstract:r.abstract&&"true"===r.abstract}),s,l,h;return r.baseType?(s=n(r.baseType,u).typeName,o.baseTypeName=s,l=e._getEntityType(s,!0),l?t(o,r,u,f,e):(h=e._deferredTypes[s],h||(h=[],e._deferredTypes[s]=h),h.push({entityType:o,csdlEntityType:r}))):t(o,r,u,f,e),o}function t(n,i,r,f,e){var h=i.key?w(i.key.propertyRef).map(ei("name")):[],o,s;w(i.property).forEach(function(t){u(n,t,r,h)});w(i.navigationProperty).forEach(function(t){l(n,t,r,f)});e.addEntityType(n);n.defaultResourceName=e._entityTypeResourceMap[n.name];o=e._deferredTypes;s=o[n.name];s&&(s.forEach(function(n){t(n.entityType,n.csdlEntityType,r,f,e)}),delete o[n.name])}function h(n,t,r){var e=n.name,o=i(e,t),f=new pt({shortName:e,namespace:o});return w(n.property).forEach(function(n){u(f,n,t)}),r.addEntityType(f),f}function u(n,t,i,r){var u,e=t.type.split(".");return"Edm"===e[0]&&2===e.length?u=f(n,t,r):v(t,i)?(u=f(n,t,r),u&&(u.enumType=t.type)):u=c(n,t,i),u&&(n._addPropertyCore(u),k(u)),u}function f(n,t,i){var f=r.fromEdmDataType(t.type),s,e,u,o;return null==f?(n.warnings.push("Unable to recognize DataType for property: "+t.name+" DateType: "+t.type),null):(s="true"===t.nullable||null==t.nullable,e=null!=i&&i.indexOf(t.name)>=0,e&&n.autoGeneratedKeyType===ht.None&&g(t)&&(n.autoGeneratedKeyType=ht.Identity),u=t.maxLength,u=null==u||"Max"===u?null:parseInt(u,10),o=new p({nameOnServer:t.name,dataType:f,isNullable:s,isPartOfKey:e,maxLength:u,defaultValue:t.defaultValue,concurrencyMode:t.concurrencyMode}),f===r.Undefined&&(o.rawTypeName=t.type),o)}function c(t,i,r){var u=n(i.type,r).typeName;return new p({nameOnServer:i.name,complexTypeName:u,isNullable:!1})}function l(t,i,r,u){var f=nt(i,r,u),o,s;if(!f)throw new Error("Unable to resolve Foreign Key Association: "+i.relationship);var h=d(f.end,function(n){return n.role===i.toRole}),l="*"!==h.multiplicity,a=n(h.type,r).typeName,e=f.referentialConstraint;if(e||"*"!=f.end[0].multiplicity||"*"!=f.end[1].multiplicity){if(o={nameOnServer:i.name,entityTypeName:a,isScalar:l,associationName:f.name},e){var v=e.principal,y=e.dependent,p=w(y.propertyRef),c=p.map(ei("name"));i.fromRole===v.role?o.invForeignKeyNamesOnServer=c:o.foreignKeyNamesOnServer=c}return s=new st(o),t._addPropertyCore(s),s}}function v(n,t){return t.enumType?y(n,t):!!t.extensions&&b(n,t)}function y(n,t){var r=w(t.enumType),i=n.type.split("."),u=i[i.length-1];return r.some(function(n){return n.name===u})}function b(n,t){var r=t.extensions.filter(function(n){return"EnumType"===n.name}),i=n.type.split("."),u=i[i.length-1];return r.some(function(n){return n.attributes.some(function(n){return"Name"===n.name&&n.value===u})})}function k(n){var t,i;(n.isNullable||n.validators.push(s.required()),n.isComplexProperty)||(n.dataType===r.String?n.maxLength?(i={maxLength:n.maxLength},t=s.maxLength(i)):t=s.string():t=n.dataType.validatorCtor(),n.validators.push(t))}function g(n){var i=d(Object.keys(n),function(n){return n.indexOf("StoreGeneratedPattern")>=0}),t,r;return i?"Identity"===n[i]:(t=n.extensions,!t)?!1:(r=d(t,function(n){return"StoreGeneratedPattern"===n.name&&"Identity"===n.value}),!!r)}function nt(t,i,r){var f=n(t.relationship,i),s=f.namespace,e=d(r,function(n){return n.namespace===s}),o,u;return e?(o=f.shortTypeName,u=e.association,!u)?null:(Array.isArray(u)||(u=[u]),d(u,function(n){return n.name===o})):null}function n(n,t){var r=eu(n),u;return t&&t.cSpaceOSpaceMapping&&(u=i(r.shortTypeName,t),u&&(r=vi(r.shortTypeName,u))),r}function i(n,t){var r,u=t.cSpaceOSpaceMapping,i;return u&&(i=u[t.namespace+"."+n],r=i&&i.substr(0,i.length-(n.length+1)))?r:t.entityType||"Default"!=t.namespace?t.namespace:null}return{parse:e}}(),a=function(){function y(n,t){return n.entityAspect||n.complexAspect?n.getProperty(t.name):n[t.name]}function b(n){var t=n.name.replace(/\W/g,"_");return Function("return function "+t+"(){}")()}function o(n,t){var i=n.complexAspect.parentProperty.dataType.dataProperties;return i.every(function(i){var r,u,f;return i.isSettable?(r=n.getProperty(i.name),u=t.getProperty(i.name),i.isComplexProperty)?o(r,u):(f=i.dataType,r===u||f&&f.normalize&&r&&u&&f.normalize(r)===f.normalize(u)):!0})}function l(n){return n.filter(function(n){return null==n.baseProperty})}function i(n,t,i){var o=i+"OnServer",u=t[i],f,r,e;if(u&&u.length)f=w(u).map(function(i){var r=n.clientPropertyNameToServer(i,t),u=n.serverPropertyNameToClient(r,t);if(i!==u)throw new Error("NamingConvention for this client property name does not roundtrip properly:"+i+"-->"+u);return r}),t[o]=Array.isArray(u)?f:f[0];else{if(r=t[o],!r||0===r.length)return;e=w(r).map(function(i){var r=n.serverPropertyNameToClient(i,t),u=n.clientPropertyNameToServer(r,t);if(i!==u)throw new Error("NamingConvention for this server property name does not roundtrip properly:"+i+"-->"+u);return r});t[i]=Array.isArray(r)?e:e[0]}}function v(n,t){var i=t._getEntityType(n.complexTypeName,!0);if(!i)return!1;if(!(i instanceof pt))throw new Error("Unable to resolve ComplexType with the name: "+n.complexTypeName+" for the property: "+property.name);return n.dataType=i,n.defaultValue=null,!0}function u(n,t){var i,r;return n.entityType?!0:(i=t._getEntityType(n.entityTypeName,!0),i?(n.entityType=i,n._resolveNp()):(r=nr(t._incompleteTypeMap,n.entityTypeName),kt(r,n)),!!i)}function k(n,t){var i=n.getPropertyNames(),u=yt.getDefaultInstance(),f=u.getTrackablePropertyNames(t);f.forEach(function(u){var f,o,e;if(i.indexOf(u)===-1){f=t[u];try{"function"==typeof f&&(f=f())}catch(s){}o=r.fromValue(f);e=new p({name:u,dataType:o,isNullable:!0,isUnmapped:!0});e.isSettable=vu(t,u);n.subtypes&&n.subtypes.length?n.getSelfAndSubtypes().forEach(function(n){n._addPropertyCore(new p(e))}):n._addPropertyCore(e)}})}var nt=0,f=function(n){if(arguments.length>1)throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");"MetadataStore"===n._$typeName?(this.metadataStore=n,this.shortName="Anon_"+ ++nt,this.namespace="",this.isAnonymous=!0):c(n).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(ht).isOptional().withDefault(ht.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().whereParam("serializerFn").isOptional().isFunction().whereParam("custom").isOptional().applyAll(this);this.name=gt(this.shortName,this.namespace);this.dataProperties=[];this.navigationProperties=[];this.complexProperties=[];this.keyProperties=[];this.foreignKeyProperties=[];this.inverseForeignKeyProperties=[];this.concurrencyProperties=[];this.unmappedProperties=[];this.validators=[];this.warnings=[];this._mappedPropertiesCount=0;this.subtypes=[];cr(this,n.dataProperties,p);cr(this,n.navigationProperties,st)},n=f.prototype,e=r.parseRawValue;return n._$typeName="EntityType",f.qualifyTypeName=gt,n.setProperties=function(n){c(n).whereParam("autoGeneratedKeyType").isEnumOf(ht).isOptional().whereParam("defaultResourceName").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().whereParam("custom").isOptional().applyAll(this);n.defaultResourceName&&(this.defaultResourceName=n.defaultResourceName)},n.isSubtypeOf=function(n){t(n,"entityType").isInstanceOf(a).check();var i=this;do{if(i===n)return!0;i=i.baseEntityType}while(i);return!1},n.getSelfAndSubtypes=function(){var n=[this];return this.subtypes.forEach(function(t){var i=t.getSelfAndSubtypes();n.push.apply(n,i)}),n},n.getAllValidators=function(){for(var t=this.validators.slice(0),n=this.baseEntityType;n;)t.push.apply(t,n.validators),n=n.baseEntityType;return t},n.addProperty=function(n){var r,i;return t(n,"property").isInstanceOf(p).or().isInstanceOf(st).check(),r=this._addPropertyCore(n,!0),this.subtypes&&this.subtypes.length&&(i=this,i.getSelfAndSubtypes().forEach(function(t){t!==i&&(n.isNavigationProperty?t._addPropertyCore(new st(n),!0):t._addPropertyCore(new p(n),!0))})),r},n._updateFromBase=function(n){this.baseEntityType=n;this.autoGeneratedKeyType===ht.None&&(this.autoGeneratedKeyType=n.autoGeneratedKeyType);n.dataProperties.forEach(function(n){var t=new p(n);t.validators=[];t.baseProperty=n;this._addPropertyCore(t)},this);n.navigationProperties.forEach(function(n){var t=new st(n);t.validators=[];t.baseProperty=n;this._addPropertyCore(t)},this);n.subtypes.push(this)},n._addPropertyCore=function(n,t){var f,r,e;if(this.isFrozen)throw new Error("The '"+this.name+"' EntityType/ComplexType has been frozen. You can only add properties to an EntityType/ComplexType before any instances of that type have been created and attached to an entityManager.");if(f=n.parentType,f){if(f!==this)throw new Error("This property: "+n.name+" has already been added to "+n.parentType.name);return this}return n.parentType=this,r=this.metadataStore,(n.isDataProperty?this._addDataProperty(n):(this._addNavigationProperty(n),t&&r&&u(n,r)),!r||n.name&&n.nameOnServer||i(r.namingConvention,n,"name"),r&&this._extra&&this._extra.alreadyWrappedProps)&&(e=this._ctor.prototype,yt.getDefaultInstance().initializeEntityPrototype(e)),this},n.createEntity=function(n){if(n&&n._$eref&&!n._$eref.entityAspect.entityManager)return n._$eref;var t=this._createInstanceCore();return n&&(this.keyProperties.every(function(t){return null!=n[t.name]})&&(n._$eref=t),this._updateTargetFromRaw(t,n,y),this.navigationProperties.forEach(function(i){var u,r=n[i.name],f,e;void 0!=r&&(f=i.entityType,i.isScalar?(u=r.entityAspect?r:f.createEntity(r),t.setProperty(i.name,u)):(e=t.getProperty(i.name),r.forEach(function(n){u=n.entityAspect?n:f.createEntity(n);e.push(u)})))})),this._initializeInstance(t),t},n._createInstanceCore=function(){var t=this.getEntityCtor(),n=new t;return new ii(n),n},n._initializeInstance=function(n){this.baseEntityType&&this.baseEntityType._initializeInstance(n);var t=this.initFn;t&&("string"==typeof t&&(t=n[t]),t(n));this.complexProperties&&this.complexProperties.forEach(function(t){var i=n.getProperty(t.name);Array.isArray(i)?i.forEach(function(n){t.dataType._initializeInstance(n)}):t.dataType._initializeInstance(i)});n.entityAspect&&(n.entityAspect._initialized=!0)},n.getCtor=n.getEntityCtor=function(n){var r;if(this._ctor&&!n)return this._ctor;var u=this.metadataStore._ctorRegistry,i=u[this.name]||u[this.shortName]||{},t=i.ctor||this._ctor,f=t&&t.prototype&&(t.prototype.entityType||t.prototype.complexType);if(f&&f.metadataStore!==this.metadataStore)throw new Error("Cannot register the same constructor for "+this.name+" in different metadata stores.  Please define a separate constructor for each metadata store.");return(i.ctor&&n&&(this._extra=void 0),t)||(r=yt.getDefaultInstance().createCtor,t=r?r(this):b(this)),this.initFn=i.initFn,this.noTrackingFn=i.noTrackingFn,t.prototype._$typeName=this.name,this._setCtor(t),t},n._setCtor=function(n,t){var i=n.prototype,r;this._extra=this._extra||{};r=new n;k(this,r);"EntityType"===this._$typeName?i.entityType=this:i.complexType=this;i._$interceptor=t||gu;yt.getDefaultInstance().initializeEntityPrototype(i);this._ctor=n},n.addValidator=function(n,i){t(n,"validator").isInstanceOf(s).check();t(i,"property").isOptional().isString().or().isEntityProperty().check();i?("string"==typeof i&&(i=this.getProperty(i,!0)),i.validators.push(n)):this.validators.push(n)},n.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},n.getPropertyNames=function(){return this.getProperties().map(ei("name"))},n.getDataProperty=function(n){return d(this.dataProperties,ki("name",n))},n.getNavigationProperty=function(n){return d(this.navigationProperties,ki("name",n))},n.getProperty=function(n,t){var i=this.getPropertiesOnPath(n,!1,t);return i?i[i.length-1]:null},n.getPropertiesOnPath=function(n,t,i){i=i||!1;var f=Array.isArray(n)?n:n.trim().split("."),u=!0,r=this,e=t?"nameOnServer":"name",o=f.map(function(n){var t=d(r.getProperties(),ki(e,n));if(t)r=t.isNavigationProperty?t.entityType:t.dataType;else{if(i)throw new Error("unable to locate property: "+n+" on entityType: "+r.name);u=!1}return t});return u?o:null},n.clientPropertyPathToServer=function(n,t){var i,t=t||".",r;return this.isAnonymous?(r=this.metadataStore.namingConvention.clientPropertyNameToServer,i=n.split(".").map(function(n){return r(n)})):i=this.getPropertiesOnPath(n,!1,!0).map(function(n){return n.nameOnServer}),i.join(t)},n.getEntityKeyFromRawEntity=function(n,t){var i=this.keyProperties.map(function(i){var r=t(n,i);return e(r,i.dataType)});return new h(this,i)},n._updateTargetFromRaw=function(n,t,i){var r,u;this.dataProperties.forEach(function(r){var f,u,h,s;if(r.isSettable&&(f=i(t,r),void 0!==f))if(h=r.dataType,r.isComplexProperty){if(null===f)return;(u=n.getProperty(r.name),r.isScalar)?h._updateTargetFromRaw(u,f,i):Array.isArray(f)?(s=f.map(function(t){var u=h._createInstanceCore(n,r);return h._updateTargetFromRaw(u,t,i),h._initializeInstance(u),u}),hi(u,s,o)||(u.length=0,s.forEach(function(n){u.push(n)}))):u.length=0}else r.isScalar?(s=e(f,h),n.setProperty(r.name,s)):(u=n.getProperty(r.name),Array.isArray(f))?(s=f.map(function(n){return e(n,h)}),hi(u,s)||(u.length=0,s.forEach(function(n){u.push(n)}))):u.length=0});r=t.entityAspect||t.complexAspect;r&&(u=n.entityAspect||n.complexAspect,r.originalValuesMap&&(u.originalValues=r.originalValuesMap),r.extraMetadata&&(u.extraMetadata=r.extraMetadata))},n.toString=function(){return this.name},n.toJSON=function(){return ct(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:l,navigationProperties:l,validators:null,custom:null})},n._updateNames=function(n){var t=this.metadataStore.namingConvention;i(t,n,"name");n.isNavigationProperty&&(i(t,n,"foreignKeyNames"),i(t,n,"invForeignKeyNames"))},n._checkNavProperty=function(n){if(n.isNavigationProperty){if(n.parentType!==this)throw new Error(g("The navigationProperty '%1' is not a property of entity type '%2'",n.name,this.name));return n}if("string"==typeof n){var t=this.getProperty(n);if(t&&t.isNavigationProperty)return t}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty");},n._addDataProperty=function(n){this.dataProperties.push(n);n.isPartOfKey&&this.keyProperties.push(n);n.isComplexProperty&&this.complexProperties.push(n);n.concurrencyMode&&"None"!==n.concurrencyMode&&this.concurrencyProperties.push(n);n.isUnmapped&&this.unmappedProperties.push(n)},n._addNavigationProperty=function(n){this.navigationProperties.push(n);ou(n.entityTypeName)||(n.entityTypeName=gt(n.entityTypeName,this.namespace))},n._updateCps=function(){var n=this.metadataStore,t=n._incompleteComplexTypeMap;this.complexProperties.forEach(function(i){i.complexType||v(i,n)||nr(t,i.complexTypeName).push(i)});this.isComplexType&&((t[this.name]||[]).forEach(function(t){v(t,n)}),delete t[this.name])},n._updateNps=function(){var n=this.metadataStore,t;this.navigationProperties.forEach(function(t){u(t,n)});t=n._incompleteTypeMap;(t[this.name]||[]).forEach(function(t){u(t,n)});delete t[this.name]},f}(),pt=function(){var i=function(n){if(arguments.length>1)throw new Error("The ComplexType ctor has a single argument that is a configuration object.");c(n).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().whereParam("custom").isOptional().applyAll(this);this.name=gt(this.shortName,this.namespace);this.isComplexType=!0;this.dataProperties=[];this.complexProperties=[];this.validators=[];this.concurrencyProperties=[];this.unmappedProperties=[];this.navigationProperties=[];this.keyProperties=[];cr(this,n.dataProperties,p)},n=i.prototype;return n.setProperties=function(n){c(n).whereParam("custom").isOptional().applyAll(this)},n.getAllValidators=function(){return this.validators},n._createInstanceCore=function(n,t){var r=this.getCtor(),i=new r;return new lr(i,n,t),i},n.addProperty=function(n){return t(n,"dataProperty").isInstanceOf(p).check(),this._addPropertyCore(n)},n.getProperties=function(){return this.dataProperties},n=o(n,a.prototype,["addValidator","getProperty","getPropertiesOnPath","getPropertyNames","_addPropertyCore","_addDataProperty","_updateNames","_updateCps","_initializeInstance","_updateTargetFromRaw","_setCtor"]),n.createInstance=a.prototype.createEntity,n.getCtor=a.prototype.getEntityCtor,n.toJSON=function(){return ct(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null,custom:null})},n._$typeName="ComplexType",i}(),p=function(){var t=function(n){var i,t;if(c(n).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(r).isOptional().or().isString().or().isInstanceOf(pt).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("isScalar").isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("isSettable").isBoolean().isOptional().withDefault(!0).whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(s).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("custom").isOptional().applyAll(this),i=!(!this.name&&!this.nameOnServer),!i)throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if("string"==typeof this.dataType){if(t=r.fromName(this.dataType),!t)throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=t}else this.dataType||(this.dataType=r.String);if(null==this.defaultValue){if(this.isNullable)this.defaultValue=null;else if(!this.isComplexProperty)if(this.dataType===r.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,null==this.defaultValue)throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+(this.name||this.nameOnServer));}else this.dataType.isNumeric&&"string"==typeof this.defaultValue&&(this.defaultValue=parseFloat(this.defaultValue));this.isComplexProperty&&(this.isScalar=null==this.isScalar||this.isScalar===!0)},n=t.prototype;return n._$typeName="DataProperty",t.getRawValueFromServer=function(n,t){if(t.isUnmapped)return n[t.nameOnServer||t.name];var i=n[t.nameOnServer];return void 0!==i?i:t.defaultValue},t.getRawValueFromClient=function(n,t){var i=n[t.name];return void 0!==i?i:t.defaultValue},n.isDataProperty=!0,n.isNavigationProperty=!1,n.resolveProperty=function(n){for(var i=this[n],t=this.baseProperty;void 0==i&&null!=t;)i=t[n],t=t.baseProperty;return i},n.formatName=function(){return this.parentType.name+"--"+this.name},n.setProperties=function(n){c(n).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this)},n.getAllValidators=function(){for(var t=this.validators.slice(0),n=this.baseProperty;n;)t.push.apply(t,n.validators),n=n.baseProperty;return t},n.toJSON=function(){return ct(this,{name:null,dataType:function(n){if(n&&n.parentEnum)return n.name},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,isSettable:!0,concurrencyMode:null,maxLength:null,validators:null,displayName:null,enumType:null,rawTypeName:null,isScalar:!0,custom:null})},t.fromJSON=function(n){return n.dataType=r.fromName(n.dataType),n.defaultValue&&n.dataType&&n.dataType.parse&&(n.defaultValue=n.dataType.parse(n.defaultValue,typeof n.defaultValue)),n.validators&&(n.validators=n.validators.map(s.fromJSON)),new p(n)},t}(),st=function(){function t(n,t){throw new Error("Cannot set the inverse property for: "+n.formatName()+". "+t);}function i(n,t){throw new Error("Cannot create inverse for: "+n.formatName()+". The entityType for this navigation property "+t);}function u(n){var t=n.foreignKeyNames;if(0!==t.length){var i=n.parentType,r=t.map(function(n){return i.getDataProperty(n)}),u=i.foreignKeyProperties;r.forEach(function(t){kt(u,t);t.relatedNavigationProperty=n;kt(n.entityType.inverseForeignKeyProperties,t);n.relatedDataProperties?kt(n.relatedDataProperties,t):n.relatedDataProperties=[t]})}}var r=function(n){c(n).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().isOptional().withDefault(!0).whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(s).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this);var t=!(!this.name&&!this.nameOnServer);if(!t)throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property");},n=r.prototype;return n._$typeName="NavigationProperty",n.isDataProperty=!1,n.isNavigationProperty=!0,o(n,p.prototype,["formatName","getAllValidators","resolveProperty"]),n.setProperties=function(n){if(!this.parentType)throw new Error("Cannot call NavigationProperty.setProperties until the parent EntityType of the NavigationProperty has been set.");var t=n.inverse;t&&delete n.inverse;c(n).whereParam("displayName").isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("custom").isOptional().applyAll(this);this.parentType._updateNames(this);this._resolveNp();t&&this.setInverse(t)},n.getInverse=function(){for(var n=this;!n.inverse&&n.baseProperty;)n=n.baseProperty;return n.inverse},n.setInverse=function(n){var i;if(i="string"==typeof n?this.entityType.getNavigationProperty(n):n,!i)throw t(this,"Unable to find inverse property: "+invNpName);(this.inverse||i.inverse)&&t(this,"It has already been set on one side or the other.");i.entityType!=this.parentType&&t(this,i.formatName+" is not a valid inverse property for this.");this.associationName?i.associationName=this.associationName:(i.associationName||(i.associationName=this.formatName()+"_"+i.formatName()),this.associationName=i.associationName);this._resolveNp();i._resolveNp()},n.createInverse=function(n){var r,t;return this.entityType||i(this,"has not yet been defined."),this.entityType.isFrozen&&i(this,"is frozen."),r=this.entityType.metadataStore,null==r&&i(this,"has not yet been added to the metadataStore."),n.entityTypeName=this.parentEntityType.name,n.associationName=this.associationName,t=new st(n),this.parentEntityType.addNavigationProperty(t),t},n.toJSON=function(){return ct(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,displayName:null,foreignKeyNames:null,invForeignKeyNames:null,custom:null})},r.fromJSON=function(n){return n.validators&&(n.validators=n.validators.map(s.fromJSON)),new st(n)},n._resolveNp=function(){var n=this,t=n.entityType,i=d(t.navigationProperties,function(t){return t.associationName===n.associationName&&(t.name!==n.name||t.entityTypeName!==n.entityTypeName)});n.inverse=i;i||n.invForeignKeyNames.forEach(function(i){var r=t.getDataProperty(i),u;if(!r)throw new Error("EntityType '"+n.entityTypeName+"' has no foreign key matching '"+i+"'");u=n.parentType;r.inverseNavigationProperty=d(u.navigationProperties,function(n){return n.invForeignKeyNames&&n.invForeignKeyNames.indexOf(r.name)>=0&&n.entityType===r.parentType});kt(t.foreignKeyProperties,r)});u(n)},r}(),ht=function(){var n=new ot("AutoGeneratedKeyType");return n.None=n.addSymbol(),n.Identity=n.addSymbol(),n.KeyGenerator=n.addSymbol(),n.resolveSymbols(),n}();!function(){function t(n,t){return null!=t&&void 0!==t.entityType}function i(n,t){return null!=t&&(t.isDataProperty||t.isNavigationProperty)}var n=ur.prototype;n.isEntity=function(){return this._addContext({fn:t,msg:" must be an entity"})};n.isEntityProperty=function(){return this._addContext({fn:i,msg:" must be either a DataProperty or a NavigationProperty"})}}();i.MetadataStore=ri;i.EntityType=a;i.ComplexType=pt;i.DataProperty=p;i.NavigationProperty=st;i.AutoGeneratedKeyType=ht;ar=function(){function i(n,t,i){var u=t.name+".."+t.parentType.name,r=n._tempIdMap[u];return r||i&&(r={entityType:t.parentType,propertyName:t.name,keyMap:{}},n._tempIdMap[u]=r),r}var n=function(){this._tempIdMap={}},t=n.prototype;return t.generateTempKeyValue=function(n,t){var o=n.keyProperties,r,e,f,u;if(o.length>1)throw new Error("Ids can not be autogenerated for entities with multipart keys");if(e=o[0],f=i(this,e,!0),null!=t&&(f.keyMap[t.toString()]||(r=t)),void 0===r){if(u=e.dataType,!u.getNext)throw new Error("Cannot use a property with a dataType of: "+u.toString()+" for id generation");for(r=u.getNext(this);null!=f.keyMap[r.toString()];)r=u.getNext(this)}return f.keyMap[r.toString()]=!0,r},t.getTempKeys=function(){var t=[],i,n,r,u;for(i in this._tempIdMap){n=this._tempIdMap[i];r=n.entityType;for(u in n.keyMap)t.push(new h(r,[u]))}return t},t.isTempKey=function(n){var r=n.entityType.keyProperties,u,t;return r.length>1?!1:(u=r[0],t=i(this,u),!!t&&void 0!==t.keyMap[n.values[0].toString()])},v.registerType(n,"KeyGenerator"),n}();i.KeyGenerator=ar;pi=function(){var n=function(n){c(n||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this);this.name||(this.name=ci());v._storeObject(this,t._$typeName,this.name)},t=n.prototype;return t._$typeName="LocalQueryComparisonOptions",n.caseInsensitiveSQL=new n({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),n.defaultInstance=new n(n.caseInsensitiveSQL),t.setAsDefault=function(){return oi(this,n)},n}();i.LocalQueryComparisonOptions=pi;wi=function(){var n=function(n){c(n||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this);this.name||(this.name=ci());v._storeObject(this,t._$typeName,this.name)},t=n.prototype;return t._$typeName="NamingConvention",n.none=new n({name:"noChange",serverPropertyNameToClient:function(n){return n},clientPropertyNameToServer:function(n){return n}}),n.camelCase=new n({name:"camelCase",serverPropertyNameToClient:function(n){return n.substr(0,1).toLowerCase()+n.substr(1)},clientPropertyNameToServer:function(n){return n.substr(0,1).toUpperCase()+n.substr(1)}}),n.defaultInstance=new n(n.none),t.setAsDefault=function(){return oi(this,n)},n}();i.NamingConvention=wi;ft=function(){function s(n,t){var r=t.entityType,u,h,f;if(Array.isArray(n)){if(!t.isRHS)throw new Error("Array expressions are only permitted on the right hand side of a BinaryPredicate");return new i(n,t.dataType)}if(!ai(n)){if(null!=n&&bu(n)&&!n.toISOString){if(void 0===n.value)throw new Error("Unable to resolve an expression for: "+n+" on entityType: "+r.name);return n.isProperty?new e(n.value):new i(n.value,n.dataType||t.dataType,!0)}return new i(n,t.dataType)}if(t.isRHS)return null==r||r.isAnonymous?new i(n,t.dataType):v(n,t);for(var o,s=[],c=0;o=/\([^()]*\)/.exec(n);)u=o[0],s.push(u),h=p+c++,n=n.replace(u,h);return f=l(n,s,t),f._validate(r,t.usesNameOnServer),f}function l(n,t,i){var r=n.split(p);return 1===r.length?v(r[0],i):w(n,r,t,i)}function v(n,t){var u,o,s,f,h;return(n=n.trim(),u=n.substr(0,1),o=("'"===u||'"'===u)&&n.length>1&&n.substr(n.length-1)===u,o)?(s=n.substr(1,n.length-2),new i(s,t.dataType||r.String)):(f=t.entityType,null==f||f.isAnonymous)?new e(n):(h=nt.test(n),h&&null!=f.getPropertiesOnPath(n,t.usesNameOnServer,!1)?new e(n):new i(n,t.dataType))}function w(n,t,i,u){var s,f,h;try{s=t[0].trim().toLowerCase();f=i[t[1]].trim();"("===f.substr(0,1)&&(f=f.substr(1,f.length-2));var c=n.indexOf("'")>=0?tt:it,a=f.match(c),e=o({},u);return e.dataType=r.Undefined,e.isFnArg=!0,h=a.map(function(n){return l(n,i,e)}),new d(s,h)}catch(v){return null}}var n=function(){function o(t,i){var r=i[0];return r instanceof n?r=b(i):Array.isArray(r)||(r=[n(b(i))]),[t].concat(r)}function s(n,t,i){var r=t.toLowerCase();i.key=r;n[r]=i;i.aliases&&i.aliases.forEach(function(t){n[t.toLowerCase()]=i})}function e(n){var i={},r={},t;return i[n[0]]=r,t=n[1],t=t.operator||t,r[t]=3==n.length?n[2]:e(n.splice(2)),c(i)}function c(i){if(i instanceof n)return i;if("object"!=typeof i)throw new Error("Unable to convert to a Predicate: "+i);var u=Object.keys(i),r=u.map(function(n){return l(n,i[n])});return 1===r.length?r[0]:new t("and",r)}function l(n,i){if(t.prototype._resolveOp(n,!0))return new t(n,i);if(h.prototype._resolveOp(n,!0))return new h(n,i);if("object"!=typeof i||null==i||lt(i)||et(i,"value"))return new u("eq",n,i);if(Array.isArray(i))throw new Error("Unable to resolve predicate after the phrase: "+n);var r=n,e=Object.keys(i),f=e.map(function(n){if(y.prototype._resolveOp(n,!0))return new y(n,r,i[n]);if(u.prototype._resolveOp(n,!0))return new u(n,r,i[n]);if(et(i[n],"value"))return new u("eq",r,i[n]);var t=g("Unable to resolve predicate after the phrase: '%1' for operator: '%2'  and value: '%3'",r,n,i[n]);throw new Error(t);});return 1===f.length?f[0]:new t("and",f)}var r=function(){if(0!==arguments.length){if(1===arguments.length){var t=arguments[0];return Array.isArray(t)?1===t.length?n(t[0]):e(t):t instanceof n?t:"string"==typeof t?new k(t):c(t)}return e(Array.prototype.slice.call(arguments,0))}},i=r.prototype;return r.create=r,r.and=function(){var n=new t("and",b(arguments));return n.op&&n},r.or=function(){var n=new t("or",b(arguments));return n.op&&n},r.not=function(n){return n.not()},r.extendBinaryPredicateFn=function(n,t){var e=f.binaryPredicate,i,r;for(i in n||{})r=n[i],r.visitorFn=t,s(u.prototype.aliasMap,i,n[i]);f.isExtended||(f.binaryPredicate=function(n,t,i){var r=this.aliasMap[this.op.key].visitorFn;return r?r(n,t,i):e(n,t,i)},f.isExtended=!0)},i.and=function(){return new t("and",o(this,arguments))},i.or=function(){return new t("or",o(this,arguments))},i.not=function(){return new h("not",this)},i.toJSON=function(){return this.toJSONExt({entityType:this._entityType})},i.toJSONExt=function(n){return this.visit(n,rt)},i.toFunction=function(n){return this.visit(n,f)},i.toString=function(){return JSON.stringify(this)},i.visit=function(n,t){var r,i;if(ut(n))n={entityType:null};else if(n instanceof a)n={entityType:n};else if(!et(n,"entityType"))throw new Error("All visitor methods must be called with a context object containing at least an 'entityType' property");if(t?n.visitor=t:t=n.visitor,r=t[this.visitorMethodName],null==r)throw new Error("Unable to locate method: "+this.visitorMethodName+" on visitor");return i=n.entityType,(this._validate&&null==i||this._entityType!==i)&&(this._validate(i,n.usesNameOnServer),this._entityType=i),Array.prototype.slice.call(arguments,1),r.call(this,n)},i._initialize=function(n,t){var r,i;this.visitorMethodName=n;r=this.aliasMap={};for(i in t||{})s(r,i,t[i])},i._resolveOp=function(n,t){n=n.operator||n;var i=this.aliasMap[n.toLowerCase()];if(!i&&!t)throw new Error("Unable to resolve operator: "+n);return i},r}(),k=function(){var t=function(n){this.value=n},i=t.prototype=new n;return i._initialize("passthruPredicate"),i._validate=iu,t}(),h=function(){var t=function(t,i){this.op=this._resolveOp(t);this.pred=n(i)},i=t.prototype=new n;return i._initialize("unaryPredicate",{not:{aliases:["!","~"]}}),i._validate=function(n,t){this.pred._validate(n,t)},t}(),u=function(){var t=function(n,t,i){this.op=this._resolveOp(n);this.expr1Source=t;this.expr2Source=i},r=t.prototype=new n;return r._initialize("binaryPredicate",{eq:{aliases:["==","equals"]},ne:{aliases:["!=","~=","notequals"]},lt:{aliases:["<","lessthan"]},le:{aliases:["<=","lessthanorequal"]},gt:{aliases:[">","greaterthan"]},ge:{aliases:[">=","greaterthanorequal"]},startswith:{isFunction:!0},endswith:{isFunction:!0},contains:{aliases:["substringof"],isFunction:!0},"in":{}}),r._validate=function(n,t){var r={entityType:n,usesNameOnServer:t},u;if(this.expr1=s(this.expr1Source,r),null==this.expr1)throw new Error("Unable to validate 1st expression: "+this.expr1Source);if(this.expr1 instanceof i)throw new Error("The left hand side of a binary predicate cannot be a literal expression, it must be a valid property or functional predicate expression: "+this.expr1Source);if("in"==this.op.key&&!Array.isArray(this.expr2Source))throw new Error("The 'in' operator requires that its right hand argument be an array");if(u=o(r,{isRHS:!0,dataType:this.expr1.dataType}),this.expr2=s(this.expr2Source,u),null==this.expr2)throw new Error("Unable to validate 2nd expression: "+this.expr2Source);null==this.expr1.dataType&&(this.expr1.dataType=this.expr2.dataType)},t}(),t=function(){var t=function(t,i){if(this.op=this._resolveOp(t),1==i.length&&Array.isArray(i[0])&&(i=i[0]),this.preds=i.filter(function(n){return null!=n}).map(function(t){return n(t)}),0==this.preds.length&&(this.op=null),1==this.preds.length)return this.preds[0]},i=t.prototype=new n;return i._initialize("andOrPredicate",{and:{aliases:["&&"]},or:{aliases:["||"]}}),i._validate=function(n,t){this.preds.every(function(i){i._validate(n,t)})},t}(),y=function(){var t=function(t,i,r){this.op=this._resolveOp(t);this.exprSource=i;this.pred=n(r)},i=t.prototype=new n;return i._initialize("anyAllPredicate",{any:{aliases:["some"]},all:{aliases:["every"]}}),i._validate=function(n,t){this.expr=s(this.exprSource,{entityType:n,usesNameOnServer:t});(null==n||n.isAnonymous)&&(this.expr.dataType=null);this.pred._validate(this.expr.dataType,t)},t}(),c=function(t){this.visitorMethodName=t;this.visit=n.prototype.visit;this._validate=iu},i=function(){function t(n){if(null==n||r.contains(n))return n;if(ai(n)){var t=r.fromName(n);if(t)return t;throw new Error("Unable to resolve a dataType named: "+n);}throw new Error("The dataType parameter passed into this literal expression is not a 'DataType'"+n);}var n=function(n,i,u){i=t(i);i=i||r.fromValue(n);this.value=i&&i.parse?Array.isArray(n)?n.map(function(n){return i.parse(n,typeof n)}):i.parse(n,typeof n):n;this.dataType=i;this.hasExplicitDataType=u},i=n.prototype=new c("litExpr");return i.toString=function(){return" LitExpr - value: "+this.value.toString()+" dataType: "+this.dataType.toString()},n}(),e=function(){var n=function(n){this.propertyPath=n},t=n.prototype=new c("propExpr");return t.toString=function(){return" PropExpr - "+this.propertyPath},t._validate=function(n,t){var i,u,r;if(null!=n&&!n.isAnonymous){if(i=n.getPropertiesOnPath(this.propertyPath,t,!1),!i){u=g("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",n.name,this.propertyPath);throw new Error(u);}r=i[i.length-1];this.dataType=r.isDataProperty?r.dataType:r.entityType}},n}(),d=function(){var n=function(n,t){this.fnName=n;this.exprs=t;var r=i[n];if(null==r)throw new Error("Unknown function: "+n);this.localFn=r.fn;this.dataType=r.dataType},t=n.prototype=new c("fnExpr"),i;return t.toString=function(){var n=this.exprs.map(function(n){n.toString()}).toString();return"FnExpr - "+this.fnName+"("+n+")"},t._validate=function(n,t){this.exprs.forEach(function(i){i._validate(n,t)})},i=n.funcMap={toupper:{fn:function(n){return n.toUpperCase()},dataType:r.String},tolower:{fn:function(n){return n.toLowerCase()},dataType:r.String},substring:{fn:function(n,t,i){return n.substring(t,i)},dataType:r.String},substringof:{fn:function(n,t){return t.indexOf(n)>=0},dataType:r.Boolean},length:{fn:function(n){return n.length},dataType:r.Int32},trim:{fn:function(n){return n.trim()},dataType:r.String},concat:{fn:function(n,t){return n.concat(t)},dataType:r.String},replace:{fn:function(n,t,i){return n.replace(t,i)},dataType:r.String},startswith:{fn:function(n,t){return dt(n,t)},dataType:r.Boolean},endswith:{fn:function(n,t){return hr(n,t)},dataType:r.Boolean},indexof:{fn:function(n,t){return n.indexOf(t)},dataType:r.Int32},round:{fn:function(n){return Math.round(n)},dataType:r.Int32},ceiling:{fn:function(n){return Math.ceil(n)},dataType:r.Int32},floor:{fn:function(n){return Math.floor(n)},dataType:r.Int32},second:{fn:function(n){return n.getSeconds()},dataType:r.Int32},minute:{fn:function(n){return n.getMinutes()},dataType:r.Int32},day:{fn:function(n){return n.getDate()},dataType:r.Int32},month:{fn:function(n){return n.getMonth()+1},dataType:r.Int32},year:{fn:function(n){return n.getFullYear()},dataType:r.Int32}},n}(),nt=/^[a-z_][\w.$]*$/i,tt=/('[^']*'|[^,]+)/g,it=/("[^"]*"|[^,]+)/g,p=String.fromCharCode(191),f=function(){function t(n){switch(n.key){case"any":return function(n,t){return n.some(function(n){return t(n)})};case"all":return function(n,t){return n.every(function(n){return t(n)})};default:throw new Error("Unknown operator: "+n.key);}}function i(t,i,o){var h,c=t.op,s=r.getComparableFn(i);switch(c.key){case"eq":h=function(t,i){return t&&"string"==typeof t?n(t,i,o):s(t)==s(i)};break;case"ne":h=function(t,i){return t&&"string"==typeof t?!n(t,i,o):s(t)!=s(i)};break;case"gt":h=function(n,t){return s(n)>s(t)};break;case"ge":h=function(n,t){return s(n)>=s(t)};break;case"lt":h=function(n,t){return s(n)<s(t)};break;case"le":h=function(n,t){return s(n)<=s(t)};break;case"startswith":h=function(n,t){return u(n,t,o)};break;case"endswith":h=function(n,t){return f(n,t,o)};break;case"contains":h=function(n,t){return e(n,t,o)};break;case"in":h=function(n,t){return n=s(n),t=t.map(function(n){return s(n)}),t.indexOf(n)>=0};break;default:return null}return h}function n(n,t,i){return null!=t&&("string"!=typeof t&&(t=t.toString()),i.usesSql92CompliantStringComparison&&(n=(n||"").trim(),t=(t||"").trim()),i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),n===t)}function u(n,t,i){return i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),dt(n,t)}function f(n,t,i){return i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),hr(n,t)}function e(n,t,i){return i.isCaseSensitive||(n=(n||"").toLowerCase(),t=(t||"").toLowerCase()),n.indexOf(t)>=0}return{passthruPredicate:function(){throw new Error("Cannot execute an PassthruPredicate expression against the local cache: "+this.value);},unaryPredicate:function(n){var t=this.pred.visit(n);switch(this.op.key){case"not":return function(n){return!t(n)};default:throw new Error("Invalid unary operator:"+this.op.key);}},binaryPredicate:function(n){var r=this.expr1.visit(n),u=this.expr2.visit(n),f=this.expr1.dataType||this.expr2.dataType,e=n.entityType.metadataStore.localQueryComparisonOptions,t=i(this,f,e);if(null==t)throw new Error("Invalid binaryPredicate operator:"+this.op.key);return function(n){return t(r(n),u(n))}},andOrPredicate:function(n){var t=this.preds.map(function(t){return t.visit(n)});switch(this.op.key){case"and":return function(n){return t.reduce(function(t,i){return t&&i(n)},!0)};case"or":return function(n){return t.reduce(function(t,i){return t||i(n)},!1)};default:throw new Error("Invalid boolean operator:"+op.key);}},anyAllPredicate:function(n){var f=this.expr.visit(n),i=o({},n),r,u;return i.entityType=this.expr.dataType,r=this.pred.visit(i),u=t(this.op),function(n){return u(f(n),r)}},litExpr:function(){var n=this.value;return function(){return n}},propExpr:function(){var n=this.propertyPath,t=n.split(".");return 1===t.length?function(t){return t.getProperty(n)}:function(n){return rr(n,t)}},fnExpr:function(n){var t=this.exprs.map(function(t){return t.visit(n)}),i=this;return function(n){var r=t.map(function(t){return t(n)});return i.localFn.apply(null,r)}}}}(),rt=function(){function n(t,i){var r=Object.keys(i).every(function(r){if(t.hasOwnProperty(r)){if("object"!=typeof i[r]||null==n(t[r],i[r]))return!1}else t[r]=i[r];return!0});return r?t:null}return{passthruPredicate:function(){return this.value},unaryPredicate:function(n){var i=this.pred.visit(n),t={};return t[this.op.key]=i,t},binaryPredicate:function(n){var u=this.expr1.visit(n),t=this.expr2.visit(n),i={},r;return(this.expr2 instanceof e&&(t={value:t,isProperty:!0}),"eq"===this.op.key)?i[u]=t:(r={},i[u]=r,r[this.op.key]=t),i},andOrPredicate:function(t){var i=this.preds.map(function(n){return n.visit(t)}),r;return!i||!i.length?{}:("and"!==this.op.key||2!==i.length||i.some(ai)||(r=i.reduce(n)),null==r&&(r={},r[this.op.key]=i),r)},anyAllPredicate:function(n){var u=this.expr.visit(n),t=o({},n);t.entityType=this.expr.dataType;var f=this.pred.visit(t),i={},r={};return r[this.op.key]=f,i[u]=r,i},litExpr:function(n){return this.hasExplicitDataType||n.useExplicitDataType?{value:this.value,dataType:this.dataType.name}:this.value},propExpr:function(n){return n.toNameOnServer?n.entityType.clientPropertyPathToServer(this.propertyPath):this.propertyPath},fnExpr:function(n){var t=this.exprs.map(function(t){return t.visit(n)});return this.fnName+"("+t.join(",")+")"}}}();return n}();i.Predicate=ft;var it=function(){function s(n,t){return ct(t,{"resourceName,from":null,"resultEntityType,toType":null,"wherePredicate,where":function(n){if(n)return new ft(n)},"orderByClause,orderBy":function(n){if(n)return new bi(n)},"selectClause,select":function(n){if(n)return new hu(n)},"expandClause,expand":function(n){if(n)return new cu(n)},"skipCount,skip":null,"takeCount,take":null,parameters:function(n){if(!ut(n))return n},"inlineCountEnabled,inlineCount":!1,"noTrackingEnabled,noTracking":!1,queryOptions:function(n){if(n)return tt.fromJSON(n)}},n),n}function i(n,t,i){if(t&&n[t]===i)return n;var r=o(new it,n,["resourceName","fromEntityType","wherePredicate","orderByClause","selectClause","skipCount","takeCount","expandClause","inlineCountEnabled","noTrackingEnabled","usesNameOnServer","queryOptions","entityManager","dataService","resultEntityType"]);return r.parameters=o({},n.parameters),t&&(r[t]=i),r}function f(n,t,i,r){var o=i._$typeName||i.parentEnum&&i.parentEnum.name,u=o&&o.substr(0,1).toLowerCase()+o.substr(1),e;if(r&&u!=r)throw new Error("Invalid value for property: "+r);if(u){if(e=t[u],void 0===e)throw new Error("Invalid config property: "+u);null===e?n[u]=i:e(n,i)}else rt(i,function(i,r){f(n,t,r,i)})}function u(n){return t(n,"propertyPaths").isOptional().isString().or().isArray().isString().check(),"string"==typeof n&&(n=n.split(",")),n=n.map(function(n){return n.trim()})}function c(n){var t=n.entityType,i=t.keyProperties.map(function(t){return ft.create(t.name,fr.Equals,n.getProperty(t.name))});return ft.and(i)}function e(n){var t=n.entityType.keyProperties,i=gi(t,n.values,function(n,t){return ft.create(n.name,fr.Equals,t)});return ft.and(i)}function v(n,t){var u,f,i,r,o,s;return t.isScalar?0===t.foreignKeyNames.length?null:(u=t.foreignKeyNames.map(function(t){return n.getProperty(t)}),f=new h(t.entityType,u),e(f)):(i=t.getInverse(),r=i?i.foreignKeyNames:t.invForeignKeyNames,0===r.length)?null:(o=n.entityAspect.getKey().values,s=gi(r,o,function(n,t){return ft.create(n,fr.Equals,t)}),ft.and(s))}var r=function(n){return null==n||ai(n)?(this.resourceName=n,this.fromEntityType=null,this.wherePredicate=null,this.orderByClause=null,this.selectClause=null,this.skipCount=null,this.takeCount=null,this.expandClause=null,this.parameters={},this.inlineCountEnabled=!1,this.noTrackingEnabled=!1,void(this.entityManager=null)):s(this,n)},n=r.prototype;return n._$typeName="EntityQuery",n.from=function(n){return t(n,"resourceName").isString().check(),i(this,"resourceName",n)},r.from=function(n){return t(n,"resourceName").isString().check(),new it(n)},n.toType=function(n){return t(n,"entityType").isString().or().isInstanceOf(a).check(),i(this,"resultEntityType",n)},n.where=function(n){return null!=n&&(n=ft.create(b(arguments)),this.fromEntityType&&n._validate(this.fromEntityType),this.wherePredicate&&(n=this.wherePredicate.and(n))),i(this,"wherePredicate",n)},n.orderBy=function(n,t){var r=null==n?null:new bi(u(n),t);return this.orderByClause&&r&&(r=new bi([this.orderByClause,r])),i(this,"orderByClause",r)},n.orderByDesc=function(n){return this.orderBy(n,!0)},n.select=function(n){var t=null==n?null:new hu(u(n));return i(this,"selectClause",t)},n.skip=function(n){return t(n,"count").isOptional().isNumber().check(),i(this,"skipCount",null==n?null:n)},n.top=function(n){return this.take(n)},n.take=function(n){return t(n,"count").isOptional().isNumber().check(),i(this,"takeCount",null==n?null:n)},n.expand=function(n){var t=null==n?null:new cu(u(n));return i(this,"expandClause",t)},n.withParameters=function(n){return t(n,"parameters").isObject().check(),i(this,"parameters",n)},n.inlineCount=function(n){return t(n,"enabled").isBoolean().isOptional().check(),n=void 0===n||!!n,i(this,"inlineCountEnabled",n)},n.useNameOnServer=function(n){return t(n,"usesNameOnServer").isBoolean().isOptional().check(),n=void 0===n||!!n,i(this,"usesNameOnServer",n)},n.noTracking=function(n){return t(n,"enabled").isBoolean().isOptional().check(),n=void 0===n||!!n,i(this,"noTrackingEnabled",n)},n.using=function(n){if(!n)return this;var t=i(this);return f(t,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(n,t){n.queryOptions=(n.queryOptions||new tt).using(t)},mergeStrategy:function(n,t){n.queryOptions=(n.queryOptions||new tt).using(t)},jsonResultsAdapter:function(n,t){n.dataService=(n.dataService||new l).using({jsonResultsAdapter:t})}},n),t},n.execute=function(n,t){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,n,t)},n.executeLocally=function(){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},n.toJSON=function(){return this.toJSONExt()},n.toJSONExt=function(n){n=n||{};n.entityType=n.entityType||this.fromEntityType;n.propertyPathFn=n.toNameOnServer?n.entityType.clientPropertyPathToServer.bind(n.entityType):pu;var t=function(t){if(t)return t.toJSONExt(n)};return ct(this,{"from,resourceName":null,"toType,resultEntityType":function(n){if(n)return ai(n)?n:n.name},"where,wherePredicate":t,"orderBy,orderByClause":t,"select,selectClause":t,"expand,expandClause":t,"skip,skipCount":null,"take,takeCount":null,parameters:function(n){if(!ut(n))return n},"inlineCount,inlineCountEnabled":!1,"noTracking,noTrackingEnabled":!1,queryOptions:null})},r.fromEntities=function(n){var u,r,f;if(t(n,"entities").isEntity().or().isNonEmptyArray().isEntity().check(),Array.isArray(n)||(n=b(arguments)),u=n[0],r=u.entityType,n.some(function(n){return n.entityType!==r}))throw new Error("All 'fromEntities' must be the same type; at least one is not of type "+r.name);var i=new it(r.defaultResourceName),e=n.map(function(n){return c(n)}),o=ft.or(e);return i=i.where(o),f=u.entityAspect.entityManager,f&&(i=i.using(f)),i},r.fromEntityKey=function(n){t(n,"entityKey").isInstanceOf(h).check();var i=new it(n.entityType.defaultResourceName),r=e(n);return i.where(r).toType(n.entityType)},r.fromEntityNavigation=function(n,i){var u;t(n,"entity").isEntity().check();var f=n.entityType._checkNavProperty(i),r=new it(f.entityType.defaultResourceName),e=v(n,f);return r=r.where(e),u=n.entityAspect.entityManager,u?r.using(u):r},n._getFromEntityType=function(n,t){var i=this.fromEntityType,r,u;if(i)return i;if(r=this.resourceName,!r)throw new Error("There is no resourceName for this query");if(n.isEmpty()){if(t)throw new Error("There is no metadata available for this query. Are you querying the local cache before you've fetched metadata?");return null}if(u=n.getEntityTypeNameForResourceName(r),i=u?n._getEntityType(u):this._getToEntityType(n,!0),!i){if(t)throw new Error(g("Cannot find an entityType for resourceName: '%1'.  Consider adding an 'EntityQuery.toType' call to your query or calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",r));return null}return this.fromEntityType=i,i},n._getToEntityType=function(n,t){return this.resultEntityType instanceof a?this.resultEntityType:this.resultEntityType?(this.resultEntityType=n._getEntityType(this.resultEntityType,!1),this.resultEntityType):t?null:!this.selectClause&&this._getFromEntityType(n,!1)},n._toUri=function(n){var t=l.resolve([n.dataService]);return t.uriBuilder.buildUri(this,n.metadataStore)},r}(),fr=function(){var n=new ot("FilterQueryOp");return n.Equals=n.addSymbol({operator:"eq"}),n.NotEquals=n.addSymbol({operator:"ne"}),n.GreaterThan=n.addSymbol({operator:"gt"}),n.LessThan=n.addSymbol({operator:"lt"}),n.GreaterThanOrEqual=n.addSymbol({operator:"ge"}),n.LessThanOrEqual=n.addSymbol({operator:"le"}),n.Contains=n.addSymbol({operator:"contains"}),n.StartsWith=n.addSymbol({operator:"startswith"}),n.EndsWith=n.addSymbol({operator:"endswith"}),n.Any=n.addSymbol({operator:"any"}),n.All=n.addSymbol({operator:"all"}),n.In=n.addSymbol({operator:"in"}),n.IsTypeOf=n.addSymbol({operator:"isof"}),n.resolveSymbols(),n}(),bi=(function(){var n=new ot("BooleanQueryOp");return n.And=n.addSymbol({operator:"and"}),n.Or=n.addSymbol({operator:"or"}),n.Not=n.addSymbol({operator:"not"}),n.resolveSymbols(),n}(),function(){var u=function(t,i){var r;if(t.length>1){if(t[0]instanceof bi)return void(this.items=Array.prototype.concat.apply(t[0].items,t.slice(1).map(ei("items"))));r=t.map(function(t){return new n(t,i)})}else r=[new n(t[0],i)];this.items=r},t=u.prototype,n,i;return t.validate=function(n){null==n||n.isAnonymous||this.items.forEach(function(t){t.validate(n)})},t.getComparer=function(n){var t=this.items.map(function(t){return t.getComparer(n)});return function(n,i){for(var u,r=0;r<t.length;r++)if(u=t[r](n,i),0!==u)return u;return 0}},t.toJSONExt=function(n){return this.items.map(function(t){return n.propertyPathFn(t.propertyPath)+(t.isDesc?" desc":"")})},n=function(n,t){var i,r;if("string"!=typeof n)throw new Error("propertyPath is not a string");if(n=n.trim(),i=n.split(" "),i.length>1&&t!==!0&&t!==!1&&(t=dt(i[1].toLowerCase(),"desc"),!t)&&(r=dt(i[1].toLowerCase(),"asc"),!r))throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'");this.propertyPath=i[0];this.isDesc=t},i=n.prototype,i.validate=function(n){null==n||n.isAnonymous||(this.lastProperty=n.getProperty(this.propertyPath,!0))},i.getComparer=function(n){var u,f,t,i;return(this.lastProperty||this.validate(n),this.lastProperty)&&(u=this.lastProperty.dataType,f=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive),t=this.propertyPath,i=this.isDesc,function(n,e){var o=rr(n,t),s=rr(e,t),c=u||o&&r.fromValue(o)||r.fromValue(s),h;return c===r.String?f?(o=o||"",s=s||""):(o=(o||"").toLowerCase(),s=(s||"").toLowerCase()):(h=r.getComparableFn(c),o=h(o),s=h(s)),o===s?0:o>s||void 0===s?i?-1:1:i?1:-1}},u}()),hu=function(){var t=function(n){this.propertyPaths=n;this._pathNames=n.map(function(n){return n.replace(".","_")})},n=t.prototype;return n.validate=function(n){null==n||n.isAnonymous||this.propertyPaths.forEach(function(t){n.getProperty(t,!0)})},n.toFunction=function(){var n=this;return function(t){var i={};return n.propertyPaths.forEach(function(r,u){i[n._pathNames[u]]=rr(t,r)}),i}},n.toJSONExt=function(n){return this.propertyPaths.map(function(t){return n.propertyPathFn(t)})},t}(),cu=function(){var n=function(n){this.propertyPaths=n},t=n.prototype;return t.toJSONExt=function(n){return this.propertyPaths.map(function(t){return n.propertyPathFn(t)})},n}();i.FilterQueryOp=fr;i.EntityQuery=it;i.OrderByClause=bi;var y=function(){var n=new ot("MergeStrategy");return n.PreserveChanges=n.addSymbol(),n.OverwriteChanges=n.addSymbol(),n.SkipMerge=n.addSymbol(),n.Disallowed=n.addSymbol(),n.resolveSymbols(),n}(),ui=function(){var n=new ot("FetchStrategy");return n.FromServer=n.addSymbol(),n.FromLocalCache=n.addSymbol(),n.resolveSymbols(),n}(),tt=function(){function i(n,t){return t&&c(t).whereParam("fetchStrategy").isEnumOf(ui).isOptional().whereParam("mergeStrategy").isEnumOf(y).isOptional().whereParam("includeDeleted").isBoolean().isOptional().applyAll(n),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="QueryOptions",n.resolve=function(n){return new tt(kr(n,["fetchStrategy","mergeStrategy","includeDeleted"]))},n.defaultInstance=new n({fetchStrategy:ui.FromServer,mergeStrategy:y.PreserveChanges,includeDeleted:!1}),t.using=function(n){if(!n)return this;var t=new tt(this);return y.contains(n)?n={mergeStrategy:n}:ui.contains(n)&&(n={fetchStrategy:n}),i(t,n)},t.setAsDefault=function(){return oi(this,n)},t.toJSON=function(){return ct(this,{fetchStrategy:null,mergeStrategy:null,includeDeleted:!1})},n.fromJSON=function(n){return new tt({fetchStrategy:ui.fromName(n.fetchStrategy),mergeStrategy:y.fromName(n.mergeStrategy),includeDeleted:n.includeDeleted===!0})},n}();return i.QueryOptions=tt,i.FetchStrategy=ui,i.MergeStrategy=y,lu=function(){function i(n){if(n){if(1===n.length){var t=n[0];return function(n){return!!n&&n.entityAspect.entityState===t}}return function(t){return!!t&&-1!==n.indexOf(t.entityAspect.entityState)}}return function(n){return!!n}}var t=function(n,t){this.entityManager=n;this.entityType=t;this.entityType.isFrozen=!0;this._indexMap={};this._entities=[];this._emptyIndexes=[]},n=t.prototype;return n.attachEntity=function(n,t,i){var r=n.entityAspect,e,u,o;if(r._initialized||this.entityType._initializeInstance(n),delete r._initialized,e=r.getKey()._keyInGroup,u=this._indexMap[e],u>=0){var f=this._entities[u],s=f.entityAspect.entityState,h=s.isUnchanged();if(f===n)r.entityState=t;else{if(i===y.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' does not allow you to attach an entity when an entity with the same key is already attached: "+r.getKey());(i===y.OverwriteChanges||i===y.PreserveChanges&&h)&&(o=this.entityManager.helper.unwrapInstance(n),this.entityType._updateTargetFromRaw(f,o,p.getRawValueFromServer),f.entityAspect.setEntityState(t))}return f}return 0===this._emptyIndexes.length?u=this._entities.push(n)-1:(u=this._emptyIndexes.pop(),this._entities[u]=n),this._indexMap[e]=u,r.entityState=t,r.entityGroup=this,r.entityManager=this.entityManager,n},n.detachEntity=function(n){var r=n.entityAspect,i=r.getKey()._keyInGroup,t=this._indexMap[i];if(void 0===t)throw new Error("internal error - entity cannot be found in group");return delete this._indexMap[i],this._emptyIndexes.push(t),this._entities[t]=null,n},n.findEntityByKey=function(n){var i,t;return i=n instanceof h?n._keyInGroup:h.createKeyString(n),t=this._indexMap[i],void 0!==t?this._entities[t]:null},n.hasChanges=function(){for(var t,i=this._entities,r=f.Unchanged,n=0,u=i.length;n<u;n++)if(t=i[n],t&&t.entityAspect.entityState!==r)return!0;return!1},n.getChanges=function(){for(var n,i=this._entities,u=f.Unchanged,r=[],t=0,e=i.length;t<e;t++)n=i[t],n&&n.entityAspect.entityState!==u&&r.push(n);return r},n.getEntities=function(n){var t=i(n);return this._entities.filter(t)},n._checkOperation=function(n){return this._entities.forEach(function(t){t&&t.entityAspect._checkOperation(n)}),this},n._clear=function(){this._entities.forEach(function(n){null!=n&&n.entityAspect._detach()});this._entities=null;this._indexMap=null;this._emptyIndexes=null},n._updateFkVal=function(n,t,i){var r=n.name;this._entities.forEach(function(n){null!=n&&n.getProperty(r)==t&&n.setProperty(r,i)})},n._fixupKey=function(n,t){var r=this._indexMap[n],i,u;if(void 0===r)throw new Error("Internal Error in key fixup - unable to locate entity");i=this._entities[r];u=i.entityType.keyProperties[0].name;i.setProperty(u,t);delete i.entityAspect.hasTempKey;delete this._indexMap[n];this._indexMap[t]=r},n._replaceKey=function(n,t){var i=this._indexMap[n._keyInGroup];delete this._indexMap[n._keyInGroup];this._indexMap[t._keyInGroup]=i},t}(),vr=function(){function yt(n,t,i){var u=i?tt.defaultInstance:n.queryOptions,f=i?wt.defaultInstance:n.saveOptions,e=i?ti.defaultInstance:n.validationOptions,r=c(t).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(l).whereParam("queryOptions").isInstanceOf(tt).isOptional().withDefault(u).whereParam("saveOptions").isInstanceOf(wt).isOptional().withDefault(f).whereParam("validationOptions").isInstanceOf(ti).isOptional().withDefault(e).whereParam("keyGeneratorCtor").isFunction().isOptional();i&&(r=r.whereParam("metadataStore").isInstanceOf(ri).isOptional().withDefault(new ri));r.applyAll(n);di(n.queryOptions,u);di(n.saveOptions,f);di(n.validationOptions,e);t.serviceName&&(n.dataService=new l({serviceName:n.serviceName}));n.serviceName=n.dataService&&n.dataService.serviceName;n.keyGeneratorCtor=n.keyGeneratorCtor||ar;(i||t.keyGeneratorCtor)&&(n.keyGenerator=new n.keyGeneratorCtor)}function pt(n,i){var f,c,e,o,s,l;t(i,"query").isInstanceOf(it).check();var a=n.metadataStore,u=i._getFromEntityType(a,!0),v=pr(n,u),h=i.wherePredicate&&i.wherePredicate.toFunction({entityType:u}),y=tt.resolve([i.queryOptions,n.queryOptions,tt.defaultInstance]),p=y.includeDeleted===!0,w=function(n){return n&&(p||!n.entityAspect.entityState.isDeleted())&&(!h||h(n))},r=[];return v.forEach(function(n){var t=n._entities.filter(w);t.length&&(r=r.length?r.concat(t):t)}),f=i.orderByClause&&i.orderByClause.getComparer(u),(f&&r.sort(f),i.inlineCountEnabled)&&(c=r.length),e=i.skipCount,e&&(r=r.slice(e)),o=i.takeCount,o&&(r=r.slice(0,o)),s=i.selectClause,s&&(l=s.toFunction(),r=r.map(l)),{results:r,inlineCount:c}}function vi(n){n.forEach(function(n){var t=[],i=n.entityAspect;rt(i._validationErrors,function(n,i){i.isServerError&&t.push(n)});0!==t.length&&i._processValidationOpAndPublish(function(){t.forEach(function(n){i._removeValidationError(n)})})})}function yi(n){var t=[];return n.forEach(function(n){rt(n.entityAspect._validationErrors,function(i,r){var u=o({entity:n,errorName:r.validator.name},r,["errorMessage","propertyName","isServerError"]);t.push(u)})}),t}function pi(n,t){var r=t.entityErrors,i,u;r&&(i=n.entityManager,u=i.metadataStore,t.entityErrors=r.map(function(n){var t=null,r,f;if(n.keyValues&&(r=u._getEntityType(n.entityTypeName),f=new h(r,n.keyValues),t=i.findEntityByKey(f)),t){var s=n.propertyName?{propertyName:n.propertyName,property:r.getProperty(n.propertyName)}:{},c=at.getKey(n.errorName||n.errorMessage,n.propertyName),e=new at(null,s,n.errorMessage,c);e.isServerError=!0;t.entityAspect.addValidationError(e)}return o({entity:t,isServerError:!0},n,["errorName","errorMessage","propertyName"])}))}function kt(n,t){var i,f=gt(n,t),r=f.entityKey,o=0!==f.remainingArgs.length&&!!f.remainingArgs[0],u=!1;return o&&(i=n.getEntityByKey(r),u=!!i,u&&!n.queryOptions.includeDeleted&&i.entityAspect.entityState.isDeleted()&&(i=null,u=n.queryOptions.mergeStrategy!==y.OverwriteChanges)),u?e.resolve({entity:i,entityKey:r,fromCache:!0}):it.fromEntityKey(r).using(n).execute().then(function(n){return i=0===n.results.length?null:n.results[0],e.resolve({entity:i,entityKey:r,fromCache:!1})})}function s(n,i){return t(i,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(a).or().isNonEmptyArray().isInstanceOf(a).check(),"string"==typeof i?i=n.metadataStore._getEntityType(i,!1):Array.isArray(i)&&"string"==typeof i[0]&&(i=i.map(function(t){return n.metadataStore._getEntityType(t,!1)})),i}function dt(n,t){var i,r=et(n,t);return r.forEach(function(n){if(n){var t=n.getChanges();i?i.push.apply(i,t):i=t}}),i||[]}function wi(n,t,i){var r,u=et(n,t);return u.forEach(function(n){if(n){var t=n.getEntities(i);r?r.push.apply(r,t):r=t}}),r||[]}function gt(n,t){try{if(t[0]instanceof h)return{entityKey:t[0],remainingArgs:b(t,1)};if(t.length>=2){var i="string"==typeof t[0]?n.metadataStore._getEntityType(t[0],!1):t[0];return{entityKey:new h(i,t[1]),remainingArgs:b(t,2)}}}catch(r){}throw new Error("Must supply an EntityKey OR an EntityType name or EntityType followed by a key value or an array of key values.");}function ft(n,t){n.forEach(function(n){n.entityAspect.isBeingSaved=t})}function bi(n,t){var i,e=t&&t[0],o,r,u;return e?(i={},e.entityType)?t.forEach(function(n){if(n.entityAspect.entityState==f.Detached)throw new Error("Unable to export an entity with an EntityState of 'Detached'");var t=i[n.entityType.name];t||(t={},t.entityType=n.entityType,t._entities=[],i[n.entityType.name]=t);t._entities.push(n)}):(o=s(n,t),o.forEach(function(t){var r=n._entityGroupMap[t.name];r&&r._entities.length&&(i[t.name]=r)})):i=t&&0===t.length?{}:n._entityGroupMap,r=[],u={},rt(i,function(n,t){u[n]=ki(t,r)}),{entityGroupMap:u,tempKeys:r}}function ki(n,t){var i={},r=n.entityType,f=r.dataProperties,e=lt(r),u=[];return n._entities.forEach(function(n){if(n){var i=ni(n,f,e,t);u.push(i)}}),i.entities=u,i}function ni(n,t,i,r){var e={},u,f,o;return t.forEach(function(t){var u=t.name,r=n.getProperty(u),f;(null!=r||null!=t.defaultValue)&&(r&&t.isComplexProperty?(f=t.dataType.dataProperties,r=si(r,function(n){return ni(n,f,i)})):(r=i?i(t,r):r,t.isUnmapped&&(r=bt(r))),void 0!==r&&(e[u]=r))}),n.entityAspect?(u=n.entityAspect,o=u.entityState,f={tempNavPropNames:tr(u,r),entityState:o.name},u.extraMetadata&&(f.extraMetadata=u.extraMetadata),(o.isModified()||o.isDeleted())&&(f.originalValuesMap=u.originalValues),e.entityAspect=f):(u=n.complexAspect,f={},u.originalValues&&!ut(u.originalValues)&&(f.originalValuesMap=u.originalValues),e.complexAspect=f),e}function tr(n,t){var r=n.entity,i;return n.hasTempKey&&t.push(n.getKey().toJSON()),r.entityType.navigationProperties.forEach(function(n){if(n.relatedDataProperties){var t=r.getProperty(n.name);t&&t.entityAspect.hasTempKey&&(i=i||[],i.push(n.name))}}),i}function ir(n,t,i){var s=i.tempKeyMap,u=n.entityType,e=i.mergeStrategy,r=null,c=n.entityManager,l=c.entityChanged,a=[],o=p.getRawValueFromClient;return t.entities.forEach(function(t){var p=t.entityAspect,w=u.getEntityKeyFromRawEntity(t,o),i=f.fromName(p.entityState),v,b,k;if(!i||i==f.Detached)throw new Error("Only entities with a non detached entity state may be imported.");if(v=i.isAdded()&&ei(s,w),r=v?null:n.findEntityByKey(w)){if(e!==y.SkipMerge){if(e===y.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+w.toString()+" from being merged");b=r.entityAspect.entityState;k=b.isUnchanged();(e===y.OverwriteChanges||k)&&(u._updateTargetFromRaw(r,t,o),r.entityAspect.setEntityState(i),l.publish({entityAction:nt.MergeOnImport,entity:r}))}}else r=u._createInstanceCore(),u._updateTargetFromRaw(r,t,o),v&&(r.entityAspect.hasTempKey=!0,r.setProperty(u.keyProperties[0].name,v.values[0]),p.tempNavPropNames&&p.tempNavPropNames.forEach(function(n){var t=u.getNavigationProperty(n),i=t.relatedDataProperties[0].name,f=r.getProperty(i),e=new h(t.entityType,[f]),o=ei(s,e);r.setProperty(i,o.values[0])})),r=n.attachEntity(r,i),l.publish({entityAction:nt.AttachOnImport,entity:r}),i.isUnchanged()||c._notifyStateChange(r,!0);a.push(r)}),a}function ei(n,t){var i=n[t.toString()],r,u,f;if(i)return i;if(r=t._subtypes,!r)return null;for(u=0,f=r.length;u<f;u++)if(i=n[t.toString(r[u])])return i;return null}function oi(n,t,i){return n.then(function(n){return t&&t(n),e.resolve(n)},function(n){return i&&i(n),e.reject(n)})}function rr(n,t){return t?t.filter(function(t){if(t.entityAspect.entityManager!==n)throw new Error("Only entities in this entityManager may be saved");return!t.entityAspect.entityState.isDetached()}):n.getChanges()}function ur(n,t){n._inKeyFixup=!0;t.forEach(function(t){var i=n._entityGroupMap[t.entityTypeName];if(!i)throw new Error("Unable to locate the following fully qualified EntityType name: "+t.entityTypeName);i._fixupKey(t.tempValue,t.realValue)});n._inKeyFixup=!1}function et(n,t){var i=n._entityGroupMap;return t?w(t).map(function(n){if(n instanceof a)return i[n.name];throw new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null");}):wr(i)}function fr(n,t){var i=t.entityAspect.getKey(),r=gi(t.entityType.keyProperties,i.values,function(n,t){return n.defaultValue===t?n:null}).filter(function(n){return null!==n});if(r.length)if(t.entityType.autoGeneratedKeyType!==ht.None)n.generateTempKeyValue(t);else if(r.length===i.values.length)throw new Error("Cannot attach an object of type  ("+t.entityType.name+") to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'");}function er(n,t){return t?(t=w(t),t.forEach(function(n){if(!f.contains(n))throw new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates");}),t):null}function or(n,t,i,r){var u=t.entityType.navigationProperties;u.forEach(function(u){var f=t.getProperty(u.name);if(u.isScalar){if(!f)return;n.attachEntity(f,i,r)}else f.forEach(function(t){n.attachEntity(t,i,r)})})}function hi(n,t,i,r){var f,h,s,u,c;try{if(h=n.metadataStore,h.isEmpty()&&r.hasServerMetadata)throw new Error("cannot execute _executeQueryCore until metadataStore is populated.");if(i.fetchStrategy===ui.FromLocalCache)try{return s=pt(n,t),e.resolve({results:s.results,entityManager:n,inlineCount:s.inlineCount,query:t})}catch(o){return e.reject(o)}return u=new yr({query:t,entityManager:n,dataService:r,mergeOptions:{mergeStrategy:i.mergeStrategy,noTracking:!!t.noTrackingEnabled,includeDeleted:i.includeDeleted}}),c=n.validationOptions.validateOnQuery,r.adapterInstance.executeQuery(u).then(function(i){var o=gr(function(){var t={isLoading:n.isLoading};return n.isLoading=!0,n._pendingPubs=[],t},function(i){n.isLoading=i.isLoading;n._pendingPubs.forEach(function(n){n()});n._pendingPubs=null;n._hasChangesAction&&n._hasChangesAction();t=null;u=null;i.error&&e.reject(i.error)},function(){var e=r.jsonResultsAdapter.extractResults(i),o;return e=w(e),f=u.visitAndMerge(e,{nodeType:"root"}),c&&f.forEach(function(n){n.entityAspect&&n.entityAspect.validateEntity()}),u.processDeferred(),hr(f,t),o=fi(u.refMap),{results:f,query:t,entityManager:n,httpResponse:i.httpResponse,inlineCount:i.inlineCount,retrievedEntities:o}});return e.resolve(o)},function(i){return i&&(i.query=t,i.entityManager=n),e.reject(i)})}catch(o){return o&&(o.query=t),e.reject(o)}}function hr(n,t){if(!t.noTrackingEnabled){var i=t.expandClause;null!=i&&i.propertyPaths.forEach(function(t){var i=t.split(".");ci(n,i)})}}function ci(n,t){var i=t[0];n.forEach(function(n){var u=n.entityAspect,r;u&&(u._markAsLoaded(i),1!==t.length)&&(r=n.getProperty(i),r&&(r.arrayChanged||(r=[r]),ci(r,t.slice(1))))})}function cr(n){var t=n.filter(function(n){return n.entityAspect.isBeingSaved=!0,n.entityAspect.entityState.isModified()&&n.entityType.concurrencyProperties.length>0});0!==t.length&&t.forEach(function(n){n.entityType.concurrencyProperties.forEach(function(t){lr(n,t)})})}function lr(n,t){var i,u;if(!n.entityAspect.originalValues[t.name])if(i=n.getProperty(t.name),i||(i=t.dataType.defaultValue),t.dataType.isNumeric)n.setProperty(t.name,i+1);else{if(!t.dataType.getConcurrencyValue){if(t.dataType===r.Binary)return;throw new Error("Unable to update the value of concurrency property before saving: "+t.name);}u=t.dataType.getConcurrencyValue(i);n.setProperty(t.name,u)}}function ot(n,t){var i=n._entityGroupMap[t.name];return i||(i=new lu(n,t),n._entityGroupMap[t.name]=i),i}function pr(n,t){var i=t.getSelfAndSubtypes();return i.map(function(t){return ot(n,t)})}function st(n,t){var i={},u=n.entityType||n.complexType,f=lt(u),r={};return u.dataProperties.forEach(function(u){if(u.isComplexProperty)i[u.nameOnServer]=si(n.getProperty(u.name),function(n){return st(n,t)});else{var e=n.getProperty(u.name);if(e=t?t(u,e):e,void 0===e)return;e=f?f(u,e):e;void 0!==e&&(u.isUnmapped?r[u.nameOnServer]=bt(e):i[u.nameOnServer]=e)}}),ut(r)||(i.__unmapped=r),i}function ct(n,t,i){var f=n.entityType||n.complexType,e=n.entityAspect||n.complexAspect,u=t.namingConvention.clientPropertyNameToServer,r={};return rt(e.originalValues,function(n,t){var e=f.getProperty(n);t=i?i(e,t):t;void 0!==t&&(r[u(n,e)]=t)}),f.complexProperties.forEach(function(f){var o=n.getProperty(f.name),e,s;f.isScalar?(e=ct(o,t,i),ut(e)||(r[u(f.name,f)]=e)):(s=o.map(function(n){return ct(n,t,i)}),r[u(f.name,f)]=s)}),r}function br(n,t,i){var r=n.entityType,f=lt(r),e=t.namingConvention.clientPropertyNameToServer,u={};return rt(n.entityAspect.originalValues,function(t){var s=r.getProperty(t),o=n.getProperty(t);o=i?i(s,o):o;void 0!==o&&(o=f?f(s,o):o,void 0!==o&&(u[e(t,s)]=o))}),r.complexProperties.forEach(function(t){if(li(n,t)){var r=n.getProperty(t.name);u[e(t.name,t)]=si(r,function(n){return st(n,i)})}}),u}function li(n,t){var i=n.getProperty(t.name);return t.isScalar?ai(i):!!i._origValues||i.some(function(n){return ai(n)})}function ai(n){return!ut(n.complexAspect.originalValues)||n.complexType.complexProperties.some(function(t){return li(n,t)})}function lt(n){return n.serializerFn||n.metadataStore&&n.metadataStore.serializerFn}function u(){this.map={}}var g=function(n){if(arguments.length>1)throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");0===arguments.length?n={serviceName:""}:"string"==typeof n&&(n={serviceName:n});yt(this,n,!0);this.entityChanged=new k("entityChanged",this);this.validationErrorsChanged=new k("validationErrorsChanged",this);this.hasChangesChanged=new k("hasChangesChanged",this);this.clear()},n=g.prototype;return n._$typeName="EntityManager",k.bubbleEvent(n,null),n.setProperties=function(n){yt(this,n,!1)},n.createEntity=function(n,i,r,u){t(n,"entityType").isString().or().isInstanceOf(a).check();t(r,"entityState").isEnumOf(f).isOptional().check();t(u,"mergeStrategy").isEnumOf(y).isOptional().check();"string"==typeof n&&(n=this.metadataStore._getEntityType(n));r=r||f.Added;var e;return vt(this,"isLoading",!0,function(){e=n.createEntity(i)}),r!==f.Detached&&(e=this.attachEntity(e,r,u)),e},g.importEntities=function(n,t){var i=new vr;return i.importEntities(n,t),i},n.acceptChanges=function(){this.getChanges().map(function(n){return n.entityAspect._checkOperation("acceptChanges")}).forEach(function(n){n.acceptChanges()})},n.exportEntities=function(n,r){var f,u;return t(n,"entities").isArray().isEntity().or().isNonEmptyArray().isInstanceOf(a).or().isNonEmptyArray().isString().or().isOptional().check(),t(r,"config").isObject().or().isBoolean().or().isOptional().check(),null==r?r={includeMetadata:!0,asString:!0}:"boolean"==typeof r&&(r={includeMetadata:r,asString:!0}),c(r).whereParam("asString").isBoolean().isOptional().withDefault(!0).whereParam("includeMetadata").isBoolean().isOptional().withDefault(!0).applyAll(r),f=bi(this,n),u=o({},f,["tempKeys","entityGroupMap"]),r.includeMetadata?(u=o(u,this,["dataService","saveOptions","queryOptions","validationOptions"]),u.metadataStore=this.metadataStore.exportMetadata()):(u.metadataVersion=i.metadataVersion,u.metadataStoreName=this.metadataStore.name),r.asString?JSON.stringify(u,null,v.stringifyPad):u},n.importEntities=function(n,t){var r,i,u,f;return t=t||{},c(t).whereParam("mergeStrategy").isEnumOf(y).isOptional().withDefault(this.queryOptions.mergeStrategy).whereParam("metadataVersionFn").isFunction().isOptional().applyAll(t),r=this,i="string"==typeof n?JSON.parse(n):n,i.metadataStore?(this.metadataStore.importMetadata(i.metadataStore),this.dataService=i.dataService&&l.fromJSON(i.dataService)||new l({serviceName:i.serviceName}),this.saveOptions=new wt(i.saveOptions),this.queryOptions=tt.fromJSON(i.queryOptions),this.validationOptions=new ti(i.validationOptions)):t.metadataVersionFn&&t.metadataVersionFn({metadataVersion:i.metadataVersion,metadataStoreName:i.metadataStoreName}),u={},i.tempKeys.forEach(function(n){var t=h.fromJSON(n,r.metadataStore);u[t.toString()]=new h(t.entityType,r.keyGenerator.generateTempKeyValue(t.entityType,t.values[0]))}),f=[],t.tempKeyMap=u,gr(function(){r._pendingPubs=[]},function(){r._pendingPubs.forEach(function(n){n()});r._pendingPubs=null;r._hasChangesAction&&r._hasChangesAction()},function(){rt(i.entityGroupMap,function(n,i){var u=r.metadataStore._getEntityType(n,!0),e=ot(r,u),o=ir(e,i,t);Array.prototype.push.apply(f,o)});f.forEach(function(n){n.entityAspect.entityState.isDeleted()||r._linkRelatedEntities(n)})}),{entities:f,tempKeyMapping:u}},n.clear=function(){fi(this._entityGroupMap,function(n,t){return t._checkOperation()}).forEach(function(n){n._clear()});this._entityGroupMap={};this._unattachedChildrenMap=new u;this.keyGenerator=new this.keyGeneratorCtor;this.entityChanged.publish({entityAction:nt.Clear});this._setHasChanges(!1)},n.createEmptyCopy=function(){return new g(o({},this,["dataService","metadataStore","queryOptions","saveOptions","validationOptions","keyGeneratorCtor"]))},n.addEntity=function(n){return this.attachEntity(n,f.Added)},n.attachEntity=function(n,i,r){var u,s,e,o;if(t(n,"entity").isRequired().check(),this.metadataStore._checkEntityType(n),i=t(i,"entityState").isEnumOf(f).isOptional().check(f.Unchanged),r=t(r,"mergeStrategy").isEnumOf(y).isOptional().check(y.Disallowed),n.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot attach this entity because the EntityType ("+n.entityType.name+") and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");if(u=n.entityAspect,u){if(u._inProcessEntity)return u._inProcessEntity}else u=new ii(n);if(s=u.entityManager,s){if(s===this)return n;throw new Error("This entity already belongs to another EntityManager");}return o=this,vt(this,"isLoading",!0,function(){i.isAdded()&&fr(o,n);e=o._attachEntityCore(n,i,r);u._inProcessEntity=e;try{or(o,n,i,r)}finally{u._inProcessEntity=null}}),this.validationOptions.validateOnAttach&&e.entityAspect.validateEntity(),i.isUnchanged()||this._notifyStateChange(e,!0),this.entityChanged.publish({entityAction:nt.Attach,entity:e}),e},n.detachEntity=function(n){t(n,"entity").isEntity().check();var i=n.entityAspect;if(!i)return!1;if(i.entityManager!==this)throw new Error("This entity does not belong to this EntityManager.");return i.setDetached()},n.fetchMetadata=function(n,i,r){"function"==typeof n?(r=i,i=n,n=null):(t(n,"dataService").isInstanceOf(l).isOptional().check(),t(i,"callback").isFunction().isOptional().check(),t(r,"errorCallback").isFunction().isOptional().check());var u=this.metadataStore.fetchMetadata(n||this.dataService);return oi(u,i,r)},n.executeQuery=function(n,i,r){var f,e,u,o;return t(n,"query").isInstanceOf(it).or().isString().check(),t(i,"callback").isFunction().isOptional().check(),t(r,"errorCallback").isFunction().isOptional().check(),e=tt.resolve([n.queryOptions,this.queryOptions,tt.defaultInstance]),u=l.resolve([n.dataService,this.dataService]),!u.hasServerMetadata||this.metadataStore.hasMetadataFor(u.serviceName)?f=hi(this,n,e,u):(o=this,f=this.fetchMetadata(u).then(function(){return hi(o,n,e,u)})),oi(f,i,r)},n.executeQueryLocally=function(n){return pt(this,n).results},n.saveChanges=function(n,i,r,u){function w(n){var t=s.entityManager;return ft(f,!1),n.entities=s.processSavedEntities(n),t._setHasChanges(null),r&&r(n),e.resolve(n)}function b(n){var i=n.entities,r=n.deletedKeys||[],u,t;return 0===i.length&&0==r.length?[]:(u=n.keyMappings,t=s.entityManager,ur(t,u),vt(t,"isLoading",!0,function(){var n=new yr({query:null,entityManager:t,mergeOptions:{mergeStrategy:y.OverwriteChanges},dataService:v});i=n.visitAndMerge(i,{nodeType:"root"})}),r.forEach(function(n){var r=t.metadataStore._getEntityType(n.entityTypeName),u=new h(r,n.keyValues),i=t.findEntityByKey(u);i&&i.entityAspect.setDetached()}),i)}function k(n){return ft(f,!1),pi(s,n),u&&u(n),e.reject(n)}var f,a,p,o,c;if(t(n,"entities").isOptional().isArray().isEntity().check(),t(i,"saveOptions").isInstanceOf(wt).isOptional().check(),t(r,"callback").isFunction().isOptional().check(),t(u,"errorCallback").isFunction().isOptional().check(),i=i||this.saveOptions||wt.defaultInstance,f=rr(this,n),0===f.length)return a={entities:[],keyMappings:[]},r&&r(a),e.resolve(a);if(!i.allowConcurrentSaves&&(p=f.some(function(n){return n.entityAspect.isBeingSaved}),p))return o=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false"),u&&u(o),e.reject(o);if(vi(f),c=this.saveChangesValidateOnClient(f),c)return u&&u(c),e.reject(c);var v=l.resolve([i.dataService,this.dataService]),s={entityManager:this,dataService:v,processSavedEntities:b,resourceName:i.resourceName||this.saveOptions.resourceName||"SaveChanges"},d={entities:f,saveOptions:i};try{return cr(f),v.adapterInstance.saveChanges(s,d).then(w).then(null,k)}catch(o){return ft(f,!1),u&&u(o),e.reject(o)}},n.saveChangesValidateOnClient=function(n){var t,i;return this.validationOptions.validateOnSave&&(t=n.filter(function(n){var t=n.entityAspect,i=t.entityState.isDeleted()||t.validateEntity();return!i}),t.length>0)?(i=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail"),i.entityErrors=yi(t),i):null},n._findEntityGroup=function(n){return this._entityGroupMap[n.name]},n.getEntityByKey=function(){var n=gt(this,arguments).entityKey,i=n._subtypes||[n.entityType],t=null;return i.some(function(i){var r=this._findEntityGroup(i);return t=r&&r.findEntityByKey(n)},this),t},n.fetchEntityByKey=function(){var n=l.resolve([this.dataService]),t,i;return!n.hasServerMetadata||this.metadataStore.hasMetadataFor(n.serviceName)?kt(this,arguments):(t=this,i=arguments,this.fetchMetadata(n).then(function(){return kt(t,i)}))},n.findEntityByKey=function(n){return this.getEntityByKey(n)},n.generateTempKeyValue=function(n){t(n,"entity").isEntity().check();var i=n.entityType,r=this.keyGenerator.generateTempKeyValue(i),u=i.keyProperties[0];return n.setProperty(u.name,r),n.entityAspect.hasTempKey=!0,r},n.hasChanges=function(n){return!!this._hasChanges&&(void 0===n?this._hasChanges:this._hasChangesCore(n))},n._hasChangesCore=function(n){n=s(this,n);var t=et(this,n);return t.some(function(n){return n&&n.hasChanges()})},n.getChanges=function(n){return n=s(this,n),dt(this,n)},n.rejectChanges=function(){if(!this._hasChanges)return[];var n=dt(this,null),t=n.map(function(n){return n.entityAspect._checkOperation("rejectChanges")});return this._hasChanges=!1,t.forEach(function(n){n.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),n},n.getEntities=function(n,i){return n=s(this,n),t(i,"entityStates").isOptional().isEnumOf(f).or().isNonEmptyArray().isEnumOf(f).check(),i=i&&er(this,i),wi(this,n,i)},n._notifyStateChange=function(n,t){var i={entityAction:nt.EntityStateChange,entity:n};if(t)this._hasChanges||this._setHasChanges(!0);else if(this._hasChanges){if(this.isLoading)return void(this._hasChangesAction=this._hasChangesAction||function(){this._setHasChanges(null);this.entityChanged.publish(i)}.bind(this));this._setHasChanges(null)}this.entityChanged.publish(i)},n._setHasChanges=function(n){null==n&&(n=this._hasChangesCore());var t=this._hasChanges;this._hasChanges=n;n!=t&&this.hasChangesChanged.publish({entityManager:this,hasChanges:n});this._hasChangesAction=null},n._linkRelatedEntities=function(n){var t=this,i=n.entityAspect;vt(t,"isLoading",!0,function(){for(var o,e,r=t._unattachedChildrenMap,s=i.getKey(),u=s.entityType;u;)o=s.toString(u),e=r.getTuplesByString(o),e&&e.length&&e.slice(0).forEach(function(t){var i,u,s=t.children.filter(function(n){return n.entityAspect.entityState!==f.Detached}),e=t.navigationProperty,c,h;e.getInverse()?(i=e,u=e.getInverse(),u.isScalar)?(c=s[0],n.setProperty(u.name,c),c.setProperty(i.name,n)):(h=n.getProperty(u.name),s.forEach(function(t){h.push(t);t.setProperty(i.name,n)})):e.isScalar?(i=e,s.forEach(function(t){t.setProperty(i.name,n)})):(u=e,h=n.getProperty(u.name),s.forEach(function(n){h._push(n)}));r.removeChildrenByString(o,i)}),u=u.baseEntityType;n.entityType.navigationProperties.forEach(function(u){var o,f,e;if((!u.isScalar||(o=n.getProperty(u.name),!o))&&(f=i.getParentKey(u),f)){if(f._isEmpty())return;e=t.findEntityByKey(f);e?n.setProperty(u.name,e):r.addChild(f,u,n)}});n.entityType.foreignKeyProperties.forEach(function(i){var u=i.inverseNavigationProperty;if(u){var o=n.getProperty(i.name),e=new h(u.parentType,[o]),f=t.findEntityByKey(e);f?u.isScalar?f.setProperty(u.name,n):t.isLoading?f.getProperty(u.name)._push(n):f.getProperty(u.name).push(n):r.addChild(e,u,n)}})})},n._attachEntityCore=function(n,t,i){var u=ot(this,n.entityType),r=u.attachEntity(n,t,i);return this._linkRelatedEntities(r),r},n._updateFkVal=function(n,t,i){var r=this._entityGroupMap[n.parentType.name];r&&r._updateFkVal(n,t,i)},n.helper={unwrapInstance:st,unwrapOriginalValues:ct,unwrapChangedValues:br},u.prototype.addChild=function(n,t,i){var r=this.getTuple(n,t);r||(r={navigationProperty:t,children:[]},nr(this.map,n.toString()).push(r));r.children.push(i)},u.prototype.removeChildrenByString=function(n,t){var i=this.map[n];i&&(sr(i,function(n){return n.navigationProperty===t}),i.length||delete this.map[n])},u.prototype.getTuple=function(n,t){var i=this.getTuples(n);return i?d(i,function(n){return n.navigationProperty===t}):null},u.prototype.getTuples=function(n){for(var r,i=this.map[n.toString()],t=n.entityType;!i&&t.baseEntityType;)t=t.baseEntityType,r=n.toString(t),i=this.map[r];return i},u.prototype.getTuplesByString=function(n){return this.map[n]},g}(),i.EntityManager=vr,yr=function(){function t(n,t,r,u){var e,f;return r.ignore||null==t?null:r.nodeRefId?(e=d(n,r.nodeRefId),"function"==typeof e&&null!=u?void n.deferredFns.push(function(){u(e)}):e):r.entityType?(f=r.entityType,n.mergeOptions.noTracking?(t=i(n,f,t),f.noTrackingFn&&(t=f.noTrackingFn(t,f)),r.nodeId&&(n.refMap[r.nodeId]=t),t):f.isComplexType?i(n,f,t):g(n,t,r)):(r.passThru||"object"!=typeof t||lt(t)||(t=k(n,t)),r.nodeId&&(n.refMap[r.nodeId]=t),t)}function i(n,t,r){var u={};return t.dataProperties.forEach(function(t){u[t.name]=t.isComplexProperty?si(r[t.nameOnServer],function(r){return i(n,t.dataType,r)}):ft(r[t.nameOnServer],t.dataType)}),t.navigationProperties&&t.navigationProperties.forEach(function(t){var i={nodeType:"navProp",navigationProperty:t};e(r[t.nameOnServer],n,i,u,t.name)}),u}function k(n,t){var r=n.metadataStore.namingConvention.serverPropertyNameToClient,i={};return rt(t,function(t,u){var f=r(t),o={nodeType:"anonProp",propertyName:f};e(u,n,o,i,f)}),i}function e(n,i,r,u,f){var o=i.jsonResultsAdapter,e=o.visitNode(n,i,r)||{};if(n=e.node||n,!e.ignore)return e.passThru?n:void(Array.isArray(n)?(r.nodeType=r.nodeType+"Item",u[f]=n.map(function(n,s){return e=o.visitNode(n,i,r)||{},n=e.node||n,t(i,n,e,function(n){u[f][s]=n()})})):u[f]=t(i,n,e,function(n){u[f]=n()}))}function d(n,t){var i=n.refMap[t];return void 0===i?function(){return n.refMap[t]}:i}function s(n,t,i){var r=i._$meta.nodeId;!r&&i._$meta.extraMetadata&&(r=i._$meta.extraMetadata.uriKey);null!=r&&(n.refMap[r]=t)}function g(n,t,i){var e,o,l,p;t._$meta=i;e=n.entityManager;o=i.entityType;"string"==typeof o&&(o=n.metadataStore._getEntityType(o,!1));t.entityType=o;var s=n.mergeOptions.mergeStrategy,a=null==n.query,v=o.getEntityKeyFromRawEntity(t,n.rawValueFn),r=e.findEntityByKey(v);if(r){if(a&&r.entityAspect.entityState.isDeleted())return e.detachEntity(r),r;if(l=r.entityAspect.entityState,s===y.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+v.toString()+" from being merged");if(s===y.SkipMerge)h(n,r,t);else if(s===y.OverwriteChanges||l.isUnchanged())c(n,r,t),r.entityAspect.wasLoaded=!0,i.extraMetadata&&(r.entityAspect.extraMetadata=i.extraMetadata),r.entityAspect.entityState=f.Unchanged,u(r),r.entityAspect.propertyChanged.publish({entity:r,propertyName:null}),p=a?nt.MergeOnSave:nt.MergeOnQuery,e.entityChanged.publish({entityAction:p,entity:r}),l.isUnchanged()||e._notifyStateChange(r,!1);else{if(l==f.Deleted&&!n.mergeOptions.includeDeleted)return null;h(n,r,t)}}else r=o._createInstanceCore(),c(n,r,t),i.extraMetadata&&(r.entityAspect.extraMetadata=i.extraMetadata),e._attachEntityCore(r,f.Unchanged,s),r.entityAspect.wasLoaded=!0,e.entityChanged.publish({entityAction:nt.AttachOnQuery,entity:r});return r}function u(n){var i=n.entityAspect||n.complexAspect,t;i.originalValues={};t=n.entityType||n.complexType;t.complexProperties.forEach(function(t){var i=n.getProperty(t.name);t.isScalar?u(i):(i._acceptChanges(),i.forEach(u))})}function h(n,t,i){s(n,t,i);i.entityType.navigationProperties.forEach(function(t){t.isScalar?l(n,i,t):a(n,i,t)})}function c(n,t,i){s(n,t,i);var r=t.entityType;r._updateTargetFromRaw(t,i,n.rawValueFn);r.navigationProperties.forEach(function(r){r.isScalar?tt(n,r,t,i):ut(n,r,t,i)})}function tt(n,t,i,r){var u=l(n,r,t);null!=u&&("function"==typeof u?n.deferredFns.push(function(){u=u();v(u,i,t)}):v(u,i,t))}function ut(n,t,i,r){var e=a(n,r,t),u,f;null!=e&&(u=t.getInverse(),u&&(f=i.getProperty(t.name),f.wasLoaded=!0,e.forEach(function(t){"function"==typeof t?n.deferredFns.push(function(){t=t();w(n,t,f,i,u)}):w(n,t,f,i,u)})))}function l(n,t,i){var r=t[i.nameOnServer];return r?n.visitAndMerge(r,{nodeType:"navProp",navigationProperty:i}):null}function a(n,t,i){var r=t[i.nameOnServer];return r?!Array.isArray(r)&&(r=r.results,!r)?null:n.visitAndMerge(r,{nodeType:"navPropItem",navigationProperty:i}):null}function v(n,t,i){var u,f,r,e;if(n&&(u=i.name,f=t.getProperty(u),f!==n)){if(t.setProperty(u,n),r=i.getInverse(),!r)return;r.isScalar?n.setProperty(r.name,t):(e=n.getProperty(r.name),e.push(t))}}function w(n,t,i,r,u){var e,o,s;if(t){if(t.entityAspect.entityState===f.Modified&&n.mergeOptions.mergeStrategy===y.PreserveChanges&&(e=t.entityAspect.originalValues,o=u.relatedDataProperties.some(function(n){return void 0!=e[n.name]}),o))return;s=t.getProperty(u.name);s!==r&&(i.push(t),t.setProperty(u.name,r))}}var b=function(n){o(this,n,["query","entityManager","dataService","mergeOptions"]);this.refMap={};this.deferredFns=[];this.jsonResultsAdapter=this.dataService.jsonResultsAdapter;this.metadataStore=this.entityManager.metadataStore;this.rawValueFn=p.getRawValueFromServer},n=b.prototype,ft=r.parseRawValue;return n._$typeName="MappingContext",n.getUrl=function(){var n=this.query,t;if(!n)throw new Error("query cannot be empty");if("string"==typeof n)t=n;else{if(!(n instanceof it))throw new Error("unable to recognize query parameter as either a string or an EntityQuery");t=this.dataService.uriBuilder.buildUri(n,this.metadataStore)}return this.dataService.qualifyUrl(t)},n.visitAndMerge=function(n,i){var u=this.query,f=this.jsonResultsAdapter,r;return i=i||{},r=this,si(n,function(n){if(null==u&&n.entityAspect)return n.entityAspect.entityState.isDeleted()?r.entityManager.detachEntity(n):n.entityAspect.acceptChanges(),n;var e=f.visitNode(n,r,i)||{};return n=e.node||n,u&&"root"===i.nodeType&&!e.entityType&&(e.entityType=u._getToEntityType&&u._getToEntityType(r.metadataStore)),t(r,n,e)},this.mergeOptions.includeDeleted)},n.processDeferred=function(){this.deferredFns.length>0&&this.deferredFns.forEach(function(n){n()})},b}(),wt=function(){function i(n,t){return t&&c(t).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(l).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(n),n}var n=function(n){i(this,n)},t=n.prototype;return t._$typeName="SaveOptions",t.setAsDefault=function(){return oi(this,n)},t.using=function(n){return i(this,n)},n.defaultInstance=new n({allowConcurrentSaves:!1}),n}(),i.SaveOptions=wt,i.AbstractDataServiceAdapter=function(){function u(){this.getRequest=function(n){return n};this.done=function(){}}function t(t,i,r){var u=o(i);return n._catchNoConnectionError(u),r&&(u.message=r+"; "+u.message),t.reject(u)}function o(n){var i=new Error,t,u,o;if(i.httpResponse=n,i.status=n.status,t=n.data,!t)return i.message=n.error&&n.error.toString(),i;if("string"==typeof t)try{t=JSON.parse(t)}catch(h){return i.message=t,i}var f,r,e=n.saveContext,u=t.Message||t.ExceptionMessage||t.EntityErrors||t.Errors,s=!!u;if(s){u=t;do f=u.ExceptionMessage||u.Message,u=u.InnerException;while(u);r=t.Errors||t.EntityErrors;r=r&&r.map(function(n){return{errorName:n.ErrorName,entityTypeName:ri.normalizeTypeName(n.EntityTypeName),keyValues:n.KeyValues,propertyName:n.PropertyName,errorMessage:n.ErrorMessage}})}else f=t.message,r=t.errors||t.entityErrors;return e&&r&&(o=e.entityManager.metadataStore.namingConvention.serverPropertyNameToClient,r.forEach(function(n){n.propertyName=n.propertyName&&o(n.propertyName)}),i.entityErrors=r),i.message=f||"Server side errors encountered - see the entityErrors collection on this object for more detail",i}var r,f=function(){},n=f.prototype;return n.checkForRecomposition=function(n){"ajax"===n.interfaceName&&n.isDefault&&this.initialize()},n.initialize=function(){if(r=i.config.getAdapterInstance("ajax"),!r||!r.ajax)throw new Error("Unable to find ajax adapter for dataservice adapter '"+(this.name||"")+"'.");},n.fetchMetadata=function(n,i){var o=i.serviceName,f=i.qualifyUrl("Metadata"),u=e.defer();return r.ajax({type:"GET",url:f,dataType:"json",success:function(r){var e,s,h;if(n.hasMetadataFor(o))return u.resolve("already fetched");e=r.data;try{s="string"==typeof e?JSON.parse(e):e;n.importMetadata(s)}catch(c){return h="Unable to either parse or import metadata: "+c.message,t(u,r,"Metadata query failed for: "+f+". "+h)}return n.hasMetadataFor(o)||n.addDataService(i),u.resolve(s)},error:function(n){t(u,n,"Metadata query failed for: "+f)}}),u.promise},n.executeQuery=function(n){var i=(n.adapter=this,e.defer()),f=n.getUrl(),u={type:"GET",url:f,params:n.query.parameters,dataType:"json",success:function(n){var r=n.data,f,u;try{u=r&&(r.results||r.Results);f=u?{results:u,inlineCount:r.inlineCount||r.InlineCount,httpResponse:n}:{results:r,httpResponse:n};i.resolve(f)}catch(e){e instanceof Error?i.reject(e):t(i,n)}},error:function(n){t(i,n)}};return n.dataService.useJsonp&&(u.dataType="jsonp",u.crossDomain=!0),r.ajax(u),i.promise},n.saveChanges=function(n,i){var f=n.adapter=this,u=e.defer(),o,s;return i=f._prepareSaveBundle(n,i),o=JSON.stringify(i),s=n.dataService.qualifyUrl(n.resourceName),r.ajax({type:"POST",url:s,dataType:"json",contentType:"application/json",data:o,success:function(i){var r,e;i.saveContext=n;r=i.data;r.Errors||r.errors?t(u,i):(e=f._prepareSaveResult(n,r),e.httpResponse=i,u.resolve(e))},error:function(i){i.saveContext=n;t(u,i)}}),u.promise},n._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle");},n.changeRequestInterceptor=u,n._createChangeRequestInterceptor=function(n,t){var f=n.adapter,e=f.changeRequestInterceptor,i=li;if(i(e)){var o=f.name+" DataServiceAdapter's ChangeRequestInterceptor",s=" is missing or not a function.",r=new e(n,t);if(!i(r.getRequest))throw new Error(o+".getRequest"+s);if(!i(r.done))throw new Error(o+".done"+s);return r}return new u(n,t)},n._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult");},n.jsonResultsAdapter=new yi({name:"noop",visitNode:function(){return{}}}),n._catchNoConnectionError=function(n){0==n.status&&null==n.message&&(n.message="HTTP response status 0 and no message.  Likely did not or could not reach server. Is the server running?")},f}(),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){function i(n){var o,f,s,r="",u,t,e,h;for(u in n)if(t=n[u],t instanceof Array)for(e=0;e<t.length;++e)o=t[e],s=u+"["+e+"]",f={},f[s]=o,r+=i(f)+"&";else if(t&&t.toISOString)r+=encodeURIComponent(u)+"="+encodeURIComponent(t.toISOString())+"&";else if(t instanceof Object)for(h in t)o=t[h],s=u+"["+h+"]",f={},f[s]=o,r+=i(f)+"&";else null===t?r+=encodeURIComponent(u)+"=&":void 0!==t&&(r+=encodeURIComponent(u)+"="+encodeURIComponent(t)+"&");return r.length?r.substr(0,r.length-1):r}var t=n.core,u=function(){this.name="angular";this.defaultSettings={};this.requestInterceptor=null},r=u.prototype;r.initialize=function(){var n=t.requireLib("angular"),i,r,u;n&&(u=n.injector(["ng"]),u.invoke(["$http","$rootScope",function(n,t){i=n;r=t}]),this.$http=i,this.$rootScope=r)};r.setHttp=function(n){this.$http=n;this.$rootScope=null};r.ajax=function(n){function s(t,i,r,u,f){"null"===t&&(t=null);var e={config:n,data:t,getHeaders:r,ngConfig:u,status:i,statusText:f};n.success(e)}function h(t,i,r,u,f){0===i&&null==t&&(t="timeout");var e={config:n,data:t,getHeaders:r,ngConfig:u,status:i,statusText:f};n.error(e)}var r,f,e,o,u;if(!this.$http)throw new Error("Unable to locate angular for ajax adapter");r={method:n.type,url:n.url,dataType:n.dataType,contentType:n.contentType,crossDomain:n.crossDomain,headers:n.headers||{}};n.params&&(f=r.url.indexOf("?")>=0?"&":"?",r.url=r.url+f+i(n.params));(n.data&&(r.data=n.data),t.isEmpty(this.defaultSettings))||(e=t.extend({},this.defaultSettings),r=t.extend(e,r),o=t.extend({},this.defaultSettings.headers),r.headers=t.extend(o,r.headers));u={adapter:this,config:r,dsaConfig:n,success:s,error:h};t.isFunction(this.requestInterceptor)&&(this.requestInterceptor(u),this.requestInterceptor.oneTime&&(this.requestInterceptor=null));u.config&&(this.$http(u.config).success(u.success).error(u.error),this.$rootScope&&this.$rootScope.$digest())};n.config.registerAdapter("ajax",u)}),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){function r(n){return 0===n.status?function(n){return n&&n.length>0?"":{}}:function(t){return t&&t.length>0?n.getResponseHeader(t):n.getAllResponseHeaders()}}var i,t=n.core,u=function(){this.name="jQuery";this.defaultSettings={};this.requestInterceptor=null},f=u.prototype;f.initialize=function(){i=t.requireLib("jQuery;jquery")};f.ajax=function(n){function s(t,i,u){var f={config:n,data:t,getHeaders:r(u),status:u.status,statusText:i};n.success(f);u.onreadystatechange=null;u.abort=null}function h(t,i,u){var f={config:n,data:t.responseText,error:u,getHeaders:r(t),status:t.status,statusText:i};n.error(f);t.onreadystatechange=null;t.abort=null}var f,e,o,u;if(!i)throw new Error("Unable to locate jQuery");f={type:n.type,url:n.url,data:n.params||n.data,dataType:n.dataType,contentType:n.contentType,crossDomain:n.crossDomain,headers:n.headers||{}};t.isEmpty(this.defaultSettings)||(e=t.extend({},this.defaultSettings),f=t.extend(e,f),o=t.extend({},this.defaultSettings.headers),f.headers=t.extend(o,f.headers));u={adapter:this,config:f,dsaConfig:n,success:s,error:h};t.isFunction(this.requestInterceptor)&&(this.requestInterceptor(u),this.requestInterceptor.oneTime&&(this.requestInterceptor=null));u.config&&(u.jqXHR=i.ajax(u.config).done(u.success).fail(u.error))};n.config.registerAdapter("ajax",u)}),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){function v(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push(encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return i.join("&")}function h(n,t){if(!n.isUnmapped)return n.dataType===g.DateTimeOffset?t=t&&new Date(t.getTime()-6e4*t.getTimezoneOffset()):n.dataType.quoteJsonOData&&(t=null!=t?t.toString():t),t}function y(n,t){var f=n.adapter._createChangeRequestInterceptor(n,t),r=[],e=[],o=[],s=n.entityManager,l=s.helper,i=0,u=n.routePrefix;return t.entities.forEach(function(n,t){var v=n.entityAspect,a;if(i+=1,a={headers:{"Content-ID":i,DataServiceVersion:"2.0"}},o[i]=n,v.entityState.isAdded())a.requestUri=u+n.entityType.defaultResourceName,a.method="POST",a.data=l.unwrapInstance(n,h),e[i]=v.getKey();else if(v.entityState.isModified())c(a,v,u),a.method="MERGE",a.data=l.unwrapChangedValues(n,s.metadataStore,h);else{if(!v.entityState.isDeleted())return;c(a,v,u);a.method="DELETE"}a=f.getRequest(a,n,t);r.push(a)}),n.contentKeys=o,n.tempKeys=e,f.done(r),{__batchRequests:[{__changeRequests:r}]}}function c(n,t,i){var r,u=t.extraMetadata;null==u?(r=p(t),t.extraMetadata={uriKey:r}):(r=u.uriKey,u.etag&&(n.headers["If-Match"]=u.etag));n.requestUri=r.indexOf("//")>0?r:i+r}function p(n){var u=n.entity.entityType,f=u.defaultResourceName,i=u.keyProperties,t=f+"(",r;return 1===i.length?t=t+l(i[0],n)+")":(r="",i.forEach(function(i){t=t+r+i.nameOnServer+"="+l(i,n);r=","}),t+=")"),t}function l(n,t){return n.dataType.fmtOData(t.getPropertyValue(n.name))}function f(n,i){var r=new Error,f=n&&n.response,e,u,o;if(!f)return r.message=n,r.statusText=n,r;if(r.message=f.statusText,r.statusText=f.statusText,r.status=f.statusCode,i&&(r.url=i),r.body=f.body,f.body)try{u=JSON.parse(f.body);r.body=u;u["odata.error"]&&(u=u["odata.error"]);o="";do e=u.error||u.innererror,e||(o+=w(u)),e=e||u.internalexception,u=e||u;while(e);o.length>0&&(r.message=o)}catch(s){}return t._catchNoConnectionError(r),r}function w(n){var t=n.message||"";return("string"==typeof t?t:t.value)+"; "}var i,r=n.core,b=n.MetadataStore,k=n.JsonResultsAdapter,d=n.DataProperty,g=n.DataType,nt=n.AutoGeneratedKeyType,a=function(){this.name="OData"},t=a.prototype,e,s,u;t.initialize=function(){i=r.requireLib("OData","Needed to support remote OData services");i.jsonHandler.recognizeDates=!0};e=n.AbstractDataServiceAdapter.prototype;t._catchNoConnectionError=e._catchNoConnectionError;t.changeRequestInterceptor=e.changeRequestInterceptor;t._createChangeRequestInterceptor=e._createChangeRequestInterceptor;t.headers={DataServiceVersion:"2.0"};t.getAbsoluteUrl=function(n,t){var i=n.qualifyUrl(""),u=r.stringStartsWith(t,i)?"":i;return window&&i.indexOf("//")<0&&(u=window.location.protocol+"//"+window.location.host+(r.stringStartsWith(i,"/")?"":"/")+u),u+t};t.getRoutePrefix=function(n){var i,t;return"object"==typeof document?(i=document.createElement("a"),i.href=n.serviceName):i=url.parse(n.serviceName),t=i.pathname,"/"===t[0]&&(t=t.substr(1)),"/"!==t.substr(-1)&&(t+="/"),t};t.executeQuery=function(t){var u,e=n.Q.defer(),s,h;return(u=this.relativeUrl===!0?t.getUrl():r.isFunction(this.relativeUrl)?this.relativeUrl(t.dataService,t.getUrl()):this.getAbsoluteUrl(t.dataService,t.getUrl()),t.query.parameters)&&(s=v(t.query.parameters),h=u.indexOf("?")<0?"?":"&",u=u+h+s),i.read({requestUri:u,headers:o({},this.headers)},function(n,t){var i,r;return n.__count&&(i=parseInt(n.__count,10)),r=n.results?n.results:n,e.resolve({results:r,inlineCount:i,httpResponse:t})},function(n){return e.reject(f(n,u))}),e.promise};t.fetchMetadata=function(t,u){var e,s=n.Q.defer(),c=u.serviceName,h;return e=this.relativeUrl===!0?u.qualifyUrl("$metadata"):r.isFunction(this.relativeUrl)?this.relativeUrl(u,"$metadata"):this.getAbsoluteUrl(u,"$metadata"),h=o({},this.headers),h.Accept="application/*; odata.metadata=full",i.read({requestUri:e,headers:h},function(n){var r,i;if(!n||!n.dataServices)return r=new Error("Metadata query failed for: "+e),s.reject(r);if(i=n.dataServices,!t.hasMetadataFor(c)){try{t.importMetadata(i)}catch(f){return s.reject(new Error("Metadata query failed for "+e+"; Unable to process returned metadata: "+f.message))}t.addDataService(u)}return s.resolve(i)},function(n){var t=f(n,e);return t.message="Metadata query failed for: "+e+"; "+(t.message||""),s.reject(t)},i.metadataHandler),s.promise};t.saveChanges=function(t,u){var e,s=t.adapter=this,h=n.Q.defer();this.relativeUrl===!0?(t.routePrefix=s.getRoutePrefix(t.dataService),e=t.dataService.qualifyUrl("$batch")):r.isFunction(s.relativeUrl)?(t.routePrefix=s.relativeUrl(t.dataService,""),e=t.routePrefix+"$batch"):(t.routePrefix=s.getAbsoluteUrl(t.dataService,""),e=t.routePrefix+"$batch");var c=y(t,u),l=t.tempKeys,a=t.contentKeys;return i.request({headers:o({},this.headers),requestUri:e,method:"POST",data:c},function(n){var t=[],i=[],r={entities:t,keyMappings:i};return n.__batchResponses.forEach(function(n){n.__changeResponses.forEach(function(n){var y=n.response||n,c=y.statusCode,r,u,o,s,v;if(!c||c>=400)return void h.reject(f(n,e));if(r=n.headers["Content-ID"],r||(r=n.headers["Content-Id"]),u=n.data,u){if(o=l[r],o&&(s=o.entityType,s.autoGeneratedKeyType!==nt.None)){var p=o.values[0],w=s.getEntityKeyFromRawEntity(u,d.getRawValueFromServer),b={entityTypeName:s.name,tempValue:p,realValue:w.values[0]};i.push(b)}t.push(u)}else v=a[r],t.push(v)})}),h.resolve(r)},function(n){return h.reject(f(n,e))},i.batchHandler),h.promise};t.jsonResultsAdapter=new k({name:"OData_default",visitNode:function(n,t,i){var u={},f,s,o,e,c,h;return null==n?u:(f=n.__metadata,null!=f&&(s=b.normalizeTypeName(f.type),o=s&&t.entityManager.metadataStore.getEntityType(s,!0),o&&o._mappedPropertiesCount<=Object.keys(n).length-1&&(u.entityType=o,e=f.uri||f.id,e&&(c=new RegExp("^"+t.dataService.serviceName,"i"),e=e.replace(c,"")),u.extraMetadata={uriKey:e,etag:f.etag})),n.results&&(u.node=n.results),h=i.propertyName,u.ignore=null!=n.__deferred||"__metadata"===h||"EntityKey"===h&&n.$type&&r.stringStartsWith(n.$type,"System.Data"),u)}});n.config.registerAdapter("dataService",a);s=function(){this.name="webApiOData"};n.core.extend(s.prototype,t);n.config.registerAdapter("dataService",s);u=function(){this.name="webApiOData4"};n.core.extend(u.prototype,s.prototype);u.prototype.initialize=function(){var n=r.requireLib("datajs","Needed to support remote OData v4 services");i=n.V4.oData;i.json.jsonHandler.recognizeDates=!0};u.prototype.headers={"OData-Version":"4.0"};n.config.registerAdapter("dataService",u)}),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){var t=n.MetadataStore,u=n.JsonResultsAdapter,f=n.AbstractDataServiceAdapter,r=function(){this.name="webApi"},i=r.prototype=new f;i._prepareSaveBundle=function(t,i){var r=this._createChangeRequestInterceptor(t,i),u=t.entityManager,e=u.metadataStore,f=u.helper;return i.entities=i.entities.map(function(t,i){var u=f.unwrapInstance(t),o=null,s;return t.entityType.autoGeneratedKeyType!==n.AutoGeneratedKeyType.None&&(o={propertyName:t.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:t.entityType.autoGeneratedKeyType.name}),s=f.unwrapOriginalValues(t,e),u.entityAspect={entityTypeName:t.entityType.name,defaultResourceName:t.entityType.defaultResourceName,entityState:t.entityAspect.entityState.name,originalValuesMap:s,autoGeneratedKey:o},u=r.getRequest(u,t,i)}),i.saveOptions={tag:i.saveOptions.tag},r.done(i.entities),i};i._prepareSaveResult=function(n,i){var r=n.dataService.jsonResultsAdapter||this.jsonResultsAdapter,e=r.extractSaveResults(i)||[],u=r.extractKeyMappings(i)||[],f=r.extractDeletedKeys?r.extractDeletedKeys(i)||[]:[];return u.length&&(u=u.map(function(n){if(n.entityTypeName)return n;var i=t.normalizeTypeName(n.EntityTypeName);return{entityTypeName:i,tempValue:n.TempValue,realValue:n.RealValue}})),f.length&&(f=f.map(function(n){if(n.entityTypeName)return n;var i=t.normalizeTypeName(n.EntityTypeName);return{entityTypeName:i,keyValues:n.KeyValue}})),{entities:e,keyMappings:u,deletedKeys:f}};i.jsonResultsAdapter=new u({name:"webApi_default",visitNode:function(n,i,r){if(null==n)return{};var u=t.normalizeTypeName(n.$type),e=u&&i.entityManager.metadataStore._getEntityType(u,!0),f=r.propertyName,o=f&&"$"===f.substr(0,1);return{entityType:e,nodeId:n.$id,nodeRefId:n.$ref,ignore:o}}});n.config.registerAdapter("dataService",r)}),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){function h(n){var i=n.entityType||n.complexType,u=i._extra,t=u.alreadyWrappedProps||{};i.getProperties().forEach(function(i){var u=i.name,e;t[u]||(e=u in n?f(n,i):r(n,i),null!=e&&Object.defineProperty(n,u,e),t[u]=!0)});u.alreadyWrappedProps=t}function c(n){var u=e(n),t=Object.getPrototypeOf(n),f=t.entityType||t.complexType;return f.getProperties().forEach(function(u){var f=u.name,e,o;u.isUnmapped&&!i.getPropertyDescriptor(t,f)&&(e=r(t,u),Object.defineProperty(t,f,e));n.hasOwnProperty(f)&&(o=n[f],delete n[f],n[f]=o)}),u}function r(n,t){var i=t.name,r=n._pendingBackingStores,f;return r||(r=[],n._pendingBackingStores=r),f={get:function(){var n=this._backingStore||e(this);return n[i]},set:function(n){var r=this._backingStore||o(this),f=u(r,i);this._$interceptor(t,n,f)},enumerable:!0,configurable:!0},f.set.rawSet=function(n){var t=this._backingStore||o(this),r=u(t,i);r(n)},f}function u(n,t){return function(){return 0===arguments.length?n[t]:void(n[t]=arguments[0])}}function f(n,t){var u,i,e,r;return n.hasOwnProperty(t.name)?(i=Object.getOwnPropertyDescriptor(n,t.name),i.configurable&&!i.value&&i.set?(e=function(n){return function(){if(0===arguments.length)return i.get.bind(n)();var t=i.set,r=t.rawSet||t;return void r.bind(n)(arguments[0])}},r={get:function(){return i.get.bind(this)()},set:function(n){this._$interceptor(t,n,e(this))},enumerable:i.enumerable,configurable:!0},r.set.rawSet=i.set,r):void 0):(u=Object.getPrototypeOf(n),f(u,t))}function e(n){var i=Object.getPrototypeOf(n),t;return l(i),t=n._backingStore,t||(t={},n._backingStore=t),t}function o(n){var f=Object.getPrototypeOf(n),r=f._pendingBackingStores,u=i.arrayFirst(r,function(t){return t.entity===n}),t;return u?u.backingStore:(t={},r.push({entity:n,backingStore:t}),t)}function l(n){var t=n._pendingBackingStores;t&&(t.forEach(function(n){n.entity._backingStore=n.backingStore}),t.length=0)}var i=n.core,s=function(){this.name="backingStore"},t=s.prototype;t.initialize=function(){};t.getTrackablePropertyNames=function(n){var r=[],t,u;for(t in n)"entityType"!==t&&"_$typeName"!==t&&"_pendingSets"!==t&&"_backingStore"!==t&&(u=n[t],i.isFunction(u)||r.push(t));return r};t.initializeEntityPrototype=function(n){n.getProperty=function(n){return this[n]};n.setProperty=function(n,t){return this[n]=t,this};h(n)};t.startTracking=function(t){var i=c(t),r=t.entityType||t.complexType;r.getProperties().forEach(function(r){var f=r.name,u=t[f];if(r.isDataProperty)r.isComplexProperty?u=r.isScalar?r.dataType._createInstanceCore(t,r):n.makeComplexArray([],t,r):r.isScalar?void 0===u&&(u=r.defaultValue):u=n.makePrimitiveArray([],t,r);else{if(!r.isNavigationProperty)throw new Error("unknown property: "+f);if(void 0!==u)throw new Error("Cannot assign a navigation property in an entity ctor.: "+f);u=r.isScalar?null:n.makeRelationArray([],t,r)}(r.isSettable||r.isNavigationProperty)&&(i[f]=u)})};n.config.registerAdapter("modelLibrary",s)}),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){function o(n){var r=n.entityType||n.complexType,f={},e;(r.getProperties().forEach(function(t){var i=u(n,t.name);i&&(f[t.name]=i)}),i.isEmpty(f))||(e=r._extra,e.es5Descriptors=f,r._koDummy=t.observable(null))}function u(n,t){if(!f)return null;if(n.hasOwnProperty(t))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(n,t);var i=Object.getPrototypeOf(n);return i?u(i,t):null}function s(t,i,r){if(i.isDataProperty)i.isComplexProperty?r=i.isScalar?i.dataType._createInstanceCore(t,i):n.makeComplexArray([],t,i):i.isScalar?void 0===r&&(r=i.defaultValue):r=n.makePrimitiveArray([],t,i);else{if(!i.isNavigationProperty)throw new Error("unknown property: "+i.name);if(void 0!==r)throw new Error("Cannot assign a navigation property in an entity ctor.: "+i.name);r=i.isScalar?null:n.makeRelationArray([],t,i)}return r}function h(n){n._koObj._suppressBreeze=!0}function c(n){var t=n.array._koObj;t._suppressBreeze?t._suppressBreeze=!1:t.valueHasMutated()}var t,i=n.core,f=i.__isES5Supported,e=function(){this.name="ko"},r=e.prototype;r.initialize=function(){t=i.requireLib("ko;knockout","The Knockout library");t.extenders.intercept=function(n,i){var r=i.instance,u=i.property;return n.splice?t.computed({read:n}):t.computed({read:n,write:function(t){return r._$interceptor(u,t,n),r}})}};r.getTrackablePropertyNames=function(n){var f=[],r,e,o;for(r in n)"entityType"!==r&&"_$typeName"!==r&&(e=u(n,r),e&&e.get?f.push(r):(o=n[r],t.isObservable(o)?f.push(r):i.isFunction(o)||f.push(r)));return f};r.initializeEntityPrototype=function(n){n.getProperty=function(n){return this[n]()};n.setProperty=function(n,t){return this[n](t),this};f&&o(n)};r.startTracking=function(n){var i=n.entityType||n.complexType,r=i._extra.es5Descriptors||{};i.getProperties().sort(function(n,t){var i=n.isUnmapped?1:0,r=t.isUnmapped?1:0;return i-r}).forEach(function(u){var f,o=u.name,e=n[o],l=r[o],a,v,y,p;if(l)a=l.get.bind(n),l.set?(v=l.set.bind(n),y=function(n){return 0===arguments.length?void a():void v(n)},f=t.computed({read:function(){return i._koDummy(),a()},write:function(t){return n._$interceptor(u,t,y),i._koDummy.valueHasMutated(),n}})):f=t.computed({read:a,write:function(){}});else if(t.isObservable(e)){if(u.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+o);f=e}else e=s(n,u,e),f=u.isScalar?t.observable(e):t.observableArray(e);u.isScalar?l?Object.defineProperty(n,o,{enumerable:!0,configurable:!0,writable:!0,value:f}):(p=f.extend({intercept:{instance:n,property:u}}),n[o]=p):(e._koObj=f,f.subscribe(h,null,"beforeChange"),e.arrayChanged.subscribe(c),f.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.");},n[o]=f)})};n.config.registerAdapter("modelLibrary",e)}),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){var r=n.EntityType,t=function(){this.name="json"},i=t.prototype;i.initialize=function(){};i.buildUri=function(n,t){var u=n._getFromEntityType(t,!1),i,f,e;return u||(u=new r(t)),i=n.toJSONExt({entityType:u,toNameOnServer:!0}),i.from=void 0,i.queryOptions=void 0,f=JSON.stringify(i),e=encodeURIComponent(f),n.resourceName+"?"+e};n.config.registerAdapter("uriBuilder",t)}),function(n){"object"==typeof i?n(i):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?n(require("breeze-client")):"function"==typeof define&&define.amd&&define(["breeze-client"],n)}(function(n){var t,u=n.EntityType,i=function(){this.name="odata"},r=i.prototype;r.initialize=function(){};r.buildUri=function(n,i){function o(n){if(n)return n.visit({entityType:f},t)}function s(n){if(n){n.validate(f);var t=n.items.map(function(n){return f.clientPropertyPathToServer(n.propertyPath,"/")+(n.isDesc?" desc":"")});return t.join(",")}}function h(n){if(n){n.validate(f);return n.propertyPaths.map(function(n){return f.clientPropertyPathToServer(n,"/")}).join(",")}}function c(n){if(n)return n.propertyPaths.map(function(n){return f.clientPropertyPathToServer(n,"/")}).join(",")}function l(n){var i=[],r,t;for(r in n)t=n[r],void 0!==t&&(t instanceof Array?t.forEach(function(n){i.push(r+"="+encodeURIComponent(n))}):i.push(r+"="+encodeURIComponent(t)));return i.length>0?"?"+i.join("&"):""}var f=n._getFromEntityType(i,!1),r,e;return f||(f=new u(i)),r={},r.$filter=o(n.wherePredicate),r.$orderby=s(n.orderByClause),n.skipCount&&(r.$skip=n.skipCount),null!=n.takeCount&&(r.$top=n.takeCount),r.$expand=c(n.expandClause),r.$select=h(n.selectClause),n.inlineCountEnabled&&(r.$inlinecount="allpages"),e=l(r),n.resourceName+e};n.Predicate.prototype.toODataFragment=function(n){return this.visit(n,t)};t=function(){function t(n){var t=n.op.key,i=r[t];return i||t}var i={passthruPredicate:function(){return this.value},unaryPredicate:function(n){var i=this.pred.visit(n);return t(this)+" ("+i+")"},binaryPredicate:function(n){var i=this.expr1.visit(n),u=this.expr2.visit(n),f=n.prefix,r;return(f&&(i=f+"/"+i),r=t(this),"in"===this.op.key)?u.map(function(n){return"("+i+" eq "+n+")"}).join(" or "):this.op.isFunction?"substringof"===r?r+"("+u+","+i+") eq true":r+"("+i+","+u+") eq true":i+" "+r+" "+u},andOrPredicate:function(n){return this.preds.map(function(t){var i=t.visit(n);return"("+i+")"}).join(" "+t(this)+" ")},anyAllPredicate:function(i){var u=this.expr.visit(i),r,f,e;return this.pred.op?(r=i.prefix,r?(u=r+"/"+u,r="x"+(parseInt(r.substring(1))+1)):r="x1",f=n.core.extend({},i),f.entityType=this.expr.dataType,f.prefix=r,e=this.pred.visit(f),u+"/"+t(this)+"("+r+": "+e+")"):u+"/"+t(this)+"()"},litExpr:function(){return Array.isArray(this.value)?this.value.map(function(n){return this.dataType.fmtOData(n)},this):this.dataType.fmtOData(this.value)},propExpr:function(n){var t=n.entityType;return t?t.clientPropertyPathToServer(this.propertyPath,"/"):this.propertyPath},fnExpr:function(n){var t=this.exprs.map(function(t){return t.visit(n)});return this.fnName+"("+t.join(",")+")"}},r={contains:"substringof"};return i}();n.config.registerAdapter("uriBuilder",i)}),i.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery",uriBuilder:"odata"}),au=dr("ko"),au?i.config.initializeAdapterInstance("modelLibrary","ko"):i.config.initializeAdapterInstance("modelLibrary","backingStore"),i})