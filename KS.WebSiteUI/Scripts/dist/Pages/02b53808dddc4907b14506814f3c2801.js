$("#i02b53808dddc4907b14506814f3c2801").on($.asEvent.page.loaded,function(n,t,i){var g="#i02b53808dddc4907b14506814f3c2801",nt=".i02b53808dddc4907b14506814f3c2801."+$.asPageClass,r=function(n){var t=new $.as({pageId:nt});return t.as(n)},ht=function(){},gt;$(g).on($.asEvent.page.dispose,function(){ht()});$.asUrls=$.extend({cms_masterDataKeyValue_GetByDefaultsLanguageAndTypeIdAndParentId:"/odata/cms/MasterDataKeyValues?$filter=(TypeId%20eq%20@typeIdd)%20and%20(ParentId%20eq%20@idd)&$select=Id%2CParentId%2CCode%2COrder%2CName",develop_code_database_sqlserver_connections:"/develop/code/database/sqlserver/connections",develop_code_os_dotNet_generateMigration:"/develop/code/os/dotnet/GenerateMigration",develop_code_os_dotNet_getOutputVersionNumbers:"/develop/code/os/dotnet/GetOutputVersionNumbers/@codeId",develop_code_os_dotNet_getNamespaceAndClassesByDllId:"/odata/cms/MasterDataKeyValues?$filter=(((ForeignKey1%20eq%20752d)%20or%20(ForeignKey1%20eq%20753d))%20and%20(TypeId%20eq%201041d))%20and%20(ForeignKey2%20eq%20@dllIdd)&$select=Id%2CParentId%2CPathOrUrl%2CName%2CCode%2COrder",develop_code_os_dotNet_getDbMigrationClasses:"/develop/code/os/dotnet/GetDbMigrationClasses/@dllVersion/@configurationClassId",develop_code_os_dotNet_runMigration:"/develop/code/os/dotnet/RunMigration",develop_code_os_dotNet_getMigrationScript:"/develop/code/os/dotnet/GetMigrationScript"},$.asUrls);var tt=$(nt),y=r("#frmMigration"),u=r("#migCodeEditor"),it=r("#winFind"),ct=r("#txtFind"),lt=r("#txtReplace"),at=r("#chkFindCase"),vt=r("#chkFindWhole"),yt=r("#chkFindExp"),pt=r("#chkFindSelect"),fi=r("#chkStatus"),ti=r("#btnNext"),ii=r("#btnPrev"),rt=r("#drpEditorNames"),ei=r("#txtDbMigrationsConfiguration"),p=r("#txtRootNamespace"),wt=r("#txtMigration"),ri=r("#btnExecute"),oi=r("#btnUpdateMigration"),ut=r("#migCodeEditor_container"),bt=r("#drpConnection"),kt=r("#drpDllVersion"),o=r("#drpClass"),ft=r("#drpMigrations"),w=r("#divRunMigrations"),l=r("#divNewMigration"),b=r("#drpAction"),k=r("#divScript"),d=r("#drpSourceMigration"),et=r("#drpTargetMigration"),ot=r("#chkForce"),s=1,a=0,v=0,h,st=!1,f=0,c=[],e=null,dt;l.show();w.hide();k.hide();it.asWindow({focusedId:"txtFind"});u.asCodeEditor();ft.asDropdown("init","  ابتدا کلاس Configuration و نگارش اسمبلی را انتخاب نمایید",{source:{displayDataField:"Name",valueDataField:"Name",orderby:"Name"}});et.asDropdown("init","  ابتدا کلاس Configuration و نگارش اسمبلی را انتخاب نمایید",{source:{displayDataField:"Name",valueDataField:"Name",orderby:"Name"}});d.asDropdown("init","  ابتدا کلاس Configuration و نگارش اسمبلی را انتخاب نمایید",{source:{displayDataField:"Name",valueDataField:"Name",orderby:"Name"}});bt.asDropdown({source:{url:$.asUrls.develop_code_database_sqlserver_connections,displayDataField:"Value",valueDataField:"Key",orderby:"Value"}});rt.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Id"},parentDataField:{name:"ParentId"},removeChildLessParent:!1},url:$.asInitService($.asUrls.cms_masterDataKeyValue_GetByDefaultsLanguageAndTypeIdAndParentId,[{name:"@typeId",value:1030},{name:"@id",value:196}]),displayDataField:"Name",valueDataField:"Code",orderby:"Order"}});gt={drpClass:{asType:"asDropdown",required:!0},drpDllVersion:{asType:"asDropdown",required:!0},txtRootNamespace:{required:{depends:function(){return l.is(":visible")}}},txtMigration:{required:{depends:function(){return l.is(":visible")}}}};dt=y.asValidate({rules:gt});var si=function(){$.asStorage.setItem("migCodeEditor",u.asCodeEditor("getValue"))},ni=function(){o.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Id"},parentDataField:{name:"ParentId"},removeChildLessParent:!1},url:$.asInitService($.asUrls.develop_code_os_dotNet_getNamespaceAndClassesByDllId,[{name:"@dllId",value:i.codeId}]),displayDataField:"Name",valueDataField:"Id",orderby:"Order"},multiple:!1,selectParents:!1});kt.asDropdown({source:{url:$.asInitService($.asUrls.develop_code_os_dotNet_getOutputVersionNumbers,[{name:"@codeId",value:i.codeId}]),displayDataField:"Value",valueDataField:"Id",orderby:"Id"}});b.asDropdown({source:{localData:[{Value:"اجرای یک Migration",Key:1},{Value:"  ایجاد Migration جدید",Key:2},{Value:"تولید اسکریپت یک بین دو Migration  ",Key:3}],displayDataField:"Value",valueDataField:"Key",orderby:"Value"}});s=1;b.asDropdown("selectValue",1);b.trigger("change");ut.hide();wt.val("");p.val("");u.asCodeEditor("setValue","");h="csharp";rt.asDropdown("selectValue","csharp");u.asCodeEditor("setEditorMode","csharp")},ui=function(){var gt,t,nt,n;$(g).on($.asEvent.modal.reopen,function(n,t){t.codeId!==i.codeId&&(i=t,ni())});gt=function(n){return $.asAjaxTask({url:n})};t=function(){a>0&&o.asDropdown("selected")&&s!==2&&r("#divMigrations").asAfterTasks([gt($.asInitService($.asUrls.develop_code_os_dotNet_getDbMigrationClasses,[{name:"@dllVersion",value:a},{name:"@configurationClassId",value:o.asDropdown("selected").value}]))],function(n){var t=[];$.each(n,function(n,i){t.push({Name:i})});ft.asDropdown("reload",{localData:t});et.asDropdown("reload",{localData:t});t.push({Name:"دیتابیس خالی"});d.asDropdown("reload",{localData:t})},{overlayClass:"as-overlay-absolute-no-height"})};b.on("change",function(n,t){t&&(s=t.value);s===2?(l.show(),w.hide(),k.hide()):s===1?(l.hide(),w.show(),k.hide()):(l.hide(),w.hide(),k.show())});kt.on("change",function(n,i){a=i.value;t()});o.on("change",function(){t()});bt.on("change",function(n,t){v=t.value});ri.on("click",function(){v===0?$.asShowMessage({template:"error",message:" برای اجرا یک ارتباط را انتخاب نمایید"}):s===2?tt.asAjax({url:$.asUrls.develop_code_os_dotNet_generateMigration,data:JSON.stringify({Name:wt.val(),Language:h,ConnectionId:v,ConfigurationCodeId:o.asDropdown("selected").value,DllVersion:a,RootNamespace:p.val(),Force:ot.is(":checked")}),success:function(n){$.asShowMessage({message:$.asRes[$.asLang].successOpration});ut.show();u.asCodeEditor("setEditorMode",h);u.asCodeEditor("setValue",n.UserCode+"\n"+n.DesignerCode)}},{$form:y,validate:!0,overlayClass:"as-overlay-absolute"}):s===1?tt.asAjax({url:$.asUrls.develop_code_os_dotNet_runMigration,data:JSON.stringify({Name:ft.asDropdown("selected").value,Language:h,ConnectionId:v,ConfigurationCodeId:o.asDropdown("selected").value,DllVersion:a,RootNamespace:p.val(),Force:ot.is(":checked")}),success:function(){$.asShowMessage({message:$.asRes[$.asLang].successOpration})}},{$form:y,validate:!0,overlayClass:"as-overlay-absolute"}):tt.asAjax({url:$.asUrls.develop_code_os_dotNet_getMigrationScript,data:JSON.stringify({TargetName:et.asDropdown("selected").value,SourceName:d.asDropdown("selected").value==="دیتابیس خالی"?"":d.asDropdown("selected").value,Language:h,ConnectionId:v,ConfigurationCodeId:o.asDropdown("selected").value,DllVersion:a,RootNamespace:p.val(),Force:ot.is(":checked")}),success:function(n){$.asShowMessage({message:$.asRes[$.asLang].successOpration});ut.show();u.asCodeEditor("setEditorMode","sqlserver");u.asCodeEditor("setValue",n)}},{$form:y,validate:!0,overlayClass:"as-overlay-absolute"})});ht=function(){dt.destroy()};$(g).on($.asEvent.page.ready,function(){ni()});nt=function(){e.asCodeEditor("toggleCommentLines")};n=function(){e.asCodeEditor("find",ct.val(),{backwards:!1,wrap:!1,range:pt.is(":checked")===!0?e.asCodeEditor("getSelectionRange"):null,caseSensitive:at.is(":checked"),wholeWord:vt.is(":checked"),regExp:yt.is(":checked")})};u.asCodeEditor("editor").commands.addCommand({name:"Find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){it.asWindow("show")},readOnly:!0});u.asCodeEditor("editor").commands.addCommand({name:"CommentToggel",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(){nt()},readOnly:!1});ii.click(function(){st=!0;f=f===0?c.length-1:f;u.asCodeEditor("editor").gotoLine(c[f]);f>1&&f--});ti.click(function(){st=!0;f=f===0?c.length-1:f;u.asCodeEditor("editor").gotoLine(c[f]);f<c.length-1&&f++});u.asCodeEditor("editor").getSession().on("change",function(){f=c.length-1});u.asCodeEditor("editor").on("focus",function(){e=u;st=!1});u.asCodeEditor("editor").getSession().selection.on("changeCursor",function(){c.push(u.asCodeEditor("editor").selection.getCursor().row)});r("#btnToggleComment").click(function(){nt()});r("#btnFindWindow").click(function(){it.asWindow("show")});rt.on("change",function(n,t){h=t.value;u.asCodeEditor("setEditorMode",h)});ct.on("input",function(){n()});at.change(function(){n()});vt.change(function(){n()});yt.change(function(){n()});pt.change(function(){n()});r("#btnRecovery").click(function(){recoverEditor()});r("#btnReplace").click(function(){e.asCodeEditor("replace",lt.val())});r("#btnReplaceAll").click(function(){e.asCodeEditor("replaceAll",lt.val())});r("#btnFindNext").click(function(){e.asCodeEditor("findNext")});r("#btnFindPrev").click(function(){e.asCodeEditor("findPrevious")})};ui();$(nt).append('<span id="asRegisterPage"><\/span>');r("#asRegisterPage").asRegisterPageEvent();typeof t!="undefined"&&$.asLoadPage(t,t.replace(/\//g,$.asUrlDelimeter))})