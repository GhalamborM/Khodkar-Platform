$("#i6d9cd4e917434e609fa45416cd713d85").on($.asEvent.page.loaded,function(n,t){var a="#i6d9cd4e917434e609fa45416cd713d85",yi=".i6d9cd4e917434e609fa45416cd713d85."+$.asPageClass,r=function(n){var t=new $.as({pageId:yi});return t.as(n)},pi=function(){},wr,br,kr;$(a).on($.asEvent.page.dispose,function(){pi()});$.asUrls=$.extend({cms_masterDataKeyValue_GetByOtherLanguagesAndTypeId:"/odata/cms/MasterDataLocalKeyValues?$filter=(MasterDataKeyValue%2FTypeId%20eq%20@typeIdd)%20and%20(Language%20eq%20'@lang')&$expand=MasterDataKeyValue&$select=MasterDataKeyValue%2FId%2CMasterDataKeyValue%2FParentId%2CMasterDataKeyValue%2FCode%2CMasterDataKeyValue%2FOrder%2CMasterDataKeyValue%2FName%2CMasterDataKeyValue%2FKey%2CMasterDataKeyValue%2FValue%2CMasterDataKeyValue%2FIsLeaf%2CMasterDataKeyValue%2FPathOrUrl%2CName",security_Role_getAllByOtherLanguage:"/odata/security/LocalRoles?$filter=(Language%20eq%20'@lang')&$expand=Role&$select=Role%2FId%2CRole%2FParentId%2CRole%2FName%2CRole%2FOrder%2CRole%2FIsLeaf%2CName",develop_code_database_sqlserver_save:"/develop/code/database/sqlserver/Save",develop_code_database_sqlserver_delete:"/develop/code/database/sqlserver/delete",develop_code_database_sqlserver_exec:"/develop/code/database/sqlserver/Exec",develop_code_database_sqlserver_get:"/develop/code/database/sqlserver/get/@id",develop_code_database_sqlserver_getCodeContent:"/develop/code/database/sqlserver/GetCodeContent/@path/@id",develop_code_database_sqlserver_file_save:"/develop/code/database/sqlserver/file/Save",develop_code_database_sqlserver_getChanges:"/develop/code/database/sqlserver/GetChanges/@codePath/@codeName/@orderBy/@skip/@take/@comment/@user/@fromDateTime/@toDateTime",develop_code_database_sqlserver_getChange:"/develop/code/database/sqlserver/GetChange/@changeId/@path/@codeId",develop_code_database_sqlserver_connectionsByOtherLanguage:"/develop/code/database/sqlserver/connectionsByOtherLanguage/@lang"},$.asUrls);var d=r("#frmCode"),nu=r("#divRoles"),u=r("#edrCode"),g=r("#drpViewRole"),nt=r("#drpModifyRole"),tt=r("#drpAccessRole"),l=r("#drpCodes"),it=r("#txtName"),tu=r("#btnSave"),iu=r("#btnSaveCode"),ru=r("#btnSelectFile"),uu=r("#btnSelectDir"),kt=r("#chkEditeMode"),oi=r("#divFind"),wi=$.asModalManager.get({url:$.asModalManager.urls.translator}),bi=$.asModalManager.get({url:$.asModalManager.urls.directorySelector}),ki=$.asModalManager.get({url:$.asModalManager.urls.fileManager}),di=$.asModalManager.get({url:$.asModalManager.urls.fileSelector}),gi=r("#txtFind"),nr=r("#txtReplace"),tr=r("#chkFindCase"),ir=r("#chkFindWhole"),rr=r("#chkFindExp"),ur=r("#chkFindSelect"),du=r("#editorToolbar"),fu=r("#lblEditor"),rt=r("#txtDescription"),ht=r("#txtOrder"),dt=r("#winRestorEditor"),ut=r("#txtId"),fr=r("#txtCodeId"),v=r("#txtUrl"),gt=r("#chkIsLeaf"),p=r("#chkNew"),ct=r("#txtCode"),lt=r("#chkCache"),ni=r("#chkStatus"),er=r("#chkCheckIn"),si=r("#txtVersion"),eu=r("#txtSlidingExpirationTimeInMinutes"),ou=r("#btnNext"),su=r("#btnPrev"),hu=r("#btnDell"),or=r("#btnTranslator"),ft=r("#btnManageCode"),cu=r("#divUrl"),sr=r(".divSelectDir"),o=r("#divEditor"),hr=r("#drpConnection"),lu=r("#btnExecuteQuery"),au=r("#btnExecuteNoneQuery"),et=r("#btnExec"),cr=r("#txtComment"),lr=$.asModalManager.get({url:$.asModalManager.urls.sourceManager}),ar=$.asModalManager.get({url:$.asModalManager.urls.sourceComparator}),at,ot,vt,vu=!1,st="",yt=!1,vr=null,y=0,w=0,b=0,yu=1040,ti=0,hi=!1,pt="",wt,ii,e=null,ri=!1,ci=!1,h=0,k=[],c=null,s,bt=0,ui=null,f={},fi={},yr,li={},pu,pr=!0,ai=[],wu='<table id="@id" class="table table-condensed table-hover table-striped table-responsive"><thead><tr><\/tr><\/thead><tbody><\/tbody><\/table>';cu.hide();o.hide();ar.asModal({width:1200});lr.asModal({width:800});ki.asModal({width:800});bi.asModal({width:800});di.asModal({width:800});wi.asModal({width:800});oi.asWindow({focusedId:"txtFind"});dt.asModal({backdrop:"static",keyboard:!1});u.asCodeEditor({mode:"sqlserver"});wr=function(n){return $.asAjaxTask({url:n})};nu.asAfterTasks([wr($.asInitService($.asUrls.security_Role_getAllByOtherLanguage,[{name:"@lang",value:$.asLang}]))],function(n){pu=n;g.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Role.Id"},parentDataField:{name:"Role.ParentId"},childrenDataField:"Children",isLeafDataField:"Role.IsLeaf",removeChildLessParent:!0},valueDataField:"Role.Id",displayDataField:"Name",orderby:"Role.Order",localData:n}});tt.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Role.Id"},parentDataField:{name:"Role.ParentId"},childrenDataField:"Children",isLeafDataField:"Role.IsLeaf",removeChildLessParent:!0},valueDataField:"Role.Id",displayDataField:"Name",orderby:"Role.Order",localData:n}});nt.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Role.Id"},parentDataField:{name:"Role.ParentId"},childrenDataField:"Children",isLeafDataField:"Role.IsLeaf",removeChildLessParent:!0},valueDataField:"Role.Id",displayDataField:"Name",orderby:"Role.Order",localData:n}})},{overlayClass:"as-overlay-relative"});hr.asDropdown({source:{url:$.asInitService($.asUrls.develop_code_database_sqlserver_connectionsByOtherLanguage,[{name:"@lang",value:$.asLang}]),displayDataField:"Value",valueDataField:"Key",orderby:"Value"}});l.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"MasterDataKeyValue.Id"},parentDataField:{name:"MasterDataKeyValue.ParentId"},removeChildLessParent:!1},url:$.asInitService($.asUrls.cms_masterDataKeyValue_GetByOtherLanguagesAndTypeId,[{name:"@typeId",value:1040},{name:"@lang",value:$.asLang}]),displayDataField:"Name",valueDataField:"MasterDataKeyValue.Id",orderby:"MasterDataKeyValue.Order"},selectParents:!0});br={txtCode:{required:!0},txtCodeId:{required:!0},txtName:{required:!0,maxlength:128},txtDescription:{maxlength:256},txtId:{maxlength:32},drpViewRole:{asType:"asDropdown",required:!0},drpAccessRole:{asType:"asDropdown",required:!0},drpModifyRole:{asType:"asDropdown",required:!0}};yr=d.asValidate({rules:br});kr=function(){var t=function(){e=$.asGetQueryString();e!==null&&($.asTemp[e]=$.asTemp[e]||{},$.asTemp[e].sqlServeCodeQueryEditor=$.asTemp[e].sqlServeCodeQueryEditor||"",$.asTemp[e].sqlServeCodeQueryEditor!==""&&$.asStorage.setItem("sqlServeCodeQueryEditor"+e,$.asTemp[e].sqlServeCodeQueryEditor))},vi,kr;$(a).on($.asEvent.page.ready,function(){ft.prop("disabled",!0);u.asCodeEditor("focus");dt.asModal("show");l.css({"margin-top":"0"})});$(a).on($.asEvent.page.queryStringChange,function(){t();ui===null&&(ui=setInterval(dr,5e3));gr()});$(a).on("folderSelected",function(n,t){v.val(t)});vi=function(n,t){ar.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter($.asModalManager.urls.sourceComparator)},{name:"@isModal",value:!0}]),{editorCode:u.asCodeEditor("getValue"),sourceControlCode:n,fileName:t})};$(a).on("compare",function(n,t){o.asAjax({url:$.asInitService($.asUrls.develop_code_database_sqlserver_getChange,[{name:"@changeId",value:t},{name:"@path",value:ot.replace(/\//g,$.asUrlDelimeter)},{name:"@codeId",value:s}]),type:"get",success:function(n){vi(n,vt)}},{validate:!1,overlayClass:"as-overlay-absolute"})});$(a).on("changeSetSelected",function(n,t){o.asAjax({url:$.asInitService($.asUrls.develop_code_database_sqlserver_getChange,[{name:"@changeId",value:t},{name:"@path",value:ot.replace(/\//g,$.asUrlDelimeter)},{name:"@codeId",value:s}]),type:"get",success:function(n){u.asCodeEditor("setValue",n)}},{validate:!1,overlayClass:"as-overlay-absolute"})});r("#btnSourceControl").click(function(){vt&&ot?lr.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter($.asModalManager.urls.sourceManager)},{name:"@isModal",value:!0}]),{parent:a,selectEvent:"changeSetSelected",compareEvent:"compare",getUrl:$.asInitService($.asUrls.develop_code_database_sqlserver_getChanges,[{name:"@codeName",value:vt},{name:"@codePath",value:ot.replace(vt,"").replace(/\//g,$.asUrlDelimeter)}])}):$.asShowMessage({template:"error",message:"no file selected"})});ft.click(function(){l.asDropdown("selected")?ki.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter($.asModalManager.urls.fileManager)},{name:"@isModal",value:!0}]),{path:st}):$.asShowMessage({template:"error",message:"No code selected"})});r("#btnEditorResize").click(function(){br()});var yi=function(){bt===0?$.asShowMessage({template:"error",message:" Choose a connection to run"}):(u.asCodeEditor("getValue")&&et.button("loading"),o.asAjax({url:$.asUrls.develop_code_database_sqlserver_exec,data:JSON.stringify({ConnectionId:bt,Code:at!==""?at:u.asCodeEditor("getValue"),IsQuery:!0}),success:function(n){pr||($.each(ai,function(n,t){var i=r("#"+t);i.asBootGrid("destroy")}),ai=[]);r("#divResult").empty();$.each(n,function(n,t){pr=!1;kr(t)});et.button("reset");$.asShowMessage({message:$.asRes[$.asLang].successOpration,showTime:1e7})},error:function(){et.button("reset")}},{validate:!1,overlayClass:"as-overlay-absolute"}))},nu=function(){bt===0?$.asShowMessage({template:"error",message:"Choose a connection to run"}):(u.asCodeEditor("getValue")&&et.button("loading"),o.asAjax({url:$.asUrls.develop_code_database_sqlserver_exec,data:JSON.stringify({ConnectionId:bt,Code:at!==""?at:u.asCodeEditor("getValue"),IsQuery:!1}),success:function(n){r("#divResult").empty("");r("#divResult").html("Affected Row : "+n[0]);et.button("reset");$.asShowMessage({message:$.asRes[$.asLang].successOpration,showTime:1e7})},error:function(){et.button("reset")}},{validate:!1,overlayClass:"as-overlay-absolute"}))},wr=function(){c.asCodeEditor("toggleCommentLines")},n=function(){c.asCodeEditor("find",gi.val(),{backwards:!1,wrap:!1,range:ur.is(":checked")===!0?c.asCodeEditor("getSelectionRange"):null,caseSensitive:tr.is(":checked"),wholeWord:ir.is(":checked"),regExp:rr.is(":checked")})},br=function(){r("#"+c.prop("id")+"_container").toggleClass("editor-fullscreen");c.toggleClass("editor-fullHeight");c.asCodeEditor("resize")},fu=function(){e=$.asGetQueryString();e!==null&&(o.show(),u===c&&c.asCodeEditor("setValue",$.asStorage.getItem("sqlServeCodeQueryEditor"+e)))},cu=function(){e=$.asGetQueryString();e!==null&&(o.show(),u.asCodeEditor("setValue",$.asStorage.getItem("sqlServeCodeQueryEditor"+e)))};u.asCodeEditor("editor").commands.addCommand({name:"Find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){oi.asWindow("show")},readOnly:!0});u.asCodeEditor("editor").commands.addCommand({name:"CommentToggel",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(){wr()},readOnly:!1});u.asCodeEditor("editor").commands.addCommand({name:"fullScreen",bindKey:{win:"Ctrl-L",mac:"Command-L"},exec:function(){br()},readOnly:!1});u.asCodeEditor("editor").commands.addCommand({name:"executeQuery",bindKey:{win:"Ctrl-E",mac:"Command-E"},exec:function(){yi()},readOnly:!1});su.click(function(){ci=!0;h=h===0?k.length-1:h;u.asCodeEditor("editor").gotoLine(k[h]);h>1&&h--});ou.click(function(){ci=!0;h=h===0?k.length-1:h;u.asCodeEditor("editor").gotoLine(k[h]);h<k.length-1&&h++});u.asCodeEditor("editor").getSession().on("change",function(){h=k.length-1});u.asCodeEditor("editor").on("focus",function(){c=u;ku("Query");ci=!1});u.asCodeEditor("editor").getSession().selection.on("changeCursor",function(){k.push(u.asCodeEditor("editor").selection.getCursor().row)});u.asCodeEditor("editor").getSession().selection.on("changeSelection",function(){at=u.asCodeEditor("editor").session.getTextRange(u.asCodeEditor("editor").getSelectionRange())});lt.change(function(){r("#divSlidingExpirationTimeInMinutes").prop("disabled",!this.checked)});gt.change(function(){this.checked===!1?(sr.show(),v.prop("disabled",!1),ft.prop("disabled",!0),o.hide()):(sr.hide(),v.prop("disabled",!0),ft.prop("disabled",!1),o.show())});p.change(function(){this.checked===!0?hi===!0?($.asShowMessage({template:"error",message:" You can not add a code to another code"}),p.prop("checked",!1)):(r("#divResult").empty(),ut.prop("disabled",!1),f.Id=s,s=0,f.Isleaf=hi,f.IsType=yt,yt=!1,f.ParentId=ti,ti=f.Id,f.RowVersion=pt,pt="",f.JsCode=u.asCodeEditor("getValue"),u.asCodeEditor("setValue",""),f.Name=it.val(),it.val(""),f.Description=rt.val(),rt.val(""),f.Code=ct.val(),ct.val(""),f.Url=v.val(),v.val(st+"/"+wt),f.Guid=ut.val(),f.NewGuid=wt,ut.val(wt),f.NewId=ii,fr.val(ii),f.Version=si.val(),si.val("0"),f.Order=ht.val(),ht.val(""),f.EnableCache=lt.prop("checked"),lt.prop("checked",!1),f.EditMode=kt.prop("checked"),kt.prop("checked",!1),f.Status=ni.prop("checked"),ni.prop("checked",!1),f.ViewRoleId=y,g.asDropdown("selectValue",[],!0),f.AccessRoleId=b,tt.asDropdown("selectValue",[],!0),f.ModifyRoleId=w,nt.asDropdown("selectValue",[],!0)):ei(f)});uu.click(function(){l.asDropdown("selected")?bi.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter($.asModalManager.urls.directorySelector)},{name:"@isModal",value:!0}]),{path:st,parent:a,event:"folderSelected"}):$.asShowMessage({template:"error",message:"No code selected"})});r("#btnFindWindow").click(function(){oi.asWindow("show")});gi.on("input",function(){n()});tr.change(function(){n()});ir.change(function(){n()});rr.change(function(){n()});ur.change(function(){n()});r("#btnRecovery").click(function(){fu()});r("#btnReplace").click(function(){c.asCodeEditor("replace",nr.val())});r("#btnReplaceAll").click(function(){c.asCodeEditor("replaceAll",nr.val())});r("#btnToggleComment").click(function(){wr()});r("#btnFindNext").click(function(){c.asCodeEditor("findNext")});r("#btnFindPrev").click(function(){c.asCodeEditor("findPrevious")});r("#btnCancelRestor").click(function(){dt.asModal("hide");gr();e=$.asGetQueryString();e!==null&&(t(),ui=setInterval(dr,5e3))});r("#btnRestorPerviousEditors").click(function(){dt.asModal("hide");cu()});hu.click(function(){l.asDropdown("selected")?d.asAjax({url:$.asUrls.develop_code_database_sqlserver_delete,data:JSON.stringify({Id:s}),success:function(){$.asShowMessage({message:$.asRes[$.asLang].successOpration,showTime:1e7});l.asDropdown("removeItem")}},{$form:d}):$.asShowMessage({template:"error",message:"To remove, you must select a code"})});tu.click(function(){var n,t;l.asDropdown("selected")&&(p.is(":checked")?(t=wt,n=ii):(t=ut.val(),n=s));gt.is(":checked")===!1&&p.is(":checked")&&(li[n]=!0,o.show());g.asDropdown("selected")&&(y=g.asDropdown("selected").value);nt.asDropdown("selected")&&(w=nt.asDropdown("selected").value);tt.asDropdown("selected")&&(b=tt.asDropdown("selected").value);d.asAjax({url:$.asUrls.develop_code_database_sqlserver_save,data:JSON.stringify({Id:n,TypeId:yu,ParentId:ti,PathOrUrl:v.val(),IsPath:!0,ViewRoleId:y,ModifyRoleId:w,AccessRoleId:b,Code:ct.val(),Name:it.val(),Description:rt.val(),Guid:t,Order:ht.val(),Status:ni.is(":checked"),EnableCache:lt.is(":checked"),EditMode:kt.is(":checked"),IsLeaf:gt.is(":checked"),IsType:yt,ParentTypeId:yt?vr:null,IsNew:p.is(":checked"),SlidingExpirationTimeInMinutes:eu.val(),RowVersion:pt}),success:function(t){if(p.is(":checked")){var i=!1;li[fi.value]&&(i=!0,delete li[fi.value]);l.asDropdown("addItem",{text:it.val(),value:n},fi,i)}ei(t,!1);$.asShowMessage({message:$.asRes[$.asLang].successOpration,showTime:1e7})}},{$form:d})});kr=function(n){var t=$.asuniqueId(),u,o,f,e;if(ai.push(t),r("#divResult").append(wu.replace("@id",t)),u=r("#"+t),n&&(o=0,$.each(n[0],function(n){u.find("thead tr").append('<th data-header-align="center" data-align = "center" data-column-id="'+n+'" data-order="desc" data-css-class="ltr" >'+n+"<\/th>");o++})),n){for(f=[],i=0;i<n.length;i++)e={},$.each(n[i],function(n,t){e[n]=t===null?"":t[0]}),f.push(e);u.asBootGrid({caseSensitive:!1,rowCount:[-1],source:{localData:f}})}};lu.click(function(){yi()});au.click(function(){nu()});hr.on("change",function(n,t){bt=t.value});l.on("change",function(n,t){fi=t;s=t.value;or.removeClass("disabled");ri===!1&&typeof t.value!="undefined"&&$.asSetQueryString(t.value)});$(a).on("fileSelected",function(n,t,i,r){vt=r;ot=t;var f=r.toLowerCase().split(".");o.asAjax({url:$.asInitService($.asUrls.develop_code_database_sqlserver_getCodeContent,[{name:"@id",value:s},{name:"@path",value:$.asUrlAsParameter(t)}]),type:"get",success:function(n){u.asCodeEditor("setValue",n)}},{validate:!1,overlayClass:"as-overlay-absolute"})});ru.click(function(){di.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter($.asModalManager.urls.fileSelector)},{name:"@isModal",value:!0}]),{path:st,parent:a,event:"fileSelected"})});iu.click(function(){o.asAjax({url:$.asUrls.develop_code_database_sqlserver_file_save,data:JSON.stringify({Id:s,Code:u.asCodeEditor("getValue"),Path:ot,CheckIn:er.is(":checked"),Comment:cr.val()}),success:function(){$.asShowMessage({message:$.asRes[$.asLang].successOpration,showTime:1e7})}},{validate:!1,overlayClass:"as-overlay-absolute"})});or.click(function(){wi.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter($.asModalManager.urls.translator)},{name:"@isModal",value:!0}]),{type:"masterDataKeyValue",id:s,name:it.val(),description:rt.val()})});pi=function(){window.clearInterval(ui);yr.destroy()}};kr();var vi=function(){$.asNotFound("کد")},bu=function(n){ri=!0;l.asDropdown("selectValue",[],!0);l.asDropdown("selectValue",n);y=0;url="";ser=0;pt="";d.asAjax({url:$.asInitService($.asUrls.develop_code_database_sqlserver_get,[{name:"@id",value:n}]),type:"get",error:function(){ri=!1},success:function(n){$.isArray(n)?n.length>0?ei(n):vi():n!=null?typeof n!="undefined"?ei(n):vi():vi();ri=!1}})},dr=function(){$.asStorage.setItem("sqlServeCodeQueryEditor"+e,u.asCodeEditor("getValue"))},ku=function(n){fu.html(n)},ei=function(n,t){typeof t=="undefined"&&(t=!0);ut.prop("disabled",!0);p.prop("checked",!1);s=n.Id;cr.val("");er.prop("checked",!1);r("#divLastModifiUser").html(n.LastModifieUser);r("#divLastModifiLocalDataTime").html(n.LastModifieLocalDateTime);fr.val(s);ti=n.ParentId;pt=n.RowVersion;gt.prop("checked",n.IsLeaf);n.IsLeaf?(o.show(),ft.prop("disabled",!1)):(ft.prop("disabled",!0),o.hide());hi=n.IsLeaf;yt=n.IsType;vr=n.ParentTypeId;it.val(n.Name);n.Description!=null?rt.val(n.Description):rt.val("");n.Code!==null?ct.val(n.Code):ct.val("");n.PathOrUrl!==null?(st=n.PathOrUrl,v.val(n.PathOrUrl)):(st="",v.val(""));ut.val(n.Guid);wt=n.NewGuid;ii=n.NewId;si.val(n.Version);n.Order!==null?ht.val(n.Order):ht.val("");lt.prop("checked",n.EnableCache);kt.prop("checked",n.EditMode);ni.prop("checked",n.Status);vu=n.Status;t&&(n.BuildJs!=null?u.asCodeEditor("setValue",n.BuildJs):u.asCodeEditor("setValue",""));n.ViewRoleId!==null?(y=n.ViewRoleId,g.asDropdown("selectValue",y)):(y=[],g.asDropdown("selectValue",y,!0));n.AccessRoleId!=null?(b=n.AccessRoleId,tt.asDropdown("selectValue",b)):(b=[],tt.asDropdown("selectValue",b,!0));n.ModifyRoleId!=null?(w=n.ModifyRoleId,nt.asDropdown("selectValue",w)):(w=[],nt.asDropdown("selectValue",w,!0))},gr=function(){e=$.asGetQueryString();e!==null&&(l.asDropdown("selectValue",e),s=e,bu(s))};$(yi).append('<span id="asRegisterPage"><\/span>');r("#asRegisterPage").asRegisterPageEvent();typeof t!="undefined"&&$.asLoadPage(t,t.replace(/\//g,$.asUrlDelimeter))})