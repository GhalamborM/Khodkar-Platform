$("#i92008639798c453b88bdeaa78f399472").on($.asEvent.page.loaded,function(ah,aw,Y){var W="#i92008639798c453b88bdeaa78f399472";var X=".i92008639798c453b88bdeaa78f399472."+$.asPageClass;var U=function(aH){return $(X).find(aH)};var V=function(){};$(W).on($.asEvent.page.dispose,function(aH){V()});$.asUrls=$.extend({cms_masterDataKeyValue_GetByDefaultsLanguageAndTypeId:"/odata/cms/MasterDataKeyValues?$filter=TypeId%20eq%20@typeIdd&$select=Id%2CParentId%2CCode%2CUrl%2COrder%2CName%2CIsLeaf%2CKey%2CValue",security_Role_getAllByDefaultsLanguage:"/odata/security/Roles?$select=Id%2CParentId%2CName%2COrder%2CIsLeaf%2CDescription",cms_masterDataKeyValue_GetByDefaultsLanguageAndTypeIdAndParentId:"/odata/cms/MasterDataKeyValues?$filter=(TypeId%20eq%20@typeIdd)%20and%20(ParentId%20eq%20@idd)&$select=Id%2CParentId%2CCode%2COrder%2CName",develop_code_browser_save:"/develop/code/browser/save",develop_code_browser_delete:"/develop/code/browser/delete",develop_code_browser_get:"/develop/code/browser/get/@id",develop_code_browser_compile:"/develop/code/browser/compile"},$.asUrls);var B=U("#frmCode"),r=U("#divRoles"),A=U("#edrCode"),y=U("#drpViewRole"),x=U("#drpModifyRole"),u=U("#drpAccessRole"),v=U("#drpCodes"),w=U("#drpEditors"),I=U("#txtName"),d=U("#btnSave"),e=U("#btnSelectDir"),j=U("#chkEditeMode"),P=U("#divFind"),S=U("#winTranslator"),Q=U("#winFolderSelector"),O=U("#winCodeManager"),G=U("#txtFind"),K=U("#txtReplace"),h=U("#chkFindCase"),l=U("#chkFindHole"),k=U("#chkFindExp"),p=U("#chkFindSelect"),z=U("#editorToolbar"),C=U("#lblEditor"),F=U("#txtDescription"),J=U("#txtOrder"),R=U("#winRestorEditor"),H=U("#txtId"),E=U("#txtCodeId"),M=U("#txtUrl"),m=U("#chkIsLeaf"),n=U("#chkNew"),D=U("#txtCode"),g=U("#chkCache"),q=U("#chkStatus"),i=U("#chkDependency"),o=U("#chkPublish"),N=U("#txtVersion"),L=U("#txtSlidingExpirationTimeInMinutes"),a=U("#btnCompile"),b=U("#btnDell"),f=U("#btnTranslator"),c=U("#btnManageCode"),t=U("#divUrl"),s=U(".divSelectDir"),aA=false,at="",am=false,au=null,aG=0,ap=0,T=0,aC=0,aD="",ac=0,af=0,ak=false,ax="",ad,ae,av=null,al=false,ag=null,aj,aB={},ay={},aE,aq={};t.hide();$.asTemp.codeJavascriptQueryEditor=$.asTemp.codeJavascriptQueryEditor||"";if($.asTemp.codeJavascriptQueryEditor!==""){$.asStorage.setItem("codeJavascriptQueryEditor",$.asTemp.codeJavascriptQueryEditor)}O.asModal({width:800});Q.asModal({width:800});S.asModal({width:800});P.asWindow({focusedId:"txtFind"});R.asModal({backdrop:"static",keyboard:false});A.asCodeEditor();var ao=function(){return $.asAjaxTask({url:$.asUrls.security_Role_getAllByDefaultsLanguage})};r.asAfterTasks([ao()],function(aH){y.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Id"},parentDataField:{name:"ParentId"},childrenDataField:"Children",removeChildLessParent:true},valueDataField:"Id",displayDataField:"Description",orderby:"Order",localData:aH},parentMode:"uniq"});u.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Id"},parentDataField:{name:"ParentId"},childrenDataField:"Children",removeChildLessParent:true},valueDataField:"Id",displayDataField:"Description",orderby:"Order",localData:aH},parentMode:"uniq"});x.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Id"},parentDataField:{name:"ParentId"},childrenDataField:"Children",removeChildLessParent:true},valueDataField:"Id",displayDataField:"Description",orderby:"Order",localData:aH},parentMode:"uniq"})},{overlayClass:"as-overlay-relative"});w.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Id"},parentDataField:{name:"ParentId"},removeChildLessParent:false},url:$.asInitService($.asUrls.cms_masterDataKeyValue_GetByDefaultsLanguageAndTypeIdAndParentId,[{name:"@typeId",value:1030},{name:"@id",value:199}]),displayDataField:"Name",valueDataField:"Code",orderby:"Order"},selectParents:true});v.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Id"},parentDataField:{name:"ParentId"},removeChildLessParent:false},url:$.asInitService($.asUrls.cms_masterDataKeyValue_GetByDefaultsLanguageAndTypeId,[{name:"@typeId",value:1028}]),displayDataField:"Name",valueDataField:"Id",orderby:"Order"},selectParents:true});B.asValidate("validator").addMethod("regex",function(aK,aH,aJ){var aI=new RegExp(aJ);return this.optional(aH)||aI.test(aK)},"شناسه می تواند شامل اعدا حروف و . و _ و - باشد و با . یا - یا _ شروع نمی شود");var aF={txtCode:{required:true},txtCodeId:{required:true},txtName:{required:true,maxlength:128},txtDescription:{maxlength:256},txtId:{maxlength:32,regex:"^[A-Za-z0-9][A-Za-z0-9_\\-\\.]*$"},drpViewRole:{asType:"asDropdown",required:true},drpAccessRole:{asType:"asDropdown",required:true},drpModifyRole:{asType:"asDropdown",required:true}};aE=B.asValidate({rules:aF});var aa=function(){$(W).on($.asEvent.page.ready,function(aM){c.prop("disabled",true);A.asCodeEditor("focus");R.asModal("show");w.asDropdown("selectValue","javascript")});$(W).on($.asEvent.page.queryStringChange,function(aM,aN,aO){an()});$(W).on("folderSelected",function(aM,aN,aO){M.val(aN)});c.click(function(){if(v.asDropdown("selected")){O.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter("fa/fms/files-folders-manager-for-a-path/")},{name:"@isModal",value:true}]),{path:at})}else{$.asShowMessage({template:"error",message:"هیچ کدی انتخاب نشده است"})}});U("#btnEditorResize").click(function(){aL()});var aH=function(){ag.asCodeEditor("toggleCommentLines")};var aI=function(){ag.asCodeEditor("find",G.val(),{backwards:false,wrap:false,range:p.is(":checked")===true?ag.asCodeEditor("getSelectionRange"):null,caseSensitive:h.is(":checked"),wholeWord:l.is(":checked"),regExp:k.is(":checked")})};var aL=function(){U("#"+ag.prop("id")+"_container").toggleClass("editor-fullscreen");ag.toggleClass("editor-fullHeight");ag.asCodeEditor("resize")};var aK=function(){if(A===ag){ag.asCodeEditor("setValue",$.asStorage.getItem("codeJavascriptQueryEditor"))}};var aJ=function(){A.asCodeEditor("setValue",$.asStorage.getItem("codeJavascriptQueryEditor"))};A.asCodeEditor("editor").commands.addCommand({name:"Find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(aM){P.asWindow("show")},readOnly:true});A.asCodeEditor("editor").commands.addCommand({name:"CommentToggel",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(aM){aH()},readOnly:false});A.asCodeEditor("editor").commands.addCommand({name:"fullScreen",bindKey:{win:"Ctrl-L",mac:"Command-L"},exec:function(aM){aL()},readOnly:false});A.asCodeEditor("editor").on("focus",function(){ag=A;ab("کوئری")});g.change(function(){U("#divSlidingExpirationTimeInMinutes").prop("disabled",!this.checked)});m.change(function(){if(this.checked===false){s.show();M.prop("disabled",false);c.prop("disabled",true)}else{s.hide();M.prop("disabled",true);c.prop("disabled",false)}});n.change(function(){if(this.checked===true){if(ak===true){$.asShowMessage({template:"error",message:"  امکان افزودن یک کد به کد دیگر وجود ندارد"});n.prop("checked",false)}else{H.prop("disabled",false);aB.Id=ac;ac=0;aB.Isleaf=ak;aB.ParentId=af;af=0;aB.RowVersion=ax;ax="";aB.JsCode=A.asCodeEditor("getValue");A.asCodeEditor("setValue","");aB.Name=I.val();I.val("");aB.Description=F.val();F.val("");aB.Code=D.val();D.val("");aB.Url=M.val();M.val(at+"/"+ad);aB.Guid=H.val();aB.NewGuid=ad;H.val(ad);aB.NewId=ae;E.val(ae);aB.Version=N.val();N.val("0");aB.Order=J.val();J.val("");aB.EnableCache=g.prop("checked");g.prop("checked",false);aB.EditMode=j.prop("checked");j.prop("checked",false);aB.Status=q.prop("checked");q.prop("checked",false);aB.ViewRoleId=aG;y.asDropdown("selectValue",[],true);aB.AccessRoleId=T;u.asDropdown("selectValue",[],true);aB.ModifyRoleId=ap;x.asDropdown("selectValue",[],true)}}else{az(aB)}});e.click(function(){if(v.asDropdown("selected")){Q.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter("fa/fms/folder-selector/")},{name:"@isModal",value:true}]),{path:at,parent:W,event:"folderSelected"})}else{$.asShowMessage({template:"error",message:"کدی انتخاب نشده است"})}});U("#btnFindWindow").click(function(){P.asWindow("show")});G.on("input",function(){aI()});h.change(function(){aI()});l.change(function(){aI()});k.change(function(){aI()});p.change(function(){aI()});U("#btnRecovery").click(function(){aK()});U("#btnReplace").click(function(){ag.asCodeEditor("replace",K.val())});U("#btnReplaceAll").click(function(){ag.asCodeEditor("replaceAll",K.val())});U("#btnToggleComment").click(function(){aH()});U("#btnFindNext").click(function(){ag.asCodeEditor("findNext")});U("#btnFindPrev").click(function(){ag.asCodeEditor("findPrevious")});U("#btnCancelRestor").click(function(){R.asModal("hide");an();aj=setInterval(Z,5000)});U("#btnRestorPerviousEditors").click(function(){R.asModal("hide");aJ()});a.click(function(){if(v.asDropdown("selected")){if(!aA){$.asShowMessage({template:"error",message:" کد غیر فعال می باشد و فقط به حالت دیباگ منتشر می شود"})}B.asAjax({url:$.asUrls.develop_code_browser_compile,data:JSON.stringify({Id:v.asDropdown("selected").value,IsPublish:o.is(":checked"),Dependency:i.is(":checked"),}),success:function(aM){$.asShowMessage({message:$.asRes[$.asLang].successOpration})}},{validate:false})}else{$.asShowMessage({template:"error",message:"برای حذف یک سرویس را انتخاب نمایید"})}});b.click(function(){if(v.asDropdown("selected")){B.asAjax({url:$.asUrls.develop_code_browser_delete,data:JSON.stringify({Id:v.asDropdown("selected").value,}),success:function(aM){$.asShowMessage({message:$.asRes[$.asLang].successOpration});v.asDropdown("removeItem")}},{$form:B})}else{$.asShowMessage({template:"error",message:"برای حذف یک سرویس را انتخاب نمایید"})}});d.click(function(){var aP;var aN,aQ,aM;if(v.asDropdown("selected")){if(n.is(":checked")){aM=ad;aQ=v.asDropdown("selected").value;aN=ae}else{aM=H.val();aN=v.asDropdown("selected").value;aQ=af}}if(m.is(":checked")===false&&n.is(":checked")){aq[aN]=true}if(y.asDropdown("selected")){aG=y.asDropdown("selected").value}if(x.asDropdown("selected")){ap=x.asDropdown("selected").value}if(u.asDropdown("selected")){T=u.asDropdown("selected").value}var aO=A.asCodeEditor("getValue");$.asTemp.codeJavascriptQueryEditor=aO;B.asAjax({url:$.asUrls.develop_code_browser_save,data:JSON.stringify({Id:aN,TypeId:1028,ParentId:aQ,Url:M.val(),ViewRoleId:aG,ModifyRoleId:ap,AccessRoleId:T,Code:D.val(),JsCode:aO,Name:I.val(),Description:F.val(),Guid:aM,Order:J.val(),Status:q.is(":checked"),EnableCache:g.is(":checked"),EditMode:j.is(":checked"),IsLeaf:m.is(":checked"),IsType:am,ParentTypeId:au,isNew:n.is(":checked"),BuildJs:A.asCodeEditor("getValue"),SlidingExpirationTimeInMinutes:L.val(),RowVersion:ax}),success:function(aR){if(n.is(":checked")){var aS=false;if(aq[ay.value]){aS=true;delete aq[ay.value]}v.asDropdown("addItem",{text:I.val(),value:aN},ay,aS)}az(aR,false);$.asShowMessage({message:$.asRes[$.asLang].successOpration})}},{$form:B})});v.on("change",function(aM,aN){ay=aN;f.removeClass("disabled");if(al===false){if(typeof(aN.value)!="undefined"){$.asSetQueryString(aN.value)}}});w.on("change",function(aM,aN){A.asCodeEditor("setEditorMode",aN.value)});f.click(function(){S.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter("fa/cms/languageandculture-manager/data-translator/")},{name:"@isModal",value:true}]),{type:"masterDataKeyValue",id:ac,name:I.val(),description:F.val()})});V=function(){window.clearInterval(aj);aE.destroy()}};aa();var ar=function(){$.asNotFound("سرویس")};var ai=function(aH){al=true;v.asDropdown("selectValue",[],true);v.asDropdown("selectValue",aH);aG=0;aD="";ser=0;ax="";B.asAjax({url:$.asInitService($.asUrls.develop_code_browser_get,[{name:"@id",value:aH}]),type:"get",error:function(){al=false},success:function(aI){if($.isArray(aI)){if(aI.length>0){az(aI)}else{ar()}}else{if(aI!=null){if(typeof(aI)!="undefined"){az(aI)}else{ar()}}else{ar()}}al=false}})};var Z=function(){$.asStorage.setItem("codeJavascriptQueryEditor",A.asCodeEditor("getValue"))};var ab=function(aH){C.html(aH)};var az=function(aI,aH){if(typeof(aH)=="undefined"){aH=true}H.prop("disabled",true);n.prop("checked",false);ac=aI.Id;E.val(ac);af=aI.ParentId;ax=aI.RowVersion;m.prop("checked",aI.IsLeaf);if(aI.IsLeaf){c.prop("disabled",false)}else{c.prop("disabled",true)}ak=aI.IsLeaf;am=aI.IsType;au=aI.ParentTypeId;I.val(aI.Name);if(aI.Description!=null){F.val(aI.Description)}else{F.val("")}if(aI.Code!==null){D.val(aI.Code)}else{D.val("")}if(aI.Url!==null){at=aI.Url;M.val(aI.Url)}else{at="";M.val("")}H.val(aI.Guid);ad=aI.NewGuid;ae=aI.NewId;N.val(aI.Version);if(aI.Order!==null){J.val(aI.Order)}else{J.val("")}g.prop("checked",aI.EnableCache);j.prop("checked",aI.EditMode);q.prop("checked",aI.Status);aA=aI.Status;if(aH){if(aI.BuildJs!=null){A.asCodeEditor("setValue",aI.BuildJs)}else{A.asCodeEditor("setValue","")}}if(aI.ViewRoleId!==null){y.asDropdown("selectValue",aI.ViewRoleId)}else{y.asDropdown("selectValue",[],true)}if(aI.AccessRoleId!=null){u.asDropdown("selectValue",aI.AccessRoleId)}else{u.asDropdown("selectValue",[],true)}if(aI.ModifyRoleId!=null){x.asDropdown("selectValue",aI.ModifyRoleId)}else{x.asDropdown("selectValue",[],true)}};var an=function(){av=$.asGetQueryString();if(av!==null){var aH=av.split("/");ai(aH[0])}};if(typeof(aw)!="undefined"){$.asLoadPage(aw,aw.replace(/\//g,$.asUrlDelimeter))}});
