$("#i4be1c2f7c59b439da79547d38e5b6744").on($.asEvent.page.loaded,function(n,t){var rt="#i4be1c2f7c59b439da79547d38e5b6744",ut=".i4be1c2f7c59b439da79547d38e5b6744."+$.asPageClass,i=function(n){var t=new $.as({pageId:ut});return t.as(n)},ft=function(){},ht,ct,lt;$(rt).on($.asEvent.page.dispose,function(){ft()});$.asUrls=$.extend({security_Role_getAllByOtherLanguage:"/odata/security/LocalRoles?$filter=(Language%20eq%20'@lang')&$expand=Role&$select=Role%2FId%2CRole%2FParentId%2CRole%2FName%2CRole%2FOrder%2CRole%2FIsLeaf%2CName",security_Role_get:"/odata/security/Roles?$filter=Id%20eq%20@idd&$select=Id%2CParentId%2CName%2COrder%2CIsLeaf%2CDescription%2CStatus%2CViewRoleId%2CModifyRoleId%2CAccessRoleId",security_Role_save:"/security/role/save",security_Role_delete:"/security/role/delete"},$.asUrls);var e=i("#frmRoles"),et=i("#txtRoleId"),at=i("#divRoles"),o=i("#drpViewRole"),s=i("#drpModifyRole"),h=i("#drpAccessRole"),u=i("#drpRoles"),l=i("#txtName"),vt=i("#btnSave"),ot=$.asModalManager.get({url:$.asModalManager.urls.translator}),c=i("#txtDescription"),a=i("#txtOrder"),y=i("#chkIsLeaf"),f=i("#chkNew"),p=i("#chkStatus"),w=i("#txtParentId"),k=i("#btnTranslator"),yt=i("#btnDell"),d=0,g=0,nt=0,v=0,tt=!1,r={},pt={},st,wt={};ot.asModal({width:800});ht=function(){return $.asAjaxTask({url:$.asInitService($.asUrls.security_Role_getAllByOtherLanguage,[{name:"@lang",value:$.asLang}])})};at.asAfterTasks([ht()],function(n){u.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Role.Id"},parentDataField:{name:"Role.ParentId"},childrenDataField:"Children",removeChildLessParent:!1},valueDataField:"Role.Id",displayDataField:"Name",orderby:"Role.Order",localData:n},selectParents:!0});o.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Role.Id"},parentDataField:{name:"Role.ParentId"},childrenDataField:"Children",isLeafDataField:"Role.IsLeaf",removeChildLessParent:!0},valueDataField:"Role.Id",displayDataField:"Name",orderby:"Role.Order",localData:n}});h.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Role.Id"},parentDataField:{name:"Role.ParentId"},childrenDataField:"Children",isLeafDataField:"Role.IsLeaf",removeChildLessParent:!0},valueDataField:"Role.Id",displayDataField:"Name",orderby:"Role.Order",localData:n}});s.asDropdown({source:{hierarchy:{type:"flat",keyDataField:{name:"Role.Id"},parentDataField:{name:"Role.ParentId"},childrenDataField:"Children",isLeafDataField:"Role.IsLeaf",removeChildLessParent:!0},valueDataField:"Role.Id",displayDataField:"Name",orderby:"Role.Order",localData:n}})},{overlayClass:"as-overlay-relative"});ct={txtName:{required:!0,maxlength:128},txtDescription:{required:!0,maxlength:256},txtOrder:{required:!0},drpViewRole:{asType:"asDropdown",required:!0},drpAccessRole:{asType:"asDropdown",required:!0},drpModifyRole:{asType:"asDropdown",required:!0}};st=e.asValidate({rules:ct});lt=function(){$(rt).on($.asEvent.page.ready,function(){});f.change(function(){this.checked===!0?tt===!0?($.asShowMessage({template:"error",message:"There is no way to add a role to another role"}),f.prop("checked",!1)):(r.Id=v,v=0,r.Isleaf=tt,r.ParentId=w.val(),w.val(et.val()),r.Name=l.val(),l.val(""),r.Description=c.val(),c.val(""),r.Order=a.val(),a.val(""),r.Status=p.prop("checked"),p.prop("checked",!1),r.ViewRoleId=d,o.asDropdown("selectValue",[],!0),r.AccessRoleId=nt,h.asDropdown("selectValue",[],!0),r.ModifyRoleId=g,s.asDropdown("selectValue",[],!0)):b(r)});y.change(function(){this.checked===!0});yt.click(function(){u.asDropdown("selected")?e.asAjax({url:$.asUrls.security_Role_delete,data:JSON.stringify({Id:u.asDropdown("selected").value}),success:function(){u.asDropdown("reload",{url:$.asInitService($.asUrls.security_Role_getAllByOtherLanguage,[{name:"@lang",value:$.asLang}])});$.asShowMessage({message:$.asRes[$.asLang].successOpration,showTime:1e7})}},{$form:e}):$.asShowMessage({template:"error",message:"To remove , select a role"})});vt.click(function(){var n;u.asDropdown("selected")&&(n=f.is(":checked")?0:u.asDropdown("selected").value);o.asDropdown("selected")&&(d=o.asDropdown("selected").value);s.asDropdown("selected")&&(g=s.asDropdown("selected").value);h.asDropdown("selected")&&(nt=h.asDropdown("selected").value);y.is(":checked")===!1&&f.is(":checked")&&(wt[n]=!0);e.asAjax({url:$.asUrls.security_Role_save,data:JSON.stringify({Id:n,ParentId:w.val(),ViewRoleId:d,ModifyRoleId:g,AccessRoleId:nt,Name:l.val(),Description:c.val(),Order:a.val(),Status:p.is(":checked"),IsLeaf:y.is(":checked"),IsNew:f.is(":checked")}),success:function(n){f.is(":checked")&&u.asDropdown("reload",{url:$.asInitService($.asUrls.security_Role_getAllByOtherLanguage,[{name:"@lang",value:$.asLang}])});b(n);$.asShowMessage({message:$.asRes[$.asLang].successOpration,showTime:1e7})}},{$form:e})});u.on("change",function(n,t){pt=t;k.removeClass("disabled");k.prop("disabled",!1);typeof t.value!="undefined"&&bt(t.value)});k.click(function(){ot.asModal("load",$.asInitService($.asFormUrl,[{name:"@url",value:$.asUrlAsParameter($.asModalManager.urls.translator)},{name:"@isModal",value:!0}]),{type:"role",id:v,name:l.val(),description:c.val()})});ft=function(){st.destroy()}};lt();var it=function(){$.asNotFound("Role")},bt=function(n){u.asDropdown("selectValue",[],!0);u.asDropdown("selectValue",n);e.asAjax({url:$.asInitService($.asUrls.security_Role_get,[{name:"@id",value:n}]),type:"get",success:function(n){$.isArray(n)?n.length>0?b(n[0]):it():n!=null?typeof n!="undefined"?b(n):it():it()}})},b=function(n){console.dir(n);f.prop("checked",!1);v=n.Id;et.val(v);w.val(n.ParentId);y.prop("checked",n.IsLeaf);tt=n.IsLeaf;l.val(n.Name);n.Description!=null?c.val(n.Description):c.val("");n.Order!==null?a.val(n.Order):a.val("");p.prop("checked",n.Status);n.ViewRoleId!==null?o.asDropdown("selectValue",n.ViewRoleId):o.asDropdown("selectValue",[],!0);n.AccessRoleId!=null?h.asDropdown("selectValue",n.AccessRoleId):h.asDropdown("selectValue",[],!0);n.ModifyRoleId!=null?s.asDropdown("selectValue",n.ModifyRoleId):s.asDropdown("selectValue",[],!0)};$(ut).append('<span id="asRegisterPage"><\/span>');i("#asRegisterPage").asRegisterPageEvent();typeof t!="undefined"&&$.asLoadPage(t,t.replace(/\//g,$.asUrlDelimeter))})